<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-04-09 Do 14:56 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ansible Playbooks for yaVDR 0.7</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alexander Grothe &lt;seahawk1986@gmx.de&gt;" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Ansible Playbooks for yaVDR 0.7</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9998663">1. Introduction</a></li>
<li><a href="#orgc7a0a7e">2. Installing and configuring yaVDR with Ansible</a>
<ul>
<li><a href="#orgebec78d">2.1. Install scripts for local usage</a></li>
</ul>
</li>
<li><a href="#org6d10d99">3. Playbooks</a>
<ul>
<li><a href="#org04ed96f">3.1. yavdr07.yml</a></li>
<li><a href="#org7b21bbf">3.2. yavdr07-headless.yml</a></li>
</ul>
</li>
<li><a href="#org03151a3">4. Hosts</a></li>
<li><a href="#orgeb5d5cd">5. Group Variables</a>
<ul>
<li><a href="#org7f70bb0">5.1. PPAs</a></li>
<li><a href="#orgf0daaca">5.2. VDR user, directories, special configuration and plugins</a></li>
<li><a href="#orgbcea9e1">5.3. Media directories</a></li>
<li><a href="#orgca3dffb">5.4. NFS</a></li>
<li><a href="#org13a719d">5.5. Samba</a></li>
<li><a href="#org45fc2e8">5.6. Additional packages</a></li>
<li><a href="#org064070d">5.7. System pre-configuration</a></li>
<li><a href="#org89d998d">5.8. Serial IR</a></li>
</ul>
</li>
<li><a href="#org6ceee81">6. Roles</a>
<ul>
<li><a href="#org933c1c3">6.1. install-dependencies</a>
<ul>
<li><a href="#orgdf30689">6.1.1. tasks</a></li>
</ul>
</li>
<li><a href="#org744083e">6.2. nvidia experimental drivers</a>
<ul>
<li><a href="#orgf06cac8">6.2.1. tasks</a></li>
</ul>
</li>
<li><a href="#orgf4ab113">6.3. yavdr-common</a>
<ul>
<li><a href="#org2091470">6.3.1. default variables</a></li>
<li><a href="#orgcddd290">6.3.2. tasks</a></li>
<li><a href="#org758b487">6.3.3. templates</a></li>
<li><a href="#org245c8b0">6.3.4. MOTD</a></li>
</ul>
</li>
<li><a href="#org17e074b">6.4. vdr-addon-lifeguardng</a>
<ul>
<li><a href="#orgbb9aada">6.4.1. variables</a></li>
<li><a href="#org57b5b0a">6.4.2. tasks</a></li>
<li><a href="#orgeb07384">6.4.3. templates</a></li>
</ul>
</li>
<li><a href="#orgfca8bfe">6.5. collect facts about the system with custom modules</a>
<ul>
<li><a href="#orgde3a162">6.5.1. variables</a></li>
<li><a href="#org7346617">6.5.2. tasks</a></li>
</ul>
</li>
<li><a href="#org36468f1">6.6. vdr</a>
<ul>
<li><a href="#org3b95872">6.6.1. tasks</a></li>
<li><a href="#orgb1e1419">6.6.2. templates</a></li>
<li><a href="#org5194975">6.6.3. files</a></li>
</ul>
</li>
<li><a href="#orga33ee81">6.7. yavdr-network</a>
<ul>
<li><a href="#org6b3f96e">6.7.1. default variables</a></li>
<li><a href="#orgd5c9424">6.7.2. tasks</a></li>
</ul>
</li>
<li><a href="#orgf19435e">6.8. vdr-plugin-menuorg</a>
<ul>
<li><a href="#orgfa6e47e">6.8.1. tasks</a></li>
<li><a href="#org7cecf35">6.8.2. templates</a></li>
</ul>
</li>
<li><a href="#org238ccfd">6.9. nfs-server</a>
<ul>
<li><a href="#org5de931a">6.9.1. tasks</a></li>
<li><a href="#orgfcddaac">6.9.2. templates</a></li>
</ul>
</li>
<li><a href="#org8912ed2">6.10. yavdr-remote</a>
<ul>
<li><a href="#orgc7bab81">6.10.1. default variables</a></li>
<li><a href="#orga3fb007">6.10.2. tasks</a></li>
<li><a href="#orga9a1a1e">6.10.3. templates</a></li>
</ul>
</li>
<li><a href="#pulseaudio">6.11. pulseaudio</a>
<ul>
<li><a href="#orged7268b">6.11.1. tasks</a></li>
<li><a href="#orgd1a0f7b">6.11.2. templates</a></li>
</ul>
</li>
<li><a href="#org99819bc">6.12. session-common</a>
<ul>
<li><a href="#orgb568c2a">6.12.1. tasks</a></li>
<li><a href="#orgc20fd1f">6.12.2. templates</a></li>
</ul>
</li>
<li><a href="#org6a3e1cd">6.13. headless-session</a>
<ul>
<li><a href="#orgb96f840">6.13.1. About the headless session</a></li>
<li><a href="#orgea83ffc">6.13.2. default variables</a></li>
<li><a href="#headless-meta">6.13.3. dependencies</a></li>
<li><a href="#orgab88164">6.13.4. Tasks</a></li>
<li><a href="#org8ad2efd">6.13.5. templates</a></li>
</ul>
</li>
<li><a href="#org43b1976">6.14. udiskie</a>
<ul>
<li><a href="#orgeb09af2">6.14.1. tasks</a></li>
<li><a href="#orgf84bfe2">6.14.2. templates</a></li>
</ul>
</li>
<li><a href="#yavdr-xorg">6.15. yavdr-xorg</a>
<ul>
<li><a href="#yavdr-xorg-about">6.15.1. About the GUI session</a></li>
<li><a href="#yavdr-xorg-meta">6.15.2. dependencies</a></li>
<li><a href="#yavdr-xorg-defaults">6.15.3. default variables</a></li>
<li><a href="#yavdr-xorg-tasks">6.15.4. tasks</a></li>
<li><a href="#yavdr-xorg-templates">6.15.5. templates</a></li>
</ul>
</li>
<li><a href="#orge6df0dd">6.16. yavdr-desktop</a>
<ul>
<li><a href="#orgb3e9eec">6.16.1. dependencies</a></li>
<li><a href="#orgb01075e">6.16.2. Tasks</a></li>
<li><a href="#org4b5dd66">6.16.3. Templates</a></li>
</ul>
</li>
<li><a href="#org3c9009f">6.17. samba-install</a>
<ul>
<li><a href="#org85785b6">6.17.1. tasks</a></li>
</ul>
</li>
<li><a href="#orgb6bb1bd">6.18. samba-config</a>
<ul>
<li><a href="#org6153f74">6.18.1. tasks</a></li>
<li><a href="#orga8c41c7">6.18.2. templates</a></li>
</ul>
</li>
<li><a href="#org55daebe">6.19. autoinstall-ubuntu-drivers</a>
<ul>
<li><a href="#org5f1cef5">6.19.1. tasks</a></li>
</ul>
</li>
<li><a href="#org7b78a56">6.20. autoinstall-virtualbox-guest</a></li>
<li><a href="#org943d820">6.21. autoinstall-atric-usb</a>
<ul>
<li><a href="#org1feb789">6.21.1. dependencies</a></li>
<li><a href="#orgca19651">6.21.2. tasks</a></li>
<li><a href="#org8f88a36">6.21.3. templates</a></li>
</ul>
</li>
<li><a href="#org18282f5">6.22. autoinstall-yausbir</a>
<ul>
<li><a href="#orgdbecb7a">6.22.1. dependencies</a></li>
<li><a href="#orgb6939be">6.22.2. tasks</a></li>
<li><a href="#org5a74fb5">6.22.3. templates</a></li>
</ul>
</li>
<li><a href="#org7ef1917">6.23. autoinstall-satip</a>
<ul>
<li><a href="#orgc9077ca">6.23.1. tasks</a></li>
</ul>
</li>
<li><a href="#org46c0e20">6.24. autoinstall-targavfd</a>
<ul>
<li><a href="#org1bad9a8">6.24.1. tasks</a></li>
</ul>
</li>
<li><a href="#org45d44a5">6.25. autoinstall-imonlcd</a>
<ul>
<li><a href="#org076da3d">6.25.1. tasks</a></li>
</ul>
</li>
<li><a href="#org3f98564">6.26. autoinstall-imonvfd</a>
<ul>
<li><a href="#org4888a43">6.26.1. tasks</a></li>
<li><a href="#orgd7ba45f">6.26.2. templates</a></li>
</ul>
</li>
<li><a href="#org1725c7e">6.27. autoinstall-libcecdaemon</a>
<ul>
<li><a href="#org5ae24f2">6.27.1. tasks</a></li>
</ul>
</li>
<li><a href="#org8de2d37">6.28. autoinstall-pvr350</a>
<ul>
<li><a href="#org1912d04">6.28.1. tasks</a></li>
</ul>
</li>
<li><a href="#org5a5d483">6.29. autoinstall-hauppauge-pvr</a></li>
<li><a href="#orge89e1b3">6.30. autoinstall-firmware</a>
<ul>
<li><a href="#org5855b10">6.30.1. dependencies</a></li>
<li><a href="#orge4ac9d3">6.30.2. tasks</a></li>
</ul>
</li>
<li><a href="#org2adaa40">6.31. autoinstall-dvbsky-firmware</a>
<ul>
<li><a href="#org8d0a974">6.31.1. dependencies</a></li>
<li><a href="#org2d2bf4e">6.31.2. defaults</a></li>
<li><a href="#org2d9e54c">6.31.3. tasks</a></li>
</ul>
</li>
<li><a href="#org84a44c3">6.32. autoinstall-dvbhddevice</a>
<ul>
<li><a href="#org8b24cc4">6.32.1. defaults</a></li>
<li><a href="#orgc409a71">6.32.2. dependencies</a></li>
<li><a href="#org594b4c0">6.32.3. tasks</a></li>
</ul>
</li>
<li><a href="#org9153631">6.33. autoinstall-dvbsddevice</a>
<ul>
<li><a href="#org5b55a1f">6.33.1. defaults</a></li>
<li><a href="#orgab86ec7">6.33.2. dependencies</a></li>
<li><a href="#org894e86d">6.33.3. tasks</a></li>
</ul>
</li>
<li><a href="#org763a6a8">6.34. autoinstall-hardware-irmp</a>
<ul>
<li><a href="#orga9c40ae">6.34.1. dependencies</a></li>
<li><a href="#org865b8ed">6.34.2. tasks</a></li>
</ul>
</li>
<li><a href="#orge08aa71">6.35. Serial IR Receivers</a>
<ul>
<li><a href="#org0cde7e7">6.35.1. defaults</a></li>
<li><a href="#orgf83611a">6.35.2. tasks</a></li>
<li><a href="#org9154af0">6.35.3. templates</a></li>
</ul>
</li>
<li><a href="#orgb615010">6.36. kodi</a>
<ul>
<li><a href="#org029e010">6.36.1. tasks</a></li>
<li><a href="#org55a59ea">6.36.2. templates</a></li>
<li><a href="#org4928a32">6.36.3. files</a></li>
</ul>
</li>
<li><a href="#org805cbf9">6.37. dvd</a>
<ul>
<li><a href="#org9ad69d2">6.37.1. tasks</a></li>
</ul>
</li>
<li><a href="#orgca5094e">6.38. vdr-epg-daemon</a>
<ul>
<li><a href="#org56466b3">6.38.1. defaults</a></li>
<li><a href="#orgcd42374">6.38.2. tasks</a></li>
<li><a href="#orgaddf32f">6.38.3. templates</a></li>
</ul>
</li>
<li><a href="#org83f5a84">6.39. install-sundtek</a>
<ul>
<li><a href="#orgccd5890">6.39.1. dependencies</a></li>
<li><a href="#org79c6233">6.39.2. defaults</a></li>
<li><a href="#org20cfd69">6.39.3. tasks</a></li>
<li><a href="#orge2a68e0">6.39.4. templates</a></li>
</ul>
</li>
<li><a href="#org4b5eb4a">6.40. channelpedia upload</a>
<ul>
<li><a href="#org7147f15">6.40.1. tasks</a></li>
<li><a href="#org33bfbae">6.40.2. templates</a></li>
</ul>
</li>
<li><a href="#orgd3e259c">6.41. template-test</a></li>
<li><a href="#orgaf375e2">6.42. wakeup</a>
<ul>
<li><a href="#orgb130259">6.42.1. defaults</a></li>
<li><a href="#org3f8ba6b">6.42.2. tasks</a></li>
<li><a href="#org9a7ec72">6.42.3. templates</a></li>
</ul>
</li>
<li><a href="#org8638539">6.43. grub-config</a>
<ul>
<li><a href="#orga0c0935">6.43.1. default variables</a></li>
<li><a href="#orgca2d354">6.43.2. tasks</a></li>
<li><a href="#org6ea2291">6.43.3. templates</a></li>
<li><a href="#orga664789">6.43.4. handlers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org899b826">7. Modules</a>
<ul>
<li><a href="#org1e80b98">7.1. hardware_facts.py</a></li>
<li><a href="#org9227471">7.2. pci_facts.py</a></li>
<li><a href="#orgcb34123">7.3. satip_facts.py</a></li>
<li><a href="#org44b8867">7.4. xrandr_facts.py</a></li>
<li><a href="#org0d652fb">7.5. rmmod.py</a></li>
</ul>
</li>
<li><a href="#org046ac32">8. Handlers</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9998663" class="outline-2">
<h2 id="org9998663"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
One of the major problems we faced with customized Ubuntu ISO files as installation media for prior yaVDR versions has been the limited hardware support and the time consuming process to create and update them.  An interesting alternative to this approach is to enable the user to choose the installation medium by himself, so point releases, kernel versions and additional drivers can be chosen deliberately.  After the basic setup is complete (and a working internet connection is available), a fully customizable install script completes the yaVDR installation.
</p>
</div>
</div>
<div id="outline-container-orgc7a0a7e" class="outline-2">
<h2 id="orgc7a0a7e"><span class="section-number-2">2</span> Installing and configuring yaVDR with Ansible</h2>
<div class="outline-text-2" id="text-2">
<p>
This is an experimental feature which allows to set up a yaVDR installation based on a normal Ubuntu Server 16.04.x installation using <a href="http://ansible.com">Ansible</a>.
</p>

<p>
This Manual is written in org-mode for Emacs and can rewrite the complete ansible configuration if you call <code>org-babel-tangle</code> from within emacs.
</p>

<p>
To use this playbook on a Ubuntu Server Installation you need to run the following commands:
</p>
<pre class="example">
sudo apt-get install git
git clone https://github.com/yavdr/yavdr-ansible.git
cd yavdr-ansible
git checkout bionic
sudo ./install-yavdr.sh
</pre>

<p>
We use a callback to generate tags for all roles autmatically:
</p>
<div class="org-src-container">
<pre class="src src-conf">[defaults]
stdout_callback = debug
callback_plugins = plugins/callbacks
callback_whitelist = auto_tags
ansible_managed = *** ANSIBLE MANAGED FILE ***
  template: {file}

[ssh_connection]
pipelining = true
</pre>
</div>
</div>

<div id="outline-container-orgebec78d" class="outline-3">
<h3 id="orgebec78d"><span class="section-number-3">2.1</span> Install scripts for local usage</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-shell">set -e

if (( $EUID != 0 )); then
    echo "This script must be run using sudo -H or as root"
    exit
fi

. scripts/install-packages.sh

ansible-playbook yavdr07.yml -b -i 'localhost_inventory' --connection=local --tags="all"
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">set -e

if (( $EUID != 0 )); then
    echo "This script must be run using sudo -H or as root"
    exit
fi

. scripts/install-packages.sh

# speed up playbook execution
export ANSIBLE_PIPELINING=1

ansible-playbook yavdr07-headless.yml -b -i 'localhost_inventory' --connection=local --tags="all"
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6d10d99" class="outline-2">
<h2 id="org6d10d99"><span class="section-number-2">3</span> Playbooks</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org04ed96f" class="outline-3">
<h3 id="org04ed96f"><span class="section-number-3">3.1</span> yavdr07.yml</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The <code>yavdr07.yml</code> playbook sets up a fully-featured yaVDR installation:
</p>
<div class="org-src-container">
<pre class="src src-yaml">---
# file: yavdr07.yml
# this playbook sets up a complete yaVDR 0.7 installation

- name: set up yaVDR
  hosts: all
  become: true
  roles:
    - yavdr-common               # install and configure the basic system
    - collect-facts              # query system facts
    - autoinstall-ubuntu-drivers # use ubuntu-drivers to install proprietary dirvers
                                 # (e.g. nvidia, virtualbox)
    # - nvidia-experimental       # install very recent nvidia dirver from ppa:graphics-drivers/ppa
    - vdr                        # install vdr and related packages
    - vdr-plugin-menuorg         # install vdr-plugin-menuorg and customize menuorg.xml
    - autoinstall-virtualbox-guest
    - lifeguardng                # install and configure vdr-addon-lifeguard-ng
    - yavdr-network              # enable network client capabilities
    - samba-install              # install samba server
    - samba-config               # configure samba server
    - nfs-server                 # install nfs server
    - pulseaudio                 # install pulseaudio
    - yavdr-xorg                 # graphical session
    - yavdr-remote               # remote configuration files, services and scripts
    - yavdr-desktop              # openbox session with yavdr frontend script
    - autoinstall-satip          # install vdr-plugin-satip if a Sat&gt;IP server has been found
    - autoinstall-targavfd       # install vdr-plugin-targavfd if display is connected
    - autoinstall-imonlcd        # install vdr-plugin-imonlcd if a matchind display is connected
    - autoinstall-imonvfd        # install vdr-plugin-imonvfd if a matchind display is connected
    - autoinstall-pvr350         # install vdr-plugin-pvr350 if a matching card is detected
    - autoinstall-hauppauge-pvr  # install vdr-plugin-pvrinput if a matching card is found
    - autoinstall-dvbsddevice    # install vdr-plugin-dvbsddevice if a matching card is detected
    # - autoinstall-dvbhddevice    # install vdr-plugin-dvbsddevice if a matching card is detected - NOTE: you need to compile and install the drivers yourself
    - autoinstall-hardware-irmp  # install yavdr-hardware-irmp if a matching usb device is detected
    - autoinstall-atric-usb      # preconfigure lircd for Atric IR-WakeupUSB receiver
    - autoinstall-yausbir        # preconfigure lircd for yaUsbIR receiver
    - autoinstall-dvbsky-firmware # download and install required firmware files for dvbsky cards
    - autoinstall-firmware       # download and install firmware files for dvb devices
    #- install-sundtek            # install and configure sundtek drivers
    #- serial-ir                  # configure a serial port for "homebrew" ir receivers (e.g. Atric V5)
    #- epgd                       # install vdr-epg-daemon (and vdr-plugin-epg2vdr)
    #- channelpedia               # upload channels.conf to channelpedia (see role description in Manual)
    - kodi
    - dvd                        # set up packages and a udev rule to allow kodi and other players
                                 # to play and eject optical media
    - wakeup                     # set up wakeup methods for rtc etc.
    - grub-config                # configure grub

  handlers:
    - import_tasks: handlers/main.yml
</pre>
</div>
</div>
</div>
<div id="outline-container-org7b21bbf" class="outline-3">
<h3 id="org7b21bbf"><span class="section-number-3">3.2</span> yavdr07-headless.yml</h3>
<div class="outline-text-3" id="text-3-2">
<p>
For a headless server installation <code>yavdr07-headless.yml</code> is a good choice
</p>
<div class="org-src-container">
<pre class="src src-yaml">---
# file: yavdr07-headless.yml
# this playbook set up a headless yaVDR 0.7 installation

- name: set up a headless yaVDR server
  hosts: all
  become: true
  roles:
    - yavdr-common
    - collect-facts              # query system facts
    - vdr
    - lifeguardng                # install and configure vdr-addon-lifeguard-ng
    - headless-session           # set up a headless systemd user session, e.g. for udiskie
    - yavdr-network
    - samba-install
    - samba-config
    - nfs-server
    - grub-config
    - autoinstall-satip          # install vdr-plugin-satip if a Sat&gt;IP server has been found
    - autoinstall-pvr350         # install vdr-plugin-pvr350 if a matching card is detected
    - autoinstall-hauppauge-pvr  # install vdr-plugin-pvrinput if a matching card is found
    - autoinstall-dvbsddevice    # install vdr-plugin-dvbsddevice if a matching card is detected
    - autoinstall-dvbsky-firmware # download and install required firmware files for dvbsky cards
    - autoinstall-firmware       # download and install firmware files for dvb devices
    #- epgd                      # install vdr-epg-daemon
    #- channelpedia               # upload channels.conf to channelpedia (see role description in Manual)
    - wakeup
  tags:
    - always
  handlers:
    - import_tasks: handlers/main.yml
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org03151a3" class="outline-2">
<h2 id="org03151a3"><span class="section-number-2">4</span> Hosts</h2>
<div class="outline-text-2" id="text-4">
<p>
This playbook can either be used to run the installation on the localhost or any other PC in the network that can be accessed via ssh. Simply add the host names or IP addresses to the hosts file in the respective section:
</p>

<div class="org-src-container">
<pre class="src src-conf">[local]
localhost ansible_connection=local
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeb5d5cd" class="outline-2">
<h2 id="orgeb5d5cd"><span class="section-number-2">5</span> Group Variables</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org7f70bb0" class="outline-3">
<h3 id="org7f70bb0"><span class="section-number-3">5.1</span> PPAs</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: group_vars/all

branch: experimental
ppa_owner: 'ppa:yavdr'
# add the following PPAs
repositories:
  - '{{ ppa_owner }}/{{branch}}-main'
  - '{{ ppa_owner }}/{{branch}}-vdr'
  - '{{ ppa_owner }}/{{branch}}-kodi'

</pre>
</div>
</div>
</div>
<div id="outline-container-orgf0daaca" class="outline-3">
<h3 id="orgf0daaca"><span class="section-number-3">5.2</span> VDR user, directories, special configuration and plugins</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-yaml"># properties of the user vdr and vdr-related options
# NOTE: user name, uid and confdir must match the values set by the vdr package
vdr:
  user: vdr
  group: vdr
  uid: 666
  gid: 666
  home: /var/lib/vdr
  etc_confdir: /etc/vdr
  confdir: /var/lib/vdr
  recdir: /srv/vdr/video
  hide_first_recording_level: false
  safe_dirnames: true  # escape characters (useful for windows clients and FAT/NTFS file systems)
  override_vdr_charset: ""  # set the desired charset, e.g. "ISO-8859-9"

# wait for dvb devices by adapter number
# NOTE: This only works for devices that are discoverable by udev, not userspace drivers like sundtek tuners!
# e.g. wait_for_dvb_devices: [0, 1] to wait for /dev/dvb/adapter0 and /dev/dvb/adapter1
wait_for_dvb_devices: []

# this allows to set up streamdev-client - set the server, port and number of devices
# streamdev_client_remote_ip: "192.168.0.104"
# streamdev_client_remote_port: 2004
# streamdev_ciient_num_provided_systems: 1

# copy channels.conf from a local file
# vdr_channels_conf: /path/to/channels.conf

# download channels.conf from a given url (supports HTTP(S) and FTP)
# vdr_channels_conf_url: http://example.com/vdr/channels.conf

# add the vdr plugins you want to install
vdr_plugins:
  - vdr-plugin-devstatus
  - vdr-plugin-markad
  - vdr-plugin-softhddevice

# IP (range) filter for vdr and plugins (this must be an array):
# vdr_allowed_hosts:
#   - 192.168.0.0/24

# hosts and subnets for svdrphosts.conf (overrides vdr_allowed_hosts):
# vdr_svdrphosts:
#   - 192.168.0.0/24

# hosts and subnets for allowed_hosts.conf of xineliboutput (overrides vdr_allowed_hosts):
# xineliboutput_allowed_hosts:
#   - 192.168.0.0/24

# hosts and subnets for allowed_hosts.conf of vnsiserver (overrides vdr_allowed_hosts):
# vnsiserver_allowed_hosts:
#   - 192.168.0.0/24

# hosts and subnets for streamdevhosts.conf (overrides vdr_allowed_hosts):
# streamdev_server_allowed_hosts:
#   - 192.168.0.0/24

</pre>
</div>
</div>
</div>
<div id="outline-container-orgbcea9e1" class="outline-3">
<h3 id="orgbcea9e1"><span class="section-number-3">5.3</span> Media directories</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-yaml"># dictionary of directories for (shared) files. Automatically exported via NFS and Samba if those roles are enabled
media_dirs:
  audio: /srv/audio
  video: /srv/video
  pictures: /srv/picture
  files: /srv/files
  backups: /srv/backups
  recordings: '{{ vdr.recdir }}'

</pre>
</div>
</div>
</div>
<div id="outline-container-orgca3dffb" class="outline-3">
<h3 id="orgca3dffb"><span class="section-number-3">5.4</span> NFS</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-yaml">nfs:
  insecure: false  # set to true for OS X clients or if you plan to use libnfs as unprivileged user (e.g. KODI)

</pre>
</div>
</div>
</div>
<div id="outline-container-org13a719d" class="outline-3">
<h3 id="org13a719d"><span class="section-number-3">5.5</span> Samba</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">
<pre class="src src-yaml">samba:
  workgroup: YAVDR
  windows_compatible: '{{ vdr.safe_dirnames }}'  # set to true to disable unix extensions, enable follow symlinks and wide links

</pre>
</div>
</div>
</div>
<div id="outline-container-org45fc2e8" class="outline-3">
<h3 id="org45fc2e8"><span class="section-number-3">5.6</span> Additional packages</h3>
<div class="outline-text-3" id="text-5-6">
<div class="org-src-container">
<pre class="src src-yaml"># additional packages you want to install
extra_packages:
  - bpython
  - bpython3
  - htop
  - tree
  - vim
  - w-scan
  - t2scan
  - plymouth-theme-yavdr-logo
  - vdrpbd

</pre>
</div>
</div>
</div>
<div id="outline-container-org064070d" class="outline-3">
<h3 id="org064070d"><span class="section-number-3">5.7</span> System pre-configuration</h3>
<div class="outline-text-3" id="text-5-7">
<div class="org-src-container">
<pre class="src src-yaml">frontend: vdr

# vdr shutdown command - SHUTDOWNCMD variable in /etc/default/vdr
# for standby use "/bin/systemctl suspend"
vdr_shutdown_command: poweroff

# to force quadratic pixels set this variable to the dpi you want
# nvidia_force_dpi: 96

#system:
#  shutdown: poweroff

# choose one of acpiwakeup, stm32wakeup
wakeup_method: acpiwakeup

# start given number of minutes earlier than the wakeuptime set by vdr
wakeup_start_ahead: 5

# set days of the week for automatic wakeup (1=Monday...7=Sunday),
# set empty string to disable wakeup
# eg. to wake up on Monday and Friday:
# wakeup_days: "1 5"
wakeup_days: ""

# set wakeup time for automatic wakeup
# set empty string to disable
# e.g. for wakeup at midnight:
# wakeup_time: "00:00"
wakeup_time: ""

# settings for grub
grub:
  timeout: 0
  boot_options: quiet splash

# unload dvb drivers before standby, reload them afterwards.
# disable this setting if
# - you don't have local dvb devices (e.g. satip client)
# - your dvb drivers have problems being unloaded
standby_reload_dvb: true

# settings for vdr-addon-lifeguard-ng
# the following settings prevent the shutdown
# if a nfs, samba or ssh connection to this machine is open
lifeguard_enable_nfs: True
lifeguard_enable_samba: True
lifeguard_enable_ssh: True
# list of ip addresses or hostnames which should prevent shutdown
# if the can be pinged
lifeguard_hosts: []
# list of users which sould prevent shutdown if they are logged in
# this is somewhat redudant because systemd check this, too
lifeguard_users: []
# check for local processes
lifeguard_processes: []
# check for active tcp connections of local processes
# syntax: &lt;processname&gt; [:] &lt;port&gt;
lifeguard_tcp:
  - vdr 3000  # don't shutdown if there is an active streamdev connection 
</pre>
</div>
</div>
</div>
<div id="outline-container-org89d998d" class="outline-3">
<h3 id="org89d998d"><span class="section-number-3">5.8</span> Serial IR</h3>
<div class="outline-text-3" id="text-5-8">
<div class="org-src-container">
<pre class="src src-yaml">
# Serial device to configure for a homebrew receiver.
# Choose either ttyS0 (COM1) or ttyS1 (COM2)
# Also ensure that the role serial-ir is enabled in yavdr07.yml
serial_ir_device: ttyS0
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6ceee81" class="outline-2">
<h2 id="org6ceee81"><span class="section-number-2">6</span> Roles</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org933c1c3" class="outline-3">
<h3 id="org933c1c3"><span class="section-number-3">6.1</span> install-dependencies</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-orgdf30689" class="outline-4">
<h4 id="orgdf30689"><span class="section-number-4">6.1.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-1-1">
</div>
<ol class="org-ol">
<li><a id="org7c3c7e2"></a>main.yml<br />
<div class="outline-text-5" id="text-6-1-1-1">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: apt | install packages
  apt:
    name: '{{ packages }}'
    state: present
    install_recommends: no
    cache_valid_time: 60
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org744083e" class="outline-3">
<h3 id="org744083e"><span class="section-number-3">6.2</span> nvidia experimental drivers</h3>
<div class="outline-text-3" id="text-6-2">
<p>
install nvidia-430 from ppa:graphics-drivers/ppa
</p>
</div>
<div id="outline-container-orgf06cac8" class="outline-4">
<h4 id="orgf06cac8"><span class="section-number-4">6.2.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-2-1">
</div>
<ol class="org-ol">
<li><a id="org4dd9cbb"></a>main.yml<br />
<div class="outline-text-5" id="text-6-2-1-1">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: add ppa:graphics-drivers/ppa
  apt_repository:
      repo: 'ppa:graphics-drivers/ppa'
      state: present
      update_cache: yes
  tags:
    - ppa

- name: install nvidia-430 and other required packages
  apt:
    name:
      - nvidia-driver-430
      - nvidia-settings
    state: present
    install_recommends: no
  tags:
    - packages
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgf4ab113" class="outline-3">
<h3 id="orgf4ab113"><span class="section-number-3">6.3</span> yavdr-common</h3>
<div class="outline-text-3" id="text-6-3">
<p>
This role is used to set up a basic yaVDR installation. It creates the directories, installs the vdr and other useful packages.
</p>
</div>
<div id="outline-container-org2091470" class="outline-4">
<h4 id="org2091470"><span class="section-number-4">6.3.1</span> default variables</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
This section is for reference only, please use the files in <code>global_vars</code> for customizations.
</p>
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/yavdr-common/defaults/main.yml
</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org18c7730"></a>Repositories<br />
<div class="outline-text-5" id="text-6-3-1-1">
<p>
You can set a list of package repositories which provide the necessary packages. Feel free to use own PPAs if you need special customization to the VDR and it&rsquo;s plugins.
</p>
<div class="org-src-container">
<pre class="src src-yaml">branch: unstable
repositories:
  - 'ppa:yavdr/main'
  - 'ppa:yavdr/unstable-main'
  - 'ppa:yavdr/{{branch}}-vdr'
  - 'ppa:yavdr/{{branch}}-kodi'
  - 'ppa:yavdr/{{branch}}-yavdr'
</pre>
</div>
</div>
</li>
<li><a id="org5ed41c8"></a>Drivers<br />
<div class="outline-text-5" id="text-6-3-1-2">
<p>
Automatically installed drivers can be very useful, but if you know you need a certain driver, you can simply set it&rsquo;s value to <b>true</b>. If you don&rsquo;t want a driver to be installed, set it&rsquo;s value to <b>false</b>.
</p>
<div class="org-src-container">
<pre class="src src-yaml">drivers:
  sundtek: auto
  ddvb-dkms: auto
</pre>
</div>
</div>
</li>
<li><a id="orgde67b68"></a>Additional Packages<br />
<div class="outline-text-5" id="text-6-3-1-3">
<p>
Add additional packages you would like to have on your installation to this list
</p>
<div class="org-src-container">
<pre class="src src-yaml">extra_packages:
  - vim
  - tree
  - w-scan
</pre>
</div>
</div>
</li>
<li><a id="orgae0fa4d"></a>VDR<br />
<div class="outline-text-5" id="text-6-3-1-4">
<p>
This section allows you to set the recording directory, the user and group that runs the vdr and it&rsquo;s home directory.
</p>
<dl class="org-dl">
<dt>user</dt><dd>the vdr user name</dd>
<dt>group</dt><dd>the main group for the user vdr</dd>
<dt>uid</dt><dd>the user id for the user vdr</dd>
<dt>gid</dt><dd>the group id for the group vdr</dd>
<dt>home</dt><dd>the home directory for the user vdr</dd>
<dt>recdir</dt><dd>the recording directory used by VDR</dd>
<dt>hide_first_recording_level</dt><dd>let vdr hide the first directory level of it&rsquo;s recording directory so the content of multiple directories is shown merged together</dd>
<dt>safe_dirnames</dt><dd>replace special characters which are not compatible with Windows file systems and Samba shares</dd>
<dt>override_vdr_charset</dt><dd>workaround for channels with weird EPG encodings, e.g. Sky</dd>
</dl>
<div class="org-src-container">
<pre class="src src-yaml">vdr:
    user: vdr
    group: vdr
    uid: 666
    gid: 666
    home: /var/lib/vdr
    recdir: /srv/vdr/video
    hide_first_recording_level: false
    safe_dirnames: true
    override_vdr_charset: ""
vdr_allowed_hosts: []
</pre>
</div>
</div>
</li>
<li><a id="orgb874a76"></a>Standby settings<br />
<div class="outline-text-5" id="text-6-3-1-5">
<div class="org-src-container">
<pre class="src src-yaml">standby_reload_dvb: true
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgcddd290" class="outline-4">
<h4 id="orgcddd290"><span class="section-number-4">6.3.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
yavdr-common executes the following tasks:
</p>
</div>
<ol class="org-ol">
<li><a id="orge92e346"></a>main.yml<br />
<div class="outline-text-5" id="text-6-3-2-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/yavdr-common/tasks/main.yml

- name: basic installation
  block:
        - import_tasks: configure_apt.yml
        - import_tasks: configure_system.yml
        - import_tasks: create_directories.yml
        - import_tasks: create_sudoers.yml
        - import_tasks: standby_support.yml
  tags: [install]
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org2890fa0"></a>Disable default installation of recommended packages<br />
<div class="outline-text-6" id="text-6-3-2-1-1">
<p>
This task prevents apt to automatically install all recommended dependencies for packages:
</p>
<div class="org-src-container">
<pre class="src src-yaml">---

- name: apt | prevent automatic installation of recommended packages
  template:
    src: templates/90-norecommends.j2
    dest: /etc/apt/apt.conf.d/90norecommends

</pre>
</div>
</div>
</li>
<li><a id="org8f536cc"></a>Set up package repositories<br />
<div class="outline-text-6" id="text-6-3-2-1-2">
<div class="org-src-container">
<pre class="src src-yaml">- name: add PPAs
  apt_repository:
      repo: '{{ item }}'
      state: present
      update_cache: no
  loop: "{{ repositories|flatten(levels=1) }}"
  tags:
    - ppa

- name: run apt-get dist-upgrade
  apt:
      upgrade: dist
      update_cache: yes
</pre>
</div>
</div>
</li>
<li><a id="org210ff59"></a>ensure cloud-init is not installed<br />
<div class="outline-text-6" id="text-6-3-2-1-3">
<p>
This should at least prevent black screen errors after a reboot, if the Ubuntu Cloud Server Image has been used for install.
</p>
<div class="org-src-container">
<pre class="src src-yaml">- name: "debconf | disable all cloud-init datasources"
  debconf:
    name: cloud-init
    question: cloud-init/datasources
    value: ''
    vtype: select
  register: cloud_init_debconf

- name: "command | reconfigure cloud-init package"
  command: dpkg-reconfigure -f noninteractive cloud-init
  ignore_errors: yes
  when:  cloud_init_debconf.changed
  # notify: ['rerun required']
  
- name: "apt | ensure package cloud-init is not installed"
  apt:
    name: cloud-init
    state: absent
</pre>
</div>
</div>
</li>
<li><a id="orgc5a8015"></a>Use bash instead of dash<br />
<div class="outline-text-6" id="text-6-3-2-1-4">
<p>
<code>dash</code> is more limited than bash (albeit faster) - since vdr packages and addons ship with a lot of scripts, we use <code>bash</code> as the default shell.
</p>
<div class="org-src-container">
<pre class="src src-yaml">- name: use bash instead of dash
  shell: |
    echo "set dash/sh false" | debconf-communicate
    dpkg-reconfigure -f noninteractive dash
</pre>
</div>
</div>
</li>

<li><a id="orgb08585d"></a>create user vdr<br /></li>
<li><a id="org7da6c23"></a>Disable release-upgrade notifications<br />
<ol class="org-ol">
<li><a id="org36e1b53"></a><span class="todo SOMEDAY">SOMEDAY</span> move from lineinfile to template<br />
<div class="outline-text-7" id="text-6-3-2-1-6-1">
<div class="org-src-container">
<pre class="src src-yaml">- name: disable release-upgrade notifications
  lineinfile:
    path: /etc/update-manager/release-upgrades
    backrefs: yes
    state: present
    regexp: '^(Prompt=).*$'
    line: 'Prompt=never'
  ignore_errors: yes

</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org17b7e04"></a>Install essential packages<br />
<div class="outline-text-6" id="text-6-3-2-1-7">
<div class="org-src-container">
<pre class="src src-yaml">- name: apt | install basic packages
  apt:
    name:
      - anacron
      - acl
      - at
      - bash-completion
      #- biosdevname  # caution: may change device names after a minimal installation!
      - debconf-utils
      - linux-firmware
      - psmisc
      - python3-jmespath
      - python3-kmodpy
      - python3-requests
      - python3-usb
      - software-properties-common
      - ssh
      - toilet
      - wget
      - wpasupplicant
      - usbutils
      - xfsprogs
      - yavdr-i18n
    state: present
    install_recommends: no

</pre>
</div>
</div>
</li>
<li><a id="org8f06efd"></a>Install additional packages (user defined)<br />
<div class="outline-text-6" id="text-6-3-2-1-8">
<div class="org-src-container">
<pre class="src src-yaml">- name: apt | install extra packages
  apt:
    name: '{{ extra_packages }}'
    state: present
    install_recommends: no

</pre>
</div>
</div>
</li>
<li><a id="org4e24810"></a>create directories<br /></li>
<li><a id="orgfecf93a"></a>create sudoers drop-in for vdr<br /></li>
<li><a id="orge4ee240"></a>basic scripts for standby support<br />
<div class="outline-text-6" id="text-6-3-2-1-11">
<p>
Stop vdr before entering suspend and unload dvb modules, reverse this operation on resume
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org758b487" class="outline-4">
<h4 id="org758b487"><span class="section-number-4">6.3.3</span> templates</h4>
<div class="outline-text-4" id="text-6-3-3">
<div class="org-src-container">
<pre class="src src-c">{{ ansible_managed | comment('c') }}
// Recommends are as of now still abused in many packages
APT::Install-Recommends "0";
APT::Install-Suggests "0";
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org0ea6744"></a>yavdr sudoers drop-in<br />
<div class="outline-text-5" id="text-6-3-3-1">
<p>
Allow the vdr user to restart <code>vdr.service</code> and reboot the system
</p>
<div class="org-src-container">
<pre class="src src-shell">{{ vdr.user }} ALL=NOPASSWD: /bin/systemctl --no-block restart vdr.service
{{ vdr.user }} ALL=NOPASSWD: /bin/systemctl --no-block reboot
</pre>
</div>
</div>
</li>
<li><a id="org1bb10b7"></a>suspend hooks<br />
<div class="outline-text-5" id="text-6-3-3-2">
<div class="org-src-container">
<pre class="src src-jinja2">#!/bin/bash
{{ ansible_managed | comment }}

case $1 in
  pre)
    # disable "_nfs.tcp" avahi announcements
    for file in /etc/avahi/services/*.service; do
        if grep -Fq "_nfs._tcp" "$file"; then
            echo "rename $file to ${file%%.*}.disabled"
            mv "$file" "${file%%.*}.disabled"
        fi
    done

    /bin/systemctl stop vdr
    /usr/bin/frontend-dbus-send shutdown_successfull
    {% if standby_reload_dvb %}
    echo "unload dvb drivers"
    /usr/local/bin/module-helper -u dvb_core
    {% endif %}
    ;;
  post)
    # start current frontend again
    if [ -x /usr/bin/frontend-dbus-send ]
    then
        /usr/bin/frontend-dbus-send start ||:
    fi

    # reload rc-core keytables
    if [ -x /usr/bin/ir-keytable ]
    then
        for remote in $(ir-keytable 2&gt;&amp;1 | grep rc/rc | egrep -o "rc[0-9]{1,}")
        do
            /usr/bin/ir-keytable -a /etc/rc_maps.cfg --sysdev $remote
        done
    fi

    {% if standby_reload_dvb %}
    echo "restore dvb drivers"
    /usr/local/bin/module-helper -r
    {% endif %}

    # wait up to 10 seconds for the network
    timeout=0
    while [ -z "$(hostname --all-fqdns)" ]
    do
        echo "waiting for network..."
        sleep .5
        [ $(( timeout++ )) -ge 20 ] &amp;&amp; break
    done

    # restore "_nfs._tcp" avahi announcements
    for file in /etc/avahi/services/*.disabled; do
        if grep -Fq "_nfs._tcp" "$file"; then
            echo "rename $file to ${file%%.*}.service"
            mv "$file" "${file%%.*}.service"
        fi
    done

    /bin/systemctl start vdr
    ;;
esac

</pre>
</div>
</div>
</li>
<li><a id="org0e7fb4f"></a>module-helper<br />
<div class="outline-text-5" id="text-6-3-3-3">
<div class="org-src-container">
<pre class="src src-python">#!/usr/bin/env python3
# {{ ansible_managed | comment }}
# based on http://www.e-tobi.net/blog/files/module-helper
# http://www.e-tobi.net/blog/2010/11/06/squeeze-vdr-teil-9-suspend-to-ram
# ported to python3 by Alexander Grothe
#
# This script resolves linux kernel module dependencies automatically, so only
# the base module has to be specified (e.g. dvb_core)

import argparse
import subprocess
import pickle

dependency_map = {}


def find_dependencies(module, dependencies=[]):
    dependencies.append(module)
    if module in dependency_map:
        for dependency in dependency_map[module]:
            find_dependencies(dependency, dependencies)
    return dependencies


def build_module_dependency_map():
    with subprocess.Popen(['lsmod'],
                          stdout=subprocess.PIPE,
                          universal_newlines=True
                          ) as p:
        for line in p.stdout:
            values = line.split()
            if len(values) &gt; 3:
                #print("module {} depends on {}".format(values[0], values[3]))
                dependency_map[values[0]] = values[3].split(',')


def run_command_on_module_list(command, module_list):
    for module in module_list:
        cmd = [command, module]
        subprocess.call(cmd)


def create_argparser():
    parser = argparse.ArgumentParser(description="load or unload modules")
    group = parser.add_mutually_exclusive_group()
    group.add_argument('-u', '--unload', metavar='MODULE', nargs='+',
                       help='unload modules')
    group.add_argument('-r', '--reload', action='store_true',
                       help='reload modules')
    parser.add_argument('-t', '--temp-file', nargs='?',
                        default='/tmp/modules.list',
                        help='''store names of unloaded modules in a file,
                              default location is /tmp/modules.list''')
    return parser

if __name__ == '__main__':
    parser = create_argparser()
    args = parser.parse_args()
    if args.unload:
        build_module_dependency_map()
        all_modules = []
        for module in args.unload:
            all_modules.extend(find_dependencies(module))
        all_modules.reverse()
        try:
            with open(args.temp_file, 'wb') as f:
                pickle.dump(all_modules, f)
            run_command_on_module_list('rmmod', all_modules)
        except Exception as e:
            print(e)
            pass
    elif args.reload:
        with open(args.temp_file, 'rb') as f:
            all_modules = pickle.load(f)
        run_command_on_module_list('modprobe', all_modules)
    else:
        parser.print_help()
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org245c8b0" class="outline-4">
<h4 id="org245c8b0"><span class="section-number-4">6.3.4</span> MOTD</h4>
<div class="outline-text-4" id="text-6-3-4">
</div>
<ol class="org-ol">
<li><a id="org4f62840"></a>Header<br />
<div class="outline-text-5" id="text-6-3-4-1">
<div class="org-src-container">
<pre class="src src-shell">#!/bin/sh
#
#    00-header - create the header of the MOTD
#    Copyright (C) 2009-2010 Canonical Ltd.
#                  2019      Alexander Grothe
#
#    Authors: Dustin Kirkland &lt;kirkland@canonical.com&gt;
#             Alexander Grothe &lt;seahawk1986@gmx.de&gt;
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License along
#    with this program; if not, write to the Free Software Foundation, Inc.,
#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

toilet -S -f "smblock.tlf" --metal -t "yaVDR-ansible" 2&gt;/dev/null || echo "yavdr-ansible"

[ -r /etc/lsb-release ] &amp;&amp; . /etc/lsb-release

if [ -z "$DISTRIB_DESCRIPTION" ] &amp;&amp; [ -x /usr/bin/lsb_release ]; then
	# Fall back to using the very slow lsb_release utility
	DISTRIB_DESCRIPTION=$(lsb_release -s -d)
fi

printf "%s (%s %s %s)\n" "$DISTRIB_DESCRIPTION" "$(uname -o)" "$(uname -r)" "$(uname -m)"
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org17e074b" class="outline-3">
<h3 id="org17e074b"><span class="section-number-3">6.4</span> vdr-addon-lifeguardng</h3>
<div class="outline-text-3" id="text-6-4">
</div>
<div id="outline-container-orgbb9aada" class="outline-4">
<h4 id="orgbb9aada"><span class="section-number-4">6.4.1</span> variables</h4>
<div class="outline-text-4" id="text-6-4-1">
<div class="org-src-container">
<pre class="src src-yaml">lifeguard_enable_nfs: True
lifeguard_enable_samba: True
lifeguard_enable_ssh: True
lifeguard_hosts: []
lifeguard_users: []
lifeguard_processes: []
lifeguard_tcp:
  - vdr 3000
</pre>
</div>
</div>
</div>

<div id="outline-container-org57b5b0a" class="outline-4">
<h4 id="org57b5b0a"><span class="section-number-4">6.4.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-4-2">
<div class="org-src-container">
<pre class="src src-yaml">- name: apt | install vdr-addon-lifeguard-ng
  apt:
    name: vdr-addon-lifeguard-ng
    state: present
    
- name: expand template for vdr-addon-lifeguard-ng configuration file
  template:
    src: templates/lifeguard.conf.j2
    dest: /etc/lifeguard.conf
  notify: Restart vdr-addon-lifeguard-ng
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeb07384" class="outline-4">
<h4 id="orgeb07384"><span class="section-number-4">6.4.3</span> templates</h4>
<div class="outline-text-4" id="text-6-4-3">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

[Options]
EnableNFS = {{ lifeguard_enable_nfs }}
EnableSamba = {{ lifeguard_enable_samba }}
EnableSSH = {{ lifeguard_enable_ssh }}
[Hosts]
# ping hostnames or IP addresses (which are faster than hostnames)
# Caution: pinging hosts can be quite slow!
{% for host in lifeguard_hosts %}
{{ host }}
{% endfor %}
[Process]
# one process name per line
{% for process in lifeguard_processes %}
{{ process }}
{% endfor %}
[User]
# one user name per line
{% for user in lifeguard_users %}
{{ user }}
{% endfor %}
[TCP]
# process name [:] &lt;port&gt; [&lt;another port&gt;]
{% for connection in lifeguard_tcp %}
{{ connection }}
{% endfor %}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfca8bfe" class="outline-3">
<h3 id="orgfca8bfe"><span class="section-number-3">6.5</span> collect facts about the system with custom modules</h3>
<div class="outline-text-3" id="text-6-5">
</div>
<div id="outline-container-orgde3a162" class="outline-4">
<h4 id="orgde3a162"><span class="section-number-4">6.5.1</span> variables</h4>
<div class="outline-text-4" id="text-6-5-1">
<div class="org-src-container">
<pre class="src src-yaml">
</pre>
</div>
</div>
</div>
<div id="outline-container-org7346617" class="outline-4">
<h4 id="org7346617"><span class="section-number-4">6.5.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-5-2">
</div>
<ol class="org-ol">
<li><a id="org68f22e4"></a>main.yml<br />
<div class="outline-text-6" id="text-6-5-2-0-1">
<div class="org-src-container">
<pre class="src src-yaml">- name: get information about usb and pci hardware and loaded kernel modules
  hardware_facts:
    usb: True
    pci: True
    serial: True
    modules: True
    gpus: True
    acpi_power_modes: True
  tags:
    - always

- debug:
    var: '{{ item }}'
    verbosity: 1
  loop:
    - usb
    - pci
    - serial
    - gpus
    - modules
    - acpi_power_modes
    - nvidia_detected
    - intel_detected
    - amd_detected
    - virtualbox_detected

- name: get detailed PCI device information
  pci_facts:
  tags:
    - always

- debug:
    var: pci_devices
    verbosity: 1

- name: known vdr output plugins
  set_fact:
    vdr_output_plugins:
      - softhddevice
      - xineliboutput
      - xine
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org36468f1" class="outline-3">
<h3 id="org36468f1"><span class="section-number-3">6.6</span> vdr</h3>
<div class="outline-text-3" id="text-6-6">
<div class="org-src-container">
<pre class="src src-yaml">streamdev_client_remote_ip: ''
</pre>
</div>
</div>
<div id="outline-container-org3b95872" class="outline-4">
<h4 id="org3b95872"><span class="section-number-4">6.6.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-6-1">
</div>
<ol class="org-ol">
<li><a id="org83f6e3b"></a>install the basic vdr packages<br />
<div class="outline-text-5" id="text-6-6-1-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/vdr/tasks/main.yml

- name: apt | install basic vdr packages
  apt:
    name:
      - vdr
      - vdrctl
      - vdr-plugin-dbus2vdr
    state: present
    install_recommends: no
</pre>
</div>
</div>
</li>
<li><a id="org4b0773e"></a>Add svdrp/svdrp-disc to /etc/services<br />
<div class="outline-text-5" id="text-6-6-1-2">
<div class="org-src-container">
<pre class="src src-yaml">- name: add svdrp and svdrp-disc to /etc/services
  lineinfile:
    dest: /etc/services
    state: present
    line: "{{ item }}"
  loop:
    - "svdrp            6419/tcp"
    - "svdrp-disc       6419/udp"
</pre>
</div>
</div>
</li>
<li><a id="orgf8cb196"></a>Set up the recording directory for the vdr user<br />
<div class="outline-text-5" id="text-6-6-1-3">
<div class="org-src-container">
<pre class="src src-yaml">- name: create vdr recdir
  file:
    state: directory
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: 0775
    dest: '{{ vdr.recdir }}'

- name: set vdr charset override
  template:
    src: templates/conf.d/02-vdr-charset-override.conf.j2
    dest: /etc/vdr/conf.d/02-vdr-charset-override.conf

- name: set option to use hide-first-recording-level patch
  template:
    src: templates/conf.d/04-vdr-hide-first-recordinglevel.conf.j2
    dest: /etc/vdr/conf.d/04-vdr-hide-first-recordinglevel.conf

- name: create local dir in recdir
  file:
    state: directory
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: '0775'
    dest: '{{ vdr.recdir }}/local'
  when:
    vdr.hide_first_recording_level

# TODO: set recdir, user etc. in /etc/vdr/conf.d/
</pre>
</div>
</div>
</li>
<li><a id="org5b988db"></a>Install additional vdr plugins<br />
<div class="outline-text-5" id="text-6-6-1-4">
<p>
The additional plugins to install can be set in the variable <code>{{vdr_plugins}}</code> in the group variables
</p>
<div class="org-src-container">
<pre class="src src-yaml">- name: apt | install additional vdr plugins
  apt:
    name: '{{ vdr_plugins | default([]) }}'
    state: present
    install_recommends: no
  notify: [ 'Restart VDR' ]
</pre>
</div>
</div>
</li>
<li><a id="org58e8038"></a>create or copy vdr configuration files<br />
<div class="outline-text-5" id="text-6-6-1-5">
<p>
Because some files are changed by the vdr at runtime, we won&rsquo;t overwrite them if the task is marked with <code>force: no</code>.
</p>
<div class="org-src-container">
<pre class="src src-yaml">- name: ensure vdr is stopped
  systemd:
    name: vdr.service
    state: stopped
  notify: [ 'Start VDR' ]

- name: "vdr configuration | copy remote.conf if it doesn't exist yet"
  copy:
    src: files/remote.conf
    dest: '{{ vdr.confdir }}/remote.conf'
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: 0644
    force: no

- name: "vdr configuration | copy keymacros.conf"
  copy:
    src: files/keymacros.conf
    dest: '{{ vdr.etc_confdir }}/keymacros.conf'
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: 0644
    force: yes

- name: "vdr configuration | copy channels.conf if it doesn't exist yet"
  copy:
    src: '{{ vdr_channels_conf }}'
    dest: '{{ vdr.confdir }}/channels.conf'
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: 0644
    force: no
  when: vdr_channels_conf is defined

- name: "vdr configuration | download channels.conf if it doesn't exist yet"
  get_url:
    url: '{{ vdr_channels_conf_url }}'
    dest: '{{ vdr.confdir }}/channels.conf'
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: 0644
    force: no
  when: vdr_channels_conf is not defined and vdr_channels_conf_url is defined

- name: "vdr configuration | svdrphosts.conf"
  template:
    src: templates/svdrphosts.conf.j2
    dest: '{{ vdr.etc_confdir }}/svdrphosts.conf'
    mode: 0644
  vars:
    svdrphosts: '{{ vdr_svdrphosts | default(vdr_allowed_hosts) }}'

- name: "vdr configuration | /etc/default/vdr"
  template:
    src: templates/default_vdr.j2
    dest: /etc/default/vdr

</pre>
</div>
</div>
</li>
<li><a id="org5889473"></a>plugin preconfiguration<br />
<div class="outline-text-5" id="text-6-6-1-6">
<p>
Set up IP resp. IP range based access for VDR plugins
</p>
</div>
<ol class="org-ol">
<li><a id="org8046d81"></a>xineliboutput<br />
<div class="outline-text-6" id="text-6-6-1-6-1">
<div class="org-src-container">
<pre class="src src-yaml">- name: ensure directory '/etc/vdr/xineliboutput' exists
  file:
    state: directory
    mode: 0775
    dest: '/etc/vdr/plugins/xineliboutput'

- name: "vdr configuration | allowed_hosts.conf for xineliboutput"
  template:
    src: templates/generic_allowed_hosts.conf.j2
    dest: '/etc/vdr/plugins/{{ vdr_service }}/allowed_hosts.conf'
    mode: 0644
  vars:
    allowed_hosts: '{{ xineliboutput_allowed_hosts | default(vdr_allowed_hosts) }}'
    vdr_service: xineliboutput

- name: "vdr configuration | xineliboutput.conf host settings"
  template:
    src: templates/xineliboutput.conf.j2
    dest: /etc/vdr/conf.avail/xineliboutput.conf
    mode: 0644
  vars:
    allowed_hosts: '{{ xineliboutput_allowed_hosts | default(vdr_allowed_hosts) }}'

- name: "disable/enable wait-for-dvb@.service for configured devices"
  systemd:
    enabled: '{{ "yes" if item in wait_for_dvb_devices|default([]) else "no" }}'
    name: 'wait-for-dvb@{{ item }}.service'
  loop: "{{ range(max_num_dvb_devices|default(16))|list }}"
</pre>
</div>
</div>
</li>
<li><a id="org385b303"></a>vnsiserver<br />
<div class="outline-text-6" id="text-6-6-1-6-2">
<div class="org-src-container">
<pre class="src src-yaml">- name: ensure directory '/etc/vdr/plugins/vnsiserver' exists
  file:
    state: directory
    mode: 0775
    dest: '/etc/vdr/plugins/vnsiserver'

- name: "vdr configuration | allowed_hosts.conf for vnsiserver"
  template:
    src: templates/generic_allowed_hosts.conf.j2
    dest: '/etc/vdr/plugins/{{ vdr_service }}/allowed_hosts.conf'
    mode: 0644
  vars:
    allowed_hosts: '{{ vnsiserver_allowed_hosts | default(vdr_allowed_hosts) }}'
    vdr_service: vnsiserver

</pre>
</div>
</div>
</li>
<li><a id="orgda80ab8"></a>streamdev-server<br />
<div class="outline-text-6" id="text-6-6-1-6-3">
<div class="org-src-container">
<pre class="src src-yaml">- name: ensure directory '/etc/vdr/plugins' exists
  file:
    state: directory
    mode: 0775
    dest: '/etc/vdr/plugins/'

- name: "vdr configuration | streamdevhosts.conf for streamdev-server"
  template:
    src: templates/generic_allowed_hosts.conf.j2
    dest: '/etc/vdr/plugins/streamdevhosts.conf'
    mode: 0644
  vars:
    allowed_hosts: '{{ streamdev_server_allowed_hosts | default(vdr_allowed_hosts) }}'
    vdr_service: streamdev-server

</pre>
</div>
</div>
</li>
<li><a id="orgc2aad40"></a>streamdev-client<br />
<div class="outline-text-6" id="text-6-6-1-6-4">
<div class="org-src-container">
<pre class="src src-yaml">- name: install and configure streamdev-client
  block:
    - name: apt | install vdr-plugin-streamdev-client
      apt:
        state: '{{"present" if streamdev_client_remote_ip else "absent"}}'
        name: "vdr-plugin-streamdev-client"
    - name: set streamdev-client.RemoteIp
      lineinfile:
        state: '{{ "present" if streamdev_client_remote_ip else "absent" }}'
        owner: "{{ vdr.user }}"
        group: "{{ vdr.group }}"
        create: yes
        path : "{{ vdr.home }}/setup.conf"
        regexp: "^streamdev-client.RemoteIp"
        line: "streamdev-client.RemoteIp = {{ streamdev_client_remote_ip }}"
    
    - name: set streamdev-client.RemotePort
      lineinfile:
        owner: "{{ vdr.user }}"
        group: "{{ vdr.group }}"
        create: yes
        path : "{{ vdr.home }}/setup.conf"
        regexp: "^streamdev-client.RemotePort"
        line: "streamdev-client.RemotePort = {{streamdev_client_remote_port | default(2004)}}"

    - name: set streamdev-client.NumProvidedSystems
      lineinfile:
        owner: "{{  vdr.user  }}"
        group: "{{  vdr.group }}"
        create: yes
        path : "{{ vdr.home }}/setup.conf"
        regexp: "^streamdev-client.NumProvidedSystems"
        line: "streamdev-client.NumProvidedSystems = {{streamdev_client_num_provided_systems | default(1)}}"

    - name: set streamdev-client.StartClient
      lineinfile:
        owner: "{{ vdr.user }}"
        group: "{{ vdr.group }}"
        create: yes
        path : "{{ vdr.home }}/setup.conf"
        regexp: "^streamdev-client.StartClient"
        line: "streamdev-client.StartClient = {{ '1' if streamdev_client_remote_ip else '0' }}"
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org50e4b2b"></a>start vdr after network-online.target<br />
<div class="outline-text-5" id="text-6-6-1-7">
<div class="org-src-container">
<pre class="src src-yaml">- name: create directory for vdr.service systemd drop-in files
  file:
    dest: '{{ item }}'
    state: directory
  loop:
    - "/etc/systemd/system/vdr.service.d/"

- name: systemd-drop-in | start vdr.service after network-online.target
  template:
    src: templates/systemd/network-online.j2
    dest: /etc/systemd/system/vdr.service.d/network-online.conf

</pre>
</div>
</div>
</li>
<li><a id="org72998db"></a>create commands.conf entries<br />
<div class="outline-text-5" id="text-6-6-1-8">
<div class="org-src-container">
<pre class="src src-yaml">- name: create snippet with yavdr commands
  template:
    src: templates/command-hooks/commands.yavdr.conf.j2
    dest: /usr/share/vdr/command-hooks/commands.yavdr.conf
</pre>
</div>
</div>
</li>

<li><a id="orgb80495f"></a>create helper scripts<br />
<div class="outline-text-5" id="text-6-6-1-9">
<div class="org-src-container">
<pre class="src src-yaml">- name: create helper scripts for reccmds
  copy:
    src: files/reccmds/{{ item }}.sh
    dest: /usr/local/bin/{{ item }}
    mode: 0755
  loop:
    - removeindex
    - removemarks
    - removeresume
    - vdr-recrepeat
</pre>
</div>
</div>
</li>
<li><a id="orgf8ae867"></a>create reccmds snippets<br />
<div class="outline-text-5" id="text-6-6-1-10">
<div class="org-src-container">
<pre class="src src-yaml">- name: create snippet for yavdr reccmds to handle marks-, resume- and index-files
  template:
    src: files/reccmds.removemarks.conf.j2
    dest: /usr/share/vdr/command-hooks/reccmds.removemarks.conf

- name: create snippet for yavdr reccmds to search repeats using epgsearch
  template:
    src: files/reccmds.searchrepeats.conf.j2
    dest: /usr/share/vdr/command-hooks/reccmds.searchrepeats.conf
  when: '"vdr-plugin-epgsearch" in vdr_plugins'
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb1e1419" class="outline-4">
<h4 id="orgb1e1419"><span class="section-number-4">6.6.2</span> templates</h4>
<div class="outline-text-4" id="text-6-6-2">
</div>
<ol class="org-ol">
<li><a id="orga2ec56a"></a>vdr config snippets<br />
<div class="outline-text-5" id="text-6-6-2-1">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

{% if vdr.hide_first_recording_level | bool %}
[vdr]
--hide-first-recording-level
{% endif %}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
{% if vdr.override_vdr_charset | bool %}
[vdr]
--chartab={{ vdr.override_vdr_charset }}
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="orgeb5cdd3"></a>Systemd Drop-in to start vdr.service after network-online.target<br />
<div class="outline-text-5" id="text-6-6-2-2">
<div class="org-src-container">
<pre class="src src-conf">{{ansible_managed | comment }}
[Unit]
After=network-online.target
</pre>
</div>
</div>
</li>
<li><a id="org4f5244c"></a>/etc/default/vdr<br />
<div class="outline-text-5" id="text-6-6-2-3">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
# /etc/default/vdr
#
# See also /usr/share/doc/vdr/README.Debian.gz
#

SHUTDOWNCMD="{{ vdr_shutdown_command }}"
</pre>
</div>
</div>
</li>
<li><a id="orged83a71"></a>svdrphosts.conf<br />
<div class="outline-text-5" id="text-6-6-2-4">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
#
# svdrphosts    This file describes a number of host addresses that
#               are allowed to connect to the SVDRP port of the Video
#               Disk Recorder (VDR) running on this system.
# Syntax:
#
# IP-Address[/Netmask]
#
# Examples:
# 192.168.100.0/24     # any host on the local net
# 204.152.189.113      # a specific host
# 0.0.0.0/0            # any host on any net (USE THIS WITH CARE!)

127.0.0.1              # always accept localhost
{% for host_or_subnet in svdrphosts %}
{{ host_or_subnet }}
{% endfor %}

</pre>
</div>
</div>
</li>
<li><a id="org67cf479"></a>allowed_hosts.conf style template<br />
<div class="outline-text-5" id="text-6-6-2-5">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
# This file describes a number of host addresses that
# are allowed to connect to the {{ vdr_service }}
# running with the Video Disk Recorder (VDR) on this system.
#
# Syntax:
#
# IP-Address[/Netmask]
#
# Examples:
#
# 192.168.100.0/24     # any host on the local net
# 204.152.189.113      # a specific host
{% if vdr_service == 'streamdev-server' %}
# 239.255.0.0/16       # uncomment for IGMP multicast streaming
{% endif %}
# 0.0.0.0/0            # any host on any net (USE THIS WITH CARE!)

127.0.0.1              # always accept localhost
{% for host_or_subnet in allowed_hosts %}
{{ host_or_subnet }}
{% endfor %}
</pre>
</div>
</div>
</li>
<li><a id="org57e6a49"></a>xineliboutput.conf template<br />
<div class="outline-text-5" id="text-6-6-2-6">
<div class="org-src-container">
<pre class="src src-jinja2">#
# Command line parameters for vdr-plugin-xineliboutput
#
# For more details see:
#   - /usr/share/doc/vdr-plugin-xineliboutput/README.Debian
#   - `vdr --help -Pxineliboutput`
#   - /usr/share/doc/vdr-plugin-xineliboutput/README
#
[xineliboutput]
--local=none
--primary
--remote={{ "" if allowed_hosts else "127.0.0.1" }}:37890
--truecolor
</pre>
</div>
</div>
</li>
<li><a id="orge8167d0"></a>command-hooks<br />
<div class="outline-text-5" id="text-6-6-2-7">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
{{ "Update vdr recordings list" | translate }} : echo "/usr/bin/svdrpsend updr" | at now
{{ "Restart VDR" | translate }} : sudo /bin/systemctl --no-block restart vdr.service
{{ "Reboot system" | translate }} : sudo /bin/systemctl --no-block reboot
{{ "Shutdown system" | translate }} : echo "/usr/bin/lircd2uinput-send KEY_POWER2" | at now
</pre>
</div>
</div>
</li>
<li><a id="orgb82985a"></a>reccmds.removemarks.conf<br />
<div class="outline-text-5" id="text-6-6-2-8">
<p>
This is a snippet for the reccmds.conf. It adds some actions to remove marks, resume and index files.
</p>
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
{{ "Remove marks" | translate }} : /usr/local/bin/removemarks
{{ "Remove Index-File" | translate }} : /usr/local/bin/removeindex
{{ "Remove resume file" | translate }} : /usr/local/bin/removeresume
{{ "Mark advertisements" | translate }} : /usr/local/bin/markad -O "$1" after
</pre>
</div>
</div>
</li>
<li><a id="orgfacb791"></a>reccmds.searchrepeats.conf<br />
<div class="outline-text-5" id="text-6-6-2-9">
<p>
This is a snippet
</p>
<div class="org-src-container">
<pre class="src src-jinja2">{{ "Search for repeat" | translate }} : /usr/local/bin/vdr-recrepeat 0
{{ "Search for repeat with subtitle (same episode)" | translate }} : /usr/local/bin/vdr-recrepeat 1
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org5194975" class="outline-4">
<h4 id="org5194975"><span class="section-number-4">6.6.3</span> files</h4>
<div class="outline-text-4" id="text-6-6-3">
</div>
<ol class="org-ol">
<li><a id="org5c7d755"></a>remote.conf<br />
<div class="outline-text-5" id="text-6-6-3-1">
<div class="org-src-container">
<pre class="src src-conf">LIRC.Up KEY_UP
LIRC.Down KEY_DOWN
LIRC.Menu KEY_MENU
LIRC.Ok KEY_OK
LIRC.Back KEY_ESC
LIRC.Left KEY_LEFT
LIRC.Right KEY_RIGHT
LIRC.Red KEY_RED
LIRC.Green KEY_GREEN
LIRC.Yellow KEY_YELLOW
LIRC.Blue KEY_BLUE
LIRC.0 KEY_0
LIRC.1 KEY_1
LIRC.2 KEY_2
LIRC.3 KEY_3
LIRC.4 KEY_4
LIRC.5 KEY_5
LIRC.6 KEY_6
LIRC.7 KEY_7
LIRC.8 KEY_8
LIRC.9 KEY_9
LIRC.Info KEY_INFO
LIRC.Play KEY_PLAY
LIRC.Pause KEY_PAUSE
LIRC.Play/Pause KEY_PLAYPAUSE
LIRC.Stop KEY_STOP
LIRC.Record KEY_RECORD
LIRC.FastFwd KEY_FASTFORWARD
LIRC.FastRew KEY_REWIND
LIRC.Next KEY_NEXT
LIRC.Prev KEY_BACK
LIRC.Power KEY_POWER2
LIRC.Channel+ KEY_CHANNELUP
LIRC.Channel- KEY_CHANNELDOWN
LIRC.PrevChannel KEY_PREVIOUS
LIRC.Volume+ KEY_VOLUMEUP
LIRC.Volume- KEY_VOLUMEDOWN
LIRC.Mute KEY_MUTE
LIRC.Subtitles KEY_SUBTITLE
LIRC.Schedule KEY_EPG
LIRC.Channels KEY_CHANNEL
LIRC.Commands KEY_FAVORITES
LIRC.Audio KEY_MODE
LIRC.Timers KEY_TIME
LIRC.Recordings KEY_PVR
LIRC.Setup KEY_SETUP
LIRC.User0 KEY_TEXT
LIRC.User1 KEY_PROG1
LIRC.User2 KEY_PROG2
LIRC.User3 KEY_PROG3
LIRC.User4 KEY_PROG4
LIRC.User5 KEY_AUDIO
LIRC.User6 KEY_VIDEO
LIRC.User7 KEY_IMAGES
LIRC.User8 KEY_FN
LIRC.User9 KEY_SCREEN

XKeySym.Up         Up
XKeySym.Down       Down
XKeySym.Menu       Home
XKeySym.Menu       Tab
XKeySym.Menu       KP_Home
XKeySym.Ok         Return
XKeySym.Ok         KP_Enter
XKeySym.Back       BackSpace
XKeySym.Back       KP_Separator
XKeySym.Left       Left
XKeySym.Right      Right
XKeySym.Up         KP_Up
XKeySym.Down       KP_Down
XKeySym.Left       KP_Left
XKeySym.Right      KP_Right
XKeySym.Red        F1
XKeySym.Green      F2
XKeySym.Yellow     F3
XKeySym.Blue       F4
XKeySym.0          0
XKeySym.1          1
XKeySym.2          2
XKeySym.3          3
XKeySym.4          4
XKeySym.5          5
XKeySym.6          6
XKeySym.7          7
XKeySym.8          8
XKeySym.9          9
XKeySym.0          KP_0
XKeySym.1          KP_1
XKeySym.2          KP_2
XKeySym.3          KP_3
XKeySym.4          KP_4
XKeySym.5          KP_5
XKeySym.6          KP_6
XKeySym.7          KP_7
XKeySym.8          KP_8
XKeySym.9          KP_9
XKeySym.Info       End
XKeySym.Info       KP_End
XKeySym.Pause      F9
XKeySym.FastFwd    F6
XKeySym.FastRew    F5
XKeySym.Power      Pause
XKeySym.Volume+    F12
XKeySym.Volume-    F11
XKeySym.Volume+    KP_Add
XKeySym.Volume-    KP_Subtract
XKeySym.Mute       F10
XKeySym.User1      F5
XKeySym.User2      F6
XKeySym.User3      F7
XKeySym.User4      F8
XKeySym.User5      Print
XKeySym.User6      Scroll_Lock
XKeySym.User7      Insert
XKeySym.User8      KP_Divide
XKeySym.User9      KP_Multiply
XKeySym.Audio      Menu
XKeySym.Channel+   Prior
XKeySym.Channel-   Next
XKeySym.Channel+   KP_Prior
XKeySym.Channel-   KP_Next
XKeySym.Volume+    XF86AudioRaiseVolume
XKeySym.Volume-    XF86AudioLowerVolume
XKeySym.Mute       XF86AudioMute
XKeySym.Stop       XF86AudioStop
XKeySym.Play/Pause  XF86AudioPlay
XKeySym.Prev       XF86AudioPrev
XKeySym.Next       XF86AudioNext
</pre>
</div>
</div>
</li>
<li><a id="orgb17865b"></a>keymacros.conf<br />
<div class="outline-text-5" id="text-6-6-3-2">
<div class="org-src-container">
<pre class="src src-conf"># Remote control key macros for VDR
#
# Format:
#
# macrokey  key1 key2 key3...
# macrokey  @plugin key1 key2 key3...
#
# See man vdr(5)

Red       Recordings
Green     Schedule
Yellow    Info
Blue      Timers
User0     @osdteletext

User9     @xineliboutput Red 4   # toggle autocrop
User9     @softhddevice Blue 2 5 # toggle autocrop


</pre>
</div>
</div>
</li>
<li><a id="org9717ac4"></a>VDR helper scripts<br />
<ol class="org-ol">
<li><a id="org1b7f9e0"></a>removeresume<br />
<div class="outline-text-6" id="text-6-6-3-3-1">
<p>
This script deletes all <code>resume</code> and <code>resume.*</code> files of the given recording
</p>
<div class="org-src-container">
<pre class="src src-shell">#!/bin/dash
find "$1" -maxdepth 1 -type f -name "resume" -o name "resume.*" -delete
</pre>
</div>
</div>
</li>
<li><a id="orge28a559"></a>removeindex<br />
<div class="outline-text-6" id="text-6-6-3-3-2">
<p>
This script deletes all <code>index</code> and <code>index.vdr</code> files of the given recording
</p>
<div class="org-src-container">
<pre class="src src-shell">#!/bin/dash
find "$1" -maxdepth 1 -name "index" -o -name "index.vdr" -delete
</pre>
</div>
</div>
</li>
<li><a id="orgd2f728b"></a>removemarks<br />
<div class="outline-text-6" id="text-6-6-3-3-3">
<p>
This script deletes all <code>marks</code> and <code>marks.vdr</code> files of the given recording
</p>
<div class="org-src-container">
<pre class="src src-shell">#!/bin/dash
find "$1" -maxdepth 1 -name "marks" -o -name "marks.vdr" -delete
</pre>
</div>
</div>
</li>
<li><a id="org202028f"></a>recrepeat<br />
<div class="outline-text-6" id="text-6-6-3-3-4">
<p>
This script allows to search for repeats of a recording using epgsearch
</p>
<div class="org-src-container">
<pre class="src src-shell">#!/bin/bash
#------------------------------------------------------------------------------
# this script allows searching for a repeat of a recording using epgsearch
# add the following lines to your reccmds.conf
#
# Search for repeat : /path_to_this_script/recrep.sh 0
# Search for repeat with subtitle (same episode): /path_to_this_script/recrep.sh 1
#
# Author: Christian Wieninger (cwieninger@gmx.de)
# Version: 1.1 - 2011-01-16
#
# changed for yavdr (steffenbpunkt@gmail.com)
#
# requirements: grep
#------------------------------------------------------------------------------

# adjust the following lines to your config

# your plugins config dir
PLUGINCONFDIR=/var/lib/vdr/plugins/epgsearch

# do not edit below this line

cat &lt;&lt; EOM &gt;/tmp/cmd.sh
INFOFILE="$2/info";

TITLE=\$(grep '^T ' \$INFOFILE);
#cut leading 'T '
TITLE=\${TITLE#*\$T };

EPISODE=\$(grep '^S ' \$INFOFILE)
#cut leading 'S '
EPISODE=\${EPISODE#*\$S };

SEARCHTERM=\$TITLE;

if [ "$1" -eq "1" ]; then
SEARCHTERM=\$TITLE~\$EPISODE;
fi

RCFILE=$PLUGINCONFDIR/.epgsearchrc
echo Search=\$SEARCHTERM &gt; \$RCFILE
#search for this term as phrase
echo SearchMode=0 &gt;&gt; \$RCFILE
if [ "$1" -eq "0" ]; then
    echo UseSubtitle=0 &gt;&gt; \$RCFILE;
fi
echo UseDescr=0 &gt;&gt; \$RCFILE
vdr-dbus-send /Remote remote.CallPlugin string:'epgsearch'
EOM

echo ". /tmp/cmd.sh; rm /tmp/cmd.sh" | at now
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="outline-container-orga33ee81" class="outline-3">
<h3 id="orga33ee81"><span class="section-number-3">6.7</span> yavdr-network</h3>
<div class="outline-text-3" id="text-6-7">
</div>
<div id="outline-container-org6b3f96e" class="outline-4">
<h4 id="org6b3f96e"><span class="section-number-4">6.7.1</span> default variables</h4>
<div class="outline-text-4" id="text-6-7-1">
<div class="org-src-container">
<pre class="src src-yaml">install_avahi: true
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd5c9424" class="outline-4">
<h4 id="orgd5c9424"><span class="section-number-4">6.7.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-7-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# this playbook sets up network services for a yaVDR installation

- name: apt | install packages for network services
  apt:
      name:
          - avahi-daemon
          - avahi-utils
          #- biosdevname # caution: this may change device names after a minimal installation!
          - ethtool
          - nfs-common
          - vdr-addon-avahi-linker
          - wakeonlan
      state: present
      install_recommends: no

# Does this really work? We need a way to check if an interface supports WOL - Python Skript?
# - name: check WOL capabilities of network interfaces
#   shell: 'ethtool {{ item }} | grep -Po "(?&lt;=Supports\sWake-on:\s).*$"'
#   register: wol
#   with_items: '{% for interface in ansible_interfaces if interface != 'lo' and interface != 'bond0' %}'

- name: restart autofs if running
  systemd:
    name: autofs
    state: restarted
    enabled: yes
    masked: no

- name: ensure autofs is running
  systemd:
    name: autofs
    state: started
    enabled: yes
    masked: no

- name: restart avahi-linker if running
  systemd:
    name: avahi-linker
    state: restarted
    enabled: yes
    masked: no

- name: ensure avahi-linker is started
  systemd:
    name: avahi-linker
    state: started
    enabled: yes
    masked: no

- name: ensure additional services for avahi-linker are active
  systemd:
    name: '{{ item }}'
    state: started
    enabled: yes
    masked: no
  loop:
    - vdr-net-monitor
    - vdr-update-monitor
    - prevent-umount-on-pause
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf19435e" class="outline-3">
<h3 id="orgf19435e"><span class="section-number-3">6.8</span> vdr-plugin-menuorg</h3>
<div class="outline-text-3" id="text-6-8">
<p>
The menuorg plugin provides a more organized osd menu and allows to sort entries for plugins, vdr menu entries and custom commands using submenus. You can customize the <code>menuorg.xml</code> template to your liking. Please remember that the <code>translate</code> filter requires the localization data from the package <code>yavdr-i18n</code> on the device which executes the ansible playbook (this package is installed by default when running the <code>install-yavdr.sh</code> script).
</p>
</div>
<div id="outline-container-orgfa6e47e" class="outline-4">
<h4 id="orgfa6e47e"><span class="section-number-4">6.8.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-8-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/vdr-plugin-menuorg/tasks/main.yml

- name: apt | install vdr-plugin-menuorg
  apt:
    name:
      - vdr-plugin-menuorg
    state: present
    install_recommends: no

- name: create /var/lib/vdr/plugins/menuorg.xml
  template:
    src: templates/menuorg.xml.j2
    dest: /var/lib/vdr/plugins/menuorg.xml
    owner: "{{ vdr.user }}"
    group: "{{ vdr.group }}"
    mode: 0644
</pre>
</div>
</div>
</div>
<div id="outline-container-org7cecf35" class="outline-4">
<h4 id="org7cecf35"><span class="section-number-4">6.8.2</span> templates</h4>
<div class="outline-text-4" id="text-6-8-2">
<div class="org-src-container">
<pre class="src src-jinja2">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
{{ ansible_managed | comment('xml') }}
&lt;!--
This is the config file for the Menuorg plug-in.
See /usr/share/doc/vdr-plugin-menurg for examples and a full
description of the config file format.
--&gt;
&lt;menus&gt;
    &lt;system name="Schedule" /&gt;
    &lt;system name="Channels" /&gt;
    &lt;menu name="{{ "Timer" | translate }}"&gt;
        &lt;system name="Timers" /&gt;
        &lt;plugin name="epgsearchonly" /&gt;
        &lt;plugin name="quickepgsearch" /&gt;
        &lt;plugin name="conflictcheckonly" /&gt;
    &lt;/menu&gt;
    &lt;menu name="{{ "Video"| translate }}"&gt;
        &lt;system name="Recordings" /&gt;
        &lt;plugin name="extrecmenu" /&gt;
        &lt;plugin name="extrecmenung" /&gt;
        &lt;plugin name="burn" /&gt;
        &lt;plugin name="dvdswitch" /&gt;
        &lt;plugin name="dvdselect" /&gt;
        &lt;plugin name="dvd" /&gt;
        &lt;plugin name="xineliboutput" /&gt;
        &lt;plugin name="mplayer" /&gt;
        &lt;plugin name="mpv" /&gt;
        &lt;plugin name="markad" /&gt;
        &lt;plugin name="recsearch" /&gt;
        &lt;plugin name="recstatus" /&gt;
        &lt;plugin name="webvideo" /&gt;
        &lt;plugin name="vodcatcher" /&gt;
        &lt;plugin name="vcd" /&gt;
        &lt;plugin name="undelete" /&gt;
    &lt;/menu&gt;
    &lt;menu name="{{ "Audio" | translate }}" &gt;
        &lt;plugin name="mp3" /&gt;
        &lt;plugin name="music" /&gt;
        &lt;plugin name="lastfm" /&gt;
        &lt;plugin name="radio" /&gt;
        &lt;plugin name="radiolist" /&gt;
        &lt;plugin name="cdda" /&gt;
        &lt;plugin name="cdplayer" /&gt;
        &lt;plugin name="podcatcher" /&gt;
        &lt;plugin name="karaoke" /&gt;
    &lt;/menu&gt;
    &lt;plugin name="tvguide" /&gt;
    &lt;plugin name="tvguideng" /&gt;
    &lt;plugin name="desktop" title="{{ 'Applications' | translate }}" /&gt;
    &lt;command name="Kodi" execute="frontend-dbus-send switchto kodi" /&gt;
    &lt;menu name="{{ 'System' | translate }}"&gt;
        &lt;system name="Commands" /&gt;
        &lt;system name="Setup" /&gt;
        &lt;plugin name="devstatus" /&gt;
        &lt;plugin name="systeminfo" /&gt;
        &lt;plugin name="femon" /&gt;
        &lt;plugin name="filebrowser" /&gt;
        &lt;plugin name="osd2web" /&gt;
        &lt;plugin name="pin" /&gt;
        &lt;plugin name="epg2vdr" /&gt;
        &lt;plugin name="scraper2vdr" /&gt;
        &lt;plugin name="sndctl" /&gt;
        &lt;plugin name="pulsecontrol" /&gt;
        &lt;plugin name="dynamite" /&gt;
        &lt;plugin name="softhdcuvid" /&gt;
        &lt;plugin name="softhddevice" /&gt;
        &lt;plugin name="vaapidevice" /&gt;
        &lt;plugin name="streamdev-client" /&gt;
        &lt;plugin name="streamdev-server" /&gt;
        &lt;plugin name="suspendoutput" /&gt;
    &lt;/menu&gt;
    &lt;plugin name="trayopenng" /&gt;
    &lt;plugin name="undelete" /&gt;
&lt;/menus&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org238ccfd" class="outline-3">
<h3 id="org238ccfd"><span class="section-number-3">6.9</span> nfs-server</h3>
<div class="outline-text-3" id="text-6-9">
</div>
<div id="outline-container-org5de931a" class="outline-4">
<h4 id="org5de931a"><span class="section-number-4">6.9.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-9-1">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: install nfs server packages
  apt:
    name:
      - nfs-kernel-server
      - nfs-common
    state: present
    install_recommends: no

- name: create /etc/exports
  template:
    src: templates/nfs-exports.j2
    dest: /etc/exports
  notify: [ 'Restart NFS Kernel Server' ]

- name: populate /etc/avahi/services
  template:
    src: templates/avahi/service.j2
    dest: '/etc/avahi/services/yavdr-{{ item.key }}.service'
  loop: '{{ media_dirs|dict2items }}'
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfcddaac" class="outline-4">
<h4 id="orgfcddaac"><span class="section-number-4">6.9.2</span> templates</h4>
<div class="outline-text-4" id="text-6-9-2">
</div>
<ol class="org-ol">
<li><a id="org67deabb"></a>/etc/exports<br />
<div class="outline-text-5" id="text-6-9-2-1">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}
{% set global = namespace(fsid=0) %}
/srv *(rw,fsid=0,sync,no_subtree_check,all_squash,anongid={{ vdr.gid }},anonuid={{ vdr.uid }})
{% for name, path in media_dirs.items() | list %}
{{ path }} *(rw,fsid={{ loop.index }},sync,no_subtree_check,all_squash,anongid={{ vdr.gid }},anonuid={{ vdr.uid }}{{ ',insecure' if nfs.insecure else '' }})
{% set global.next_fsid = (loop.index + 1) %}
{% endfor %}
{% if vdr.hide_first_recording_level %}
{{ vdr.recdir }}/local  *(rw,fsid={{ global.next_fsid }},sync,no_subtree_check,all_squash,anongid={{ vdr.gid }},anonuid={{ vdr.uid }}{{ ',insecure' if nfs.insecure else '' }})
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="org3625c6e"></a>avahi services<br />
<div class="outline-text-5" id="text-6-9-2-2">
<div class="org-src-container">
<pre class="src src-xml">&lt;?xml version="1.0" standalone='no'?&gt;
&lt;!DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt;
{{ ansible_managed | comment('xml') }}
&lt;service-group&gt;
&lt;name replace-wildcards="yes"&gt;{{ item.key|capitalize }} on %h&lt;/name&gt; ## Name
&lt;service&gt;
       &lt;type&gt;_nfs._tcp&lt;/type&gt;
       &lt;port&gt;2049&lt;/port&gt;
       &lt;txt-record&gt;path={{ item.value }}{{ "/local" if (item.key == "recordings" and vdr.hide_first_recording_level | bool) else "" }}&lt;/txt-record&gt; ## path to shared Folder
       &lt;txt-record&gt;subtype={{ 'vdr' if item.key == 'recordings' else item.key }}&lt;/txt-record&gt; ## subtype
&lt;/service&gt;
&lt;/service-group&gt;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org8912ed2" class="outline-3">
<h3 id="org8912ed2"><span class="section-number-3">6.10</span> yavdr-remote</h3>
<div class="outline-text-3" id="text-6-10">
<p>
The role <code>yavdr-remote</code> sets up the foundation for using eventlircd, lircd2uinput and the pre-configuration for remote receivers which can be detected by udev.
</p>
</div>
<div id="outline-container-orgc7bab81" class="outline-4">
<h4 id="orgc7bab81"><span class="section-number-4">6.10.1</span> default variables</h4>
<div class="outline-text-4" id="text-6-10-1">
<div class="org-src-container">
<pre class="src src-yaml">lircd0_socket: /var/run/lirc/lircd0
</pre>
</div>
</div>
</div>
<div id="outline-container-orga3fb007" class="outline-4">
<h4 id="orga3fb007"><span class="section-number-4">6.10.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-10-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# This role is used to set up the yaVDR remote control configuration.

- name: apt | install packages for remote support
  apt:
    name:
      - yavdr-remote
      - lirc
    state: present
  tags:
    - packages

- name: add systemd drop-in for lircd to use lircd2uinput
  block:
    - name: create directory /etc/systemd/system/lircd.service.d/
      file:
        path: /etc/systemd/system/lircd.service.d/
        state: directory
    - name: expand template for /etc/systemd/system/lircd.service.d/lircd2uinput.conf
      template:
        src: templates/lircd.service.d/lircd2uinput.conf.j2
        dest: /etc/systemd/system/lircd.service.d/lircd2uinput.conf
  tags:
    - config

- name: stop, mask and disable lircd.socket, lircd.service, lircmd.service and lircd-uinput.service # (the default lirc configuration conflicts with eventlircd)
  systemd:
    name: '{{ item }}'
    enabled: no
    state: stopped
    masked: yes
  loop:
    - lircd.service
    - lircd.socket
    - lircmd.service
    - lircd-uinput.service
  ignore_errors: yes
  tags:
    - systemd

- name: apt | install eventlircd and lircd2uinput
  apt:
    name:
      - eventlircd
      - lircd2uinput
    state: present
  tags:
    - packages

- name: configure vdr to read from a lircd-compatible socket
  template:
    src: templates/03-vdr-lirc.conf.j2
    dest: /etc/vdr/conf.d/03-vdr-lirc.conf
  notify: ['Restart VDR']
  tags:
    - config

- name: expand template for /etc/rc_maps.cfg
  template:
    src: templates/rc_maps.cfg.j2
    dest: /etc/rc_maps.cfg
  notify: ['Trigger Udev']
  tags:
    - config
</pre>
</div>
</div>
</div>
<div id="outline-container-orga9a1a1e" class="outline-4">
<h4 id="orga9a1a1e"><span class="section-number-4">6.10.3</span> templates</h4>
<div class="outline-text-4" id="text-6-10-3">
</div>
<ol class="org-ol">
<li><a id="orgcf18776"></a>Systemd Drop-in to start vdr with lirc support<br />
<div class="outline-text-5" id="text-6-10-3-1">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}
{% if frontend != 'kodi' %}
[vdr]
--lirc=/var/run/lirc/lircd
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="orgb7e3647"></a>Systemd Drop-in to start lircd2uinput with lircd<br />
<div class="outline-text-5" id="text-6-10-3-2">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}
[Service]
ExecStartPost=/usr/bin/lircd2uinput-add /var/run/lirc/lircd0
ExecStopPost=/usr/bin/lircd2uinput-remove /var/run/lirc/lircd0
</pre>
</div>
</div>
</li>
<li><a id="org9957496"></a>create /etc/rc_maps.cfg<br />
<div class="outline-text-5" id="text-6-10-3-3">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}
#
# Keymaps table
#
# This table creates an association between a keycode file and a kernel
# driver. It can be used to automatically override a keycode definition.
#
# Although not yet tested, it is mented to be added at udev.
#
# To use, you just need to run:
#	./ir-keytable -a
#
# Or, if the remote is not the first device:
#	./ir-keytable -a -s rc1		# for RC at rc1
#

# Format:
#	driver - name of the driver provided via uevent - use * for any driver
#	table -  RC keymap table, provided via uevent - use * for any table
#	file - file name. If directory is not specified, it will default to
#		/etc/rc_keymaps.
# For example:
# driver	table				file
# cx8800	*				./keycodes/rc5_hauppauge_new
# *		rc-avermedia-m135a-rm-jx	./keycodes/kworld_315u
# saa7134	rc-avermedia-m135a-rm-jx	./keycodes/keycodes/nec_terratec_cinergy_xs
# em28xx	*				./keycodes/kworld_315u
# *		*				./keycodes/rc5_hauppauge_new

# Table to automatically load the rc maps for the bundled IR's provided with the
# devices supported by the linux kernel

#driver table                    file
ite-cir     rc-rc6-mce          /lib/udev/rc_keymaps/rc-rc6-mce
nuvoton-cir rc-rc6-mce          /lib/udev/rc_keymaps/rc-rc6-mce
serial_ir   rc-rc6-mce          /lib/udev/rc_keymaps/rc-rc6-mce
mceusb      rc-rc6-mce          /lib/udev/rc_keymaps/HOPLOrc6

# Hauppauge PVR 350
ir-kbd-i2c  rc-hauppauge	/lib/udev/rc_keymaps/rc-hauppauge

# imon-pad
imon        rc-imon-mce         /lib/udev/rc_keymaps/rc-imon-mce
imon        rc-imon-pad         /lib/udev/rc_keymaps/rc-imon-pad

# TT-1500/1501
budget_ci   rc-tt-1500          /lib/udev/rc_keymaps/rc-tt-1501


# Skystarhd2
mantis_core * /lib/udev/rc_keymaps/skystarhd2

# Medion X10
ati_remote    rc-medion-x10              /lib/udev/rc_keymaps/rc-medion-x10
ati_remote    rc-medion-x10-or2x         /lib/udev/rc_keymaps/rc-medion-x10-or2x
ati_remote    rc-medion-x10-digitainer   /lib/udev/rc_keymaps/rc-medion-x10-digitainer

# other devices (which still mostly need a customized keymap for yaVDR)
*	rc-adstech-dvb-t-pci     adstech_dvb_t_pci
*	rc-alink-dtu-m           alink_dtu_m
*	rc-anysee                anysee
*	rc-apac-viewcomp         apac_viewcomp
*	rc-asus-pc39             asus_pc39
*	rc-asus-ps3-100          asus_ps3_100
*	rc-ati-tv-wonder-hd-600  ati_tv_wonder_hd_600
*	rc-ati-x10               ati_x10
*	rc-avermedia-a16d        avermedia_a16d
*	rc-avermedia-cardbus     avermedia_cardbus
*	rc-avermedia-dvbt        avermedia_dvbt
*	rc-avermedia-m135a       avermedia_m135a
*	rc-avermedia-m733a-rm-k6 avermedia_m733a_rm_k6
*	rc-avermedia-rm-ks       avermedia_rm_ks
*	rc-avermedia             avermedia
*	rc-avertv-303            avertv_303
*	rc-azurewave-ad-tu700    azurewave_ad_tu700
*	rc-behold-columbus       behold_columbus
*	rc-behold                behold
*	rc-budget-ci-old         budget_ci_old
*	rc-cec                   cec
*	rc-cinergy-1400          cinergy_1400
*	rc-cinergy               cinergy
*	rc-delock-61959          delock_61959
*	rc-dib0700-nec           dib0700_nec
*	rc-dib0700-rc5           dib0700_rc5
*	rc-digitalnow-tinytwin   digitalnow_tinytwin
*	rc-digittrade            digittrade
*	rc-dm1105-nec            dm1105_nec
*	rc-dntv-live-dvb-t       dntv_live_dvb_t
*	rc-dntv-live-dvbt-pro    dntv_live_dvbt_pro
*	rc-dtt200u               dtt200u
*	rc-dvbsky                dvbsky
*	rc-em-terratec           em_terratec
*	rc-encore-enltv-fm53     encore_enltv_fm53
*	rc-encore-enltv          encore_enltv
*	rc-encore-enltv2         encore_enltv2
*	rc-evga-indtube          evga_indtube
*	rc-eztv                  eztv
*	rc-flydvb                flydvb
*	rc-flyvideo              flyvideo
*	rc-fusionhdtv-mce        fusionhdtv_mce
*	rc-gadmei-rm008z         gadmei_rm008z
*	rc-genius-tvgo-a11mce    genius_tvgo_a11mce
*	rc-gotview7135           gotview7135
*       rc-hauppauge             /lib/udev/rc_keymaps/rc-hauppauge
*       rc-imon-mce              /lib/udev/rc_keymaps/rc-imon-mce
*       rc-imon-pad              /lib/udev/rc_keymaps/rc-imon-pad
*	rc-iodata-bctv7e         iodata_bctv7e
*	rc-it913x-v1             it913x_v1
*	rc-it913x-v2             it913x_v2
*	rc-kaiomy                kaiomy
*	rc-kworld-315u           kworld_315u
*	rc-kworld-pc150u         kworld_pc150u
*	rc-kworld-plus-tv-analog kworld_plus_tv_analog
*	rc-leadtek-y04g0051      leadtek_y04g0051
*	rc-lme2510               lme2510
*	rc-manli                 manli
#*	rc-medion-x10-digitainer medion_x10_digitainer
#*	rc-medion-x10-or2x       medion_x10_or2x
#*	rc-medion-x10            medion_x10
*	rc-msi-digivox-ii        msi_digivox_ii
*	rc-msi-digivox-iii       msi_digivox_iii
*	rc-msi-tvanywhere-plus   msi_tvanywhere_plus
*	rc-msi-tvanywhere        msi_tvanywhere
*	rc-nebula                nebula
*	rc-nec-terratec-cinergy-xs nec_terratec_cinergy_xs
*	rc-norwood               norwood
*	rc-npgtech               npgtech
*	rc-pctv-sedna            pctv_sedna
*	rc-pinnacle-color        pinnacle_color
*	rc-pinnacle-grey         pinnacle_grey
*	rc-pinnacle-pctv-hd      pinnacle_pctv_hd
*	rc-pixelview-002t        pixelview_002t
*	rc-pixelview-mk12        pixelview_mk12
*	rc-pixelview-new         pixelview_new
*	rc-pixelview             pixelview
*	rc-powercolor-real-angel powercolor_real_angel
*	rc-proteus-2309          proteus_2309
*	rc-purpletv              purpletv
*	rc-pv951                 pv951
*	rc-rc6-mce               /lib/udev/rc_keymaps/rc-rc6-mce
*	rc-real-audio-220-32-keys real_audio_220_32_keys
*	rc-reddo                 reddo
*	rc-snapstream-firefly    snapstream_firefly
*	rc-streamzap             streamzap
*	rc-su3000                su3000
*	rc-tbs-nec               tbs_nec
*	rc-technisat-ts35        technisat_ts35
*	rc-technisat-usb2        technisat_usb2
*	rc-terratec-cinergy-c-pci terratec_cinergy_c_pci
*	rc-terratec-cinergy-s2-hd terratec_cinergy_s2_hd
*	rc-terratec-cinergy-xs   terratec_cinergy_xs
*	rc-terratec-slim-2       terratec_slim_2
*	rc-terratec-slim         terratec_slim
*	rc-tevii-nec             tevii_nec
*	rc-tivo                  tivo
*	rc-total-media-in-hand-02 total_media_in_hand_02
*	rc-total-media-in-hand   total_media_in_hand
*	rc-trekstor              trekstor
*       rc-tt-1500          /lib/udev/rc_keymaps/rc-tt-1500
*	rc-twinhan-dtv-cab-ci    twinhan_dtv_cab_ci
*	rc-twinhan1027           twinhan_vp1027_dvbs
*	rc-videomate-k100        videomate_k100
*	rc-videomate-s350        videomate_s350
*	rc-videomate-tv-pvr      videomate_tv_pvr
*	rc-winfast-usbii-deluxe  winfast_usbii_deluxe
*	rc-winfast               winfast
# *	*			 a800                 # found in a800.c
# *	*			 af9005               # found in af9005-remote.c
# *	*			 cinergyt2            # found in cinergyT2-core.c
# *	*			 dvico_mce            # found in cxusb.c
# *	*			 dvico_portable       # found in cxusb.c
# *	*			 d680_dmb             # found in cxusb.c
# *	*			 dibusb               # found in dibusb-common.c
# *	*			 digitv               # found in digitv.c
# *	*			 megasky              # found in m920x.c
# *	*			 tvwalkerir-kbd-i2c   # found in m920x.c
# *	*			 pinnacle310e         # found in m920x.c
# *	*			 haupp                # found in nova-t-usb2.c
# *	*			 opera1               # found in opera1.c
# *	*			 vp702x               # found in vp702x.c
# *	*			 vp7045               # found in vp7045.c

</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org8daab2d" class="outline-3">
<h3 id="pulseaudio"><span class="section-number-3">6.11</span> pulseaudio</h3>
<div class="outline-text-3" id="text-pulseaudio">
</div>
<div id="outline-container-orged7268b" class="outline-4">
<h4 id="orged7268b"><span class="section-number-4">6.11.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-11-1">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: apt | install pulseaudio, pavucontrol and vdr-plugin-pulsecontrol
  apt:
    name:
      - pulseaudio
      - pavucontrol
      - vdr-plugin-pulsecontrol
    state: present
    install_recommends: no

- name: create /etc/asound.conf with pulseaudio as default device
  template:
    src: templates/alsa/asound.conf.j2
    dest: /etc/asound.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd1a0f7b" class="outline-4">
<h4 id="orgd1a0f7b"><span class="section-number-4">6.11.2</span> templates</h4>
<div class="outline-text-4" id="text-6-11-2">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}
# Use PulseAudio by default
pcm.!default {
  type pulse
  fallback "sysdefault"
  hint {
    show on
    description "Default ALSA Output (currently PulseAudio Sound Server)"
  }
}

ctl.!default {
  type pulse
  fallback "sysdefault"
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org99819bc" class="outline-3">
<h3 id="org99819bc"><span class="section-number-3">6.12</span> session-common</h3>
<div class="outline-text-3" id="text-6-12">
<p>
This role prepares a basic systemd user session
</p>
</div>
<div id="outline-container-orgb568c2a" class="outline-4">
<h4 id="orgb568c2a"><span class="section-number-4">6.12.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-12-1">
<div class="org-src-container">
<pre class="src src-yaml">---
- name: install required packages
  apt:
    name:
      - tmux

- name: create ~/.config/systemd/user
  file:
    path: "{{ vdr.home }}/.config/systemd/user"
    state: directory
    owner: "{{ vdr.user }}"
    group: "{{ vdr.user }}"
    mode: 0755

- name: create tmux.service for the session
  template:
    src: 'templates/systemd/user/tmux.service.j2'
    dest: '{{ vdr.home }}/.config/systemd/user/tmux.service'
    mode: 0644
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

</pre>
</div>
</div>
</div>
<div id="outline-container-orgc20fd1f" class="outline-4">
<h4 id="orgc20fd1f"><span class="section-number-4">6.12.2</span> templates</h4>
<div class="outline-text-4" id="text-6-12-2">
</div>
<ol class="org-ol">
<li><a id="org44acfe6"></a>tmux.service<br />
<div class="outline-text-5" id="text-6-12-2-1">
<div class="org-src-container">
<pre class="src src-systemd">[Unit]
Description=Start tmux in detached session

[Service]
EnvironmentFile=-%h/.session-env
Type=forking
WorkingDirectory=%h
ExecStart=/usr/bin/tmux new-session -s %u -d
ExecStop=/usr/bin/tmux kill-session -t %u
Restart=always

[Install]
WantedBy=default.target
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org6a3e1cd" class="outline-3">
<h3 id="org6a3e1cd"><span class="section-number-3">6.13</span> headless-session</h3>
<div class="outline-text-3" id="text-6-13">
</div>
<div id="outline-container-orgb96f840" class="outline-4">
<h4 id="orgb96f840"><span class="section-number-4">6.13.1</span> About the headless session</h4>
<div class="outline-text-4" id="text-6-13-1">
<p>
This configures a headless login session for the VDR user, so we can run services like udiskie in the context of a systemd user session.
</p>
</div>
</div>
<div id="outline-container-orgea83ffc" class="outline-4">
<h4 id="orgea83ffc"><span class="section-number-4">6.13.2</span> default variables</h4>
<div class="outline-text-4" id="text-6-13-2">
<div class="org-src-container">
<pre class="src src-yaml">enable_headless_session: true
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5f82e7" class="outline-4">
<h4 id="headless-meta"><span class="section-number-4">6.13.3</span> dependencies</h4>
<div class="outline-text-4" id="text-headless-meta">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>roles/headless-session/meta/main.yml</label><pre class="src src-yaml">---
dependencies:
    - role: session-common
    - role: udiskie
</pre>
</div>
</div>
</div>
<div id="outline-container-orgab88164" class="outline-4">
<h4 id="orgab88164"><span class="section-number-4">6.13.4</span> Tasks</h4>
<div class="outline-text-4" id="text-6-13-4">
</div>
<ol class="org-ol">
<li><a id="org815da8c"></a>main.yml<br />
<div class="outline-text-5" id="text-6-13-4-1">
<div class="org-src-container">
<pre class="src src-yaml">- name: create ~/.config
  file:
    path: "{{ vdr.home }}/.config"
    state: directory
    owner: "{{ vdr.user }}"
    group: "{{ vdr.user }}"
    mode: 0755

- name: expand template for ~/.config/headless-session
  template:
    src: templates/config/headless-session.j2
    dest: "{{ vdr.home }}/.config/headless-session"
    owner: "{{ vdr.user }}"
    group: "{{ vdr.group }}"
    mode: 0755

- name: expand template for headless-session@.service
  template:
    src: templates/systemd/headless-session@.service.j2
    dest: /etc/systemd/system/headless-session@.service
 
- name: start headless-session@.service for vdr user
  systemd:
    name: "headless-session@{{ vdr.user }}.service"
    state: started
    enabled: true
    masked: no

- name: enable services for the user session
  systemd:
    name: {{ item }}
    state: started
    masked: no
    enabled: yes
    scope: user
  become: yes
  become_user: vdr
  loop:
    - tmux.service
    - udiskie.service

- name: disable services for the user session
  systemd:
    name: {{ item }}
    state: started
    masked: no
    enabled: yes
    scope: user
  become: yes
  become_user: vdr
  loop:
    - detect-second-display.service
    - openbox-second.service
    - osd2web.service
    - pulseaudio.socket
    - pulseaudio.service
    - yavdr-frontend.service
    - wm-exit.service
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org8ad2efd" class="outline-4">
<h4 id="org8ad2efd"><span class="section-number-4">6.13.5</span> templates</h4>
<div class="outline-text-4" id="text-6-13-5">
</div>
<ol class="org-ol">
<li><a id="org5dea2eb"></a>Systemd Service<br />
<div class="outline-text-5" id="text-6-13-5-1">
<div class="org-src-container">
<pre class="src src-systemd">[Unit]
Description=headless login for user %i
After=systemd-user-sessions.service
Conflicts=getty@tty7.service

[Service]
User=%i
WorkingDirectory=~
TTYPath=/dev/tty7
PAMName=login
ExecStart=/bin/bash -l .config/headless-session

[Install]
WantedBy=graphical.target
</pre>
</div>
</div>
</li>
<li><a id="org83495d1"></a>Configuration file<br />
<div class="outline-text-5" id="text-6-13-5-2">
<div class="org-src-container">
<pre class="src src-shell">while :
do
    sleep infinity
done 
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org43b1976" class="outline-3">
<h3 id="org43b1976"><span class="section-number-3">6.14</span> udiskie</h3>
<div class="outline-text-3" id="text-6-14">
<p>
This role installs and preconfigures udiskie
</p>
</div>
<div id="outline-container-orgeb09af2" class="outline-4">
<h4 id="orgeb09af2"><span class="section-number-4">6.14.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-14-1">
<div class="org-src-container">
<pre class="src src-yaml">- name: install udiskie
  apt:
    name: udiskie
    state: present

- name: create ~/.config/udiskie
  file:
    name: '{{ vdr.home }}/.config/udiskie'
    state: directory
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: expand template for udiskie's config.yml
  template:
    src: templates/config.yml.j2
    dest: '{{ vdr.home }}/.config/udiskie/config.yml'


- name: create ~/.config/systemd/user
  file:
    name: '{{ vdr.home }}/.config/systemd/user'
    state: directory
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: expand template for udiskie's systemd unit
  template:
    src: templates/udiskie.service.j2
    dest: '{{ vdr.home }}/.config/systemd/user/udiskie.service'

- name: create ~/bin
  file:
    name: '{{ vdr.home }}/bin'
    state: directory
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: expand template for mount helper script
  template:
    src: templates/udiskie_vdr_mount_helper.j2
    dest: '{{ vdr.home }}/bin/udiskie_vdr_mount_helper'
    mode: 0755
    owner: vdr
    group: vdr

- name: expand template for udiskie vdr commands
  template:
    src: templates/umount_all.j2
    dest: /usr/share/vdr/command-hooks/commands.udiskie.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf84bfe2" class="outline-4">
<h4 id="orgf84bfe2"><span class="section-number-4">6.14.2</span> templates</h4>
<div class="outline-text-4" id="text-6-14-2">
</div>
<ol class="org-ol">
<li><a id="org10c0f33"></a>config.yml<br />
<div class="outline-text-5" id="text-6-14-2-1">
<div class="org-src-container">
<pre class="src src-shell">{{ ansible_managed | comment }}

program_options:
  tray:             false    # [bool] Enable the tray icon. "auto"
  menu:             flat    # ["flat" | "nested"] Set the
  automount:        true   # [bool] Enable automatic mounting.
  notify:           true    # [bool] Enable notifications.
  password_cache:   false      # [int] Password cache in minutes. Caching is

  file_manager:     ""
  notify_command: "{{ vdr.home }}/bin/udiskie_vdr_mount_helper '{event}' '{device_presentation}' '{mount_path}'"

device_config:
  - is_loop: true
    ignore: true

  - is_external: false
    ignore: true

notifications:
  device_mounted:   5       # mount notification
  device_unmounted: true   # unmount notification
  device_added:     true   # device has appeared
  device_removed:   true   # device has disappeared
</pre>
</div>
</div>
</li>
<li><a id="org1b67c11"></a>mount helper script<br />
<div class="outline-text-5" id="text-6-14-2-2">
<div class="org-src-container">
<pre class="src src-shell">{{ ansible_managed | comment }}

videodir="{{ vdr.recdir }}"
event="$1"
device_node="$2"
mount_path="$3"


logger -t "mount-notification" "event: $event, device: $device_node, mount_path: $mount_path"
case "$event" in
    'device_mounted')
        target="${videodir}/$(basename "${mount_path}")"
        ln -s -T "$mount_path" "$target" ||
            { logger -t "vdr recordings found" "mountpoint already exists, aborting"; exit; }
        # check if we got a vdr recording on the mountpoint
        if [ -n $(find "$mount_path" -name "*.rec" -print -quit 2&gt;/dev/null) ]
        then
            vdr-dbus-send /Skin skin.QueueMessage string:"$mount_path mounted (with recordings)"
            svdrpsend updr
        else
            vdr-dbus-send /Skin skin.QueueMessage string:"$mount_path' mounted"
        fi
        ;;
    'device_unmounted')
        removed_symlinks=($(find "$videodir" -xtype l -delete -print))
        logger -t "device umounted" "remove unneeded symlinks: $(paste -d " " &lt;&lt;&lt; "${removed_symlinks[@]}")"
        vdr-dbus-send /Skin skin.QueueMessage string:"$device_node umounted"
        svdrpsend updr
        ;;
    'device_removed')
        removed_symlinks=($(find "$videodir" -xtype l -delete -print))
        [ -z "$device_node" ] &amp;&amp; exit
        logger -t "device removed" "remove unneeded symlinks: $(paste -d " " &lt;&lt;&lt; "${removed_symlinks[@]}")"
        vdr-dbus-send /Skin skin.QueueMessage string:"$device_node removed"
        svdrpsend updr
        ;;
    'job_failed')
        if [ -n "$mount_path" ]
        then
            logger -t "umount failed" "could not unmount $mount_path"
        else
            logger -t "operation failed" 'could not mount(?) '"$device_node"
        fi
        ;;
esac
</pre>
</div>
</div>
</li>
<li><a id="orgef74d83"></a>udiskie snippet for commands.conf<br />
<div class="outline-text-5" id="text-6-14-2-3">
<div class="org-src-container">
<pre class="src src-shell">{{ ansible_managed | comment }}

{{ "Safely remove usb mass storage" | translate }} : echo 'svdrpsend mesg "$(udiskie-umount -a 2&gt;&amp;1 | grep -o "Error unmounting.*")"' | at now
</pre>
</div>
</div>
</li>
<li><a id="org443673a"></a>udiskie.service<br />
<div class="outline-text-5" id="text-6-14-2-4">
<div class="org-src-container">
<pre class="src src-shell">[Unit]
Description: dynamic mounts for the user session

[Service]
ExecStart=/usr/bin/udiskie

[Install]
WantedBy=default.target
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org1e81cb3" class="outline-3">
<h3 id="yavdr-xorg"><span class="section-number-3">6.15</span> yavdr-xorg</h3>
<div class="outline-text-3" id="text-yavdr-xorg">
</div>
<div id="outline-container-org33d3034" class="outline-4">
<h4 id="yavdr-xorg-about"><span class="section-number-4">6.15.1</span> About the GUI session</h4>
<div class="outline-text-4" id="text-yavdr-xorg-about">
<p>
The X-Server is started by using the two systemd units <code>xlogin@.service</code> and <code>x@.service</code> provided by the package <b>xlogin</b>. The former is enabled (and started) for the vdr user - which results (using the default settings for the user <b>vdr</b> with the uid <b>666</b>) in the activation of <code>xlogin@vdr.service</code> when reaching the graphical.target. To simplify starting and stopping the X-server and the desktop session a <code>yavdr-xorg.service</code> is provided by the package <code>yavdr-xorg</code>, which depends on the two units mentioned before.
</p>

<p>
<code>x@vt7.service</code> is started automatically as a dependency of <code>xlogin@vdr.service</code> and starts the X-server.  <code>xlogin@vdr.service</code> also starts a systemd user session using <code>user@666.service</code>.
In order to use the keyboard layout configured during installation for the X-Server we are using a script <code>write-x11-keyboard-config,</code> which reads the keyboard configuration from <code>/etc/default/keyboard</code> when starting <code>x@.service</code> and writes the file <code>/etc/X11/xorg.conf.d/00-keyboard.conf</code> (because systemd for Ubuntu (and Debian) has been patched not to automatically create the configuration file <code>/etc/X11/xorg.conf.d/00-keyboard.conf</code> according to the <code>localectl</code> settings).
</p>

<p>
To prevent stopping the X-server when vdr is running, additional dependencies are set up - see the drop-in rules created in <code>/etc/systemd/system/vdr.service.d/</code>.
</p>

<p>
Basic Services like the session DBus, pulseaudio etc. are started for the <code>default.target</code> of the session.
The openbox autostart script is used to update the systemd session with the needed session variables.  It creates a file <code>~/.session-env</code> which is used as an environment file by <code>vdr.service</code> (so the vdr knows the <b>DISPLAY</b> and can access pulseaudio).
</p>

<p>
The autostart script then enables all services to be pulled in by yavdr-desktop.target.  As the last step <code>yavdr-desktop.target</code> is startet, which results in staring <code>yavdr-frontend.service</code> and additional Units for a second display (openbox and a browser for osd2eb, if available).
</p>

<p>
In order to achive a clean shutdown of the session, <code>x@t7.service</code> is set as a dependency of the systemd unit instance <code>user@666.service</code> and all processes within the session must be shutdown properly when stopping <code>xlogin@vdr.service</code>.  If systemd units are used within the user session, they must stop their process(es) successfully (you should set them up to accept expected exit codes appropriately).  The window manager <i>openbox</i> is started using the <code>~/.xinitrc</code> and stopped using the systemd unit <code>exit-wm.service</code> (which runs on stopping the jobs pulled in by the <code>default.target</code> of the session).
</p>
</div>
</div>
<div id="outline-container-org8d2e461" class="outline-4">
<h4 id="yavdr-xorg-meta"><span class="section-number-4">6.15.2</span> dependencies</h4>
<div class="outline-text-4" id="text-yavdr-xorg-meta">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>roles/yavdr-xorg/meta/main.yml</label><pre class="src src-yaml">---
dependencies:
    - role: collect-facts
</pre>
</div>
</div>
</div>
<div id="outline-container-org12bd47c" class="outline-4">
<h4 id="yavdr-xorg-defaults"><span class="section-number-4">6.15.3</span> default variables</h4>
<div class="outline-text-4" id="text-yavdr-xorg-defaults">
<div class="org-src-container">
<pre class="src src-yaml">preferred_outputs:
  - HDMI
  - DP
  - DVI
  - VGA
  - TV
preferred_resolutions:
  - 7680x4320
  - 3840x2160
  - 1920x1080
  - 1280x720
  - 720x576
preferred_refreshrates:
  - 50
  - 60

intel_boot_options: ""
intel_set_boot_edid: false
nvidia_force_dpi: 0
</pre>
</div>
</div>
</div>
<div id="outline-container-org8b97d35" class="outline-4">
<h4 id="yavdr-xorg-tasks"><span class="section-number-4">6.15.4</span> tasks</h4>
<div class="outline-text-4" id="text-yavdr-xorg-tasks">
</div>
<ol class="org-ol">
<li><a id="orgd0af241"></a>main.yml<br />
<div class="outline-text-5" id="text-6-15-4-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/yavdr-xorg/tasks/main.yml
- import_tasks: setup-xorg.yml
  tags: [install,update]
- import_tasks: detect-xorg.yml
  tags: [xorg.detect,install]
</pre>
</div>
</div>
</li>
<li><a id="org0b166a7"></a>setup-xorg.yml<br />
<div class="outline-text-5" id="text-6-15-4-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/yavdr-xorg/tasks/setup-xorg.yml
- name: create directories for systemd drop-in files
  file:
    dest: '{{ item }}'
    state: directory
  loop:
    - "/etc/systemd/system/x@.service.d/"
    - "/etc/systemd/system/vdr.service.d/"
    - "/etc/systemd/system/user@{{ vdr.uid }}.service.d/"
    - "/etc/X11/xorg.conf.d/"

- name: systemd-drop-in | add dependency to X-server for vdr.service
  template:
    src: templates/vdr-xorg.conf
    dest: /etc/systemd/system/vdr.service.d/vdr-xorg.conf

- name: systemd-drop-in | start x@.service after plymouth.service
  template:
    src: templates/x@service.d/plymouth.conf.j2
    dest: /etc/systemd/system/x@.service.d/plymouth.conf

- name: systemd-drop-in | start x@.service before xlogin@.service
  template:
    src: templates/x@service.d/xlogin.conf.j2
    dest: /etc/systemd/system/x@.service.d/xlogin.conf

- name: systemd-drop-in | load environment file for vdr.service
  template:
    src: templates/systemd/vdr-environ.j2
    dest: /etc/systemd/system/vdr.service.d/load-environ.conf

- name: systemd-drop-in | user@{{ vdr.uid }}.service depends on x@vt7.service
  template:
    src: templates/user@666.service.d/x-dependency.conf.j2
    dest: '/etc/systemd/system/user@{{ vdr.uid }}.service.d/x-dependency.conf'

- name: vdr-config | create softhddevice.conf if it doesn't exist yet
  lineinfile:
    path: /etc/vdr/conf.avail/softhddevice.conf
    create: yes
    state: present
    line: '[softhddevice]'

- name: vdr-config | start softhddevice detached and set audio to pulseaudio
  lineinfile:
    path: /etc/vdr/conf.avail/softhddevice.conf
    line: '{{ item }}'
  loop:
      - '-D'
      - '-w alsa-driver-broken'
      # - '-a pulse' # do we need this with our existing asound.conf?

- name: vdr-config | use vaapi for softhddevice if we got an intel IGP
  lineinfile:
    path: /etc/vdr/conf.avail/softhddevice.conf
    line: '-v va-api'
    state: '{{ "present" if (not nvidia_detected and intel_detected) else "absent" }}'

- name: add a login shell for the user vdr
  user:
      name: '{{ vdr.user }}'
      shell: '/bin/bash'
      state: present
      uid: '{{ vdr.uid }}'
      groups: '{{ vdr.group }}'
      append: yes

- name: apt | install packages for xorg
  apt:
    name:
      - yavdr-xorg
      - python3-dbus2vdr
      - python3-yavdrfrontend
      - tmux
      - vdr-plugin-desktop
      - vdr-plugin-osd2web
      - feh
    state: present

- name: apt | install packages for Intel IGP
  apt:
    name:
      - i965-va-driver-shaders
    state: present
  when: intel_detected | bool and not nvidia_detected | bool

- name: Install yaVDR Media (e.g. Backgrounds)
  apt:
    name: yavdr-media

- name: command | write keyboard configuration to /etc/X11/xorg.conf.d/00-keyboard.conf
  command: write-x11-keyboard-config
  args:
    creates: /etc/X11/xorg.conf.d/00-keyboard.conf
  # NOTE: write-x11-keyboard-config is in the xlogin package
  # Ubuntu's systemd is patched, so it does not create the file automatically

- name: add snippet to ignore eventlircd devices in xorg
  template:
    src: templates/xorg-ignore-eventlircd.conf.j2
    dest: /etc/X11/xorg.conf.d/40-ignore-eventlircd.conf

- name: apt | install desktop programs
  apt:
    name:
      - xterm
      - firefox
      - kiosk-browser
    state: present
</pre>
</div>
</div>
</li>
<li><a id="orgcf7a23a"></a>detect-xorg.yml<br />
<div class="outline-text-5" id="text-6-15-4-3">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/yavdr-xorg/tasks/detect-xorg.yml

- name: "expand template for x-verbose@.service"
  template:
    src: "templates/systemd/system/x-verbose@.service.j2"
    dest: "/etc/systemd/system/x-verbose@.service"

- name: "expand template for xorg-verbose.conf"
  template:
    src: "templates/xorg-verbose.conf.j2"
    dest: "/etc/X11/xorg-verbose.conf"

- name: "remove intel snippet"
  file:
    path: /etc/X11/xorg.conf.d/20-intel.conf
    state: absent

- name: Stop VDR
  systemd:
    name: vdr.service
    state: stopped
    enabled: yes
  notify: ['Start VDR']

- name: Stop yavdr-xorg
  systemd:
    name: 'yavdr-xorg'
    state: stopped
    enabled: yes
  notify: ['Start yavdr-xorg']

- name: Stop xlogin
  systemd:
    name: 'xlogin@{{ vdr.user }}.service'
    state: stopped
  notify: ['Start xlogin']

- name: Stop x
  systemd:
    name: x@vt7.service
    state: stopped

- name: check /etc/yavdr/autoinstalled if a nvidia driver has been installed
  lineinfile:
    name: /etc/yavdr/autoinstalled
    regexp: '.*nvidia.*'
    state: absent
  check_mode: yes
  register: nvidia_driver_detected

- name: set_fact | nvidia_driver_installed
  set_fact:
    nvidia_driver_installed: '{{ nvidia_driver_detected.changed | bool }}'

- name: unload nouveau driver, replace with nvidia
  block:
    - name: unbind vconsole
      shell: echo 0 &gt; /sys/class/vtconsole/vtcon1/bind

    - name: "wait a little, so noveau isn't used anymore"
      wait_for:
        timeout: 1

    # unloading the drivers using the modprobe module does not work for some strange reason...
    - name: unload kms drivers
      rmmod:
        name: '{{ item }}'
      loop:
        - nouveau
        - ttm
        - drm_kms_helper
        - drm

    - name: load nvidia driver
      modprobe:
        name: "nvidia"
        state: present

    - name: "wait a little before starting nvidia-persistenced"
      wait_for:
        timeout: 1

    - name: start nvidia-persistenced
      systemd:
        name: "nvidia-persistenced"
        state: started
        enabled: true
        masked: false
        daemon_reload: true
      ignore_errors: yes
  when:
    - nvidia_detected | bool
    - nvidia_driver_installed | bool
    - '"nouveau" in modules'

- name: "start x-verbose@.service"
  systemd:
    name: "x-verbose@vt7.service"
    state: started
    enabled: false
    masked: false
    daemon_reload: true

- name: "wait a little, so X has some time to start up"
  wait_for:
    timeout: 3

- name: "detect xorg configuration"
  xrandr_facts:
    preferred_refreshrates: '{{ preferred_refreshrates }}'
    preferred_resolutions: '{{ preferred_resolutions }}'
    preferred_outputs: '{{ preferred_outputs }}'

- name: show parsed xrandr data
  debug:
    var: xrandr

- name: show primary display configuration
  debug:
    var: xorg.primary

- name: show secondary display configuration
  debug:
    var: xorg.secondary
  when: xorg.secondary is defined

- name: show drm data (emtpy for nvidia)
  debug:
    var: drm
  when: drm is defined

- name: "stop x-verbose@vt7.service"
  systemd:
    name: "x-verbose@vt7.service"
    state: stopped
    enabled: false
    masked: true

#- name: "wait a little bit, so X has some time to shut down (needed?)"
#  wait_for:
#    timeout: 3

- name: save results
  block:
    - name: ensure facts.d directory exists
      file:
        state: directory
        path: /etc/ansible/facts.d

    - name: write xorg variable as local fact
      copy:
        content: '{{ {"xorg": xorg} | to_nice_json }}'
        dest: /etc/ansible/facts.d/xorg.fact

    - name: write xrandr variable as local fact
      copy:
        content: '{{ {"xrandr": xrandr} | to_nice_json }}'
        dest: /etc/ansible/facts.d/xrandr.fact

    - name: write drm variable as local fact
      copy:
        content: '{{ {"drm": drm} | to_nice_json }}'
        dest: /etc/ansible/facts.d/drm.fact
  when:
    - xrandr is defined
    - xorg is defined
    - drm is defined

- name: update xorg, xrandr and drm variables with values from local facts if needed
  set_fact:
    xorg: '{{ ansible_local.xorg.xorg }}'
    xrandr: '{{ ansible_local.xrandr.xrandr }}'
    drm: '{{ ansible_local.drm.drm }}'
  when:
    - xrandr is undefined
    - xorg is undefined
    - drm is undefined

# TODO: expand template for xorg.conf (or snippets)
#       with respect for the available graphics card driver
#       nvidia, noveau, intel, radeon

- name: nvidia related config
  block:
  - name: create xorg.conf (for nvidia driver)
    template:
        src: templates/xorg.conf.j2
        dest: /etc/X11/xorg.conf
        backup: yes
  when:
    - nvidia_detected | bool

- name: intel xorg config snippet
  template:
    src: templates/20-intel.conf.j2
    dest: /etc/X11/xorg.conf.d/20-intel.conf
  when:
    - intel_detected | bool and not nvidia_detected | bool

- name: server flags config snippet to disable screen blanking
  template:
    src: templates/10-serverflags.conf.j2
    dest: /etc/X11/xorg.conf.d/10-serverflags.conf
</pre>
</div>
</div>
</li>
<li><a id="org926e366"></a>intel.yml<br />
<div class="outline-text-5" id="text-6-15-4-4">
<p>
KMS drivers (like for intel (i915) and amd (radeon)) require additional configuration besides a customized <code>xorg.conf</code> - for a &ldquo;static&rdquo; output configuration (which works if the TV or AV receiver is not turned on) we need to force loading the display(s) EDID early during the boot process.
</p>

<p>
This task therefore performs the following actions after the xrandr detection has been executed:
</p>
<ul class="org-ul">
<li>create an initramfs-hook to copy the EDID(s) into the initramfs</li>
<li>get the connector names and match them to the ones determined by xrandr (this is done by xrandr_facts.py)</li>
<li>add kernel boot arguments to set EDID and mode (refreshrate and resolution) for all outputs</li>
<li>recreate and update initramfs and grub config</li>
</ul>

<p>
Please note that rescanning the connected displays works only after removing the forced loading of EDID(s) during boot (call <code>clean-edids</code>) and a reboot.
</p>

<p>
TODO: create <code>clean-edids</code> script/role/Playbook to undo kernel boot options for edid loading
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>roles/yavdr-xorg/tasks/intel.yml</label><pre class="src src-yaml">- name: "create initramfs hook to copy EDID files"
  template:
    src: templates/include-edid-data.sh.j2
    dest: '/etc/initramfs-tools/hooks/include-edid-data'
    mode: 0755
    force: yes

- name: "create /lib/firmware/edid"
  file:
    state: directory
    dest: /lib/firmware/edid

- name: "set intel_boot_options variable"
  set_fact:
    intel_boot_options: " drm.edid_firmware={{ drm.primary.drm_connector }}:edid/{{ drm.primary.edid }} {% for ignored_c in drm.ignored_outputs %}video={{ ignored_c }}:d{% endfor %}"
  when: intel_set_boot_edid | bool
  notify: ['Update Initramfs', 'Update GRUB']

</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org6c61d0c" class="outline-4">
<h4 id="yavdr-xorg-templates"><span class="section-number-4">6.15.5</span> templates</h4>
<div class="outline-text-4" id="text-yavdr-xorg-templates">
</div>
<ol class="org-ol">
<li><a id="xorg-templates"></a>xorg<br />
<div class="outline-text-5" id="text-xorg-templates">
</div>
<ol class="org-ol">
<li><a id="x-verbose-service"></a>x-verbose@.service<br />
<div class="outline-text-6" id="text-x-verbose-service">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>roles/yavdr-xorg/templates/systemd/system/x-verbose@.service.j2</label><pre class="src src-jinja2">{{ ansible_managed | comment }}
[Unit]
Description=X with verbose logging on %I
Wants=graphical.target
Before=graphical.target

[Service]
Type=forking
ExecStart=/usr/bin/x-daemon -logverbose 6 -noreset %I -config /etc/X11/xorg-verbose.conf
</pre>
</div>
</div>
</li>
<li><a id="xorg-drop-in-snippets"></a>Drop-in snippet for x@.service<br />
<div class="outline-text-6" id="text-xorg-drop-in-snippets">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>roles/yavdr-xorg/templates/x@service.d/plymouth.conf.j2</label><pre class="src src-jinja2">{{ ansible_managed | comment }}
[Unit]
After=plymouth.service
</pre>
</div>
<div class="org-src-container">
<pre class="src src-conf">[Unit]
Before=xlogin@{{ vdr.user }}.service
</pre>
</div>

<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
[Unit]
Wants=x@vt7.service
After=x@vt7.service

[Service]
TimeoutStopSec=20
KillMode=mixed
</pre>
</div>
</div>
</li>

<li><a id="orgd75797e"></a>Drop-in snippet for vdr.service<br />
<div class="outline-text-6" id="text-6-15-5-1-3">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>roles/yavdr-xorg/templates/vdr-xorg.conf</label><pre class="src src-jinja2">{{ ansible_managed | comment }}
[Unit]
After=x@vt7.service
Wants=x@vt7.service
#BindsTo=x@vt7.service
</pre>
</div>
</div>
</li>
<li><a id="org336f701"></a>xorg.conf snippets<br />
<div class="outline-text-6" id="text-6-15-5-1-4">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>roles/yavdr-xorg/templates/vdr-ignore-eventlircd.conf.j2</label><pre class="src src-jinja2">{{ ansible_managed | comment }}

Section "InputClass"
    Identifier "exclude eventlircd devices"
    MatchTag   "eventlircd"
    Option     "Ignore"    "True"
EndSection
</pre>
</div>
</div>
</li>

<li><a id="org461e30d"></a>intel graphics xorg.conf snippet<br />
<div class="outline-text-6" id="text-6-15-5-1-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>roles/yavdr-xorg/templates/20-intel.conf.j2</label><pre class="src src-jinja2">{{ ansible_managed | comment }}
{% set primary_output = xorg.primary.connector|replace("-", "") %}
{% if xorg.secondary is defined %}
  {% set secondary_output = xorg.secondary.connector|replace("-", "") %}
{% endif %}

Section "Device"
  Identifier  "Device0"
  Driver      "intel"
  Option      "TearFree" "true"
{% if xorg.secondary is defined %}
  Option      "ZaphodHeads" "{{ primary_output }}"
  Screen      0  
{% endif %}
EndSection

{% if xorg.secondary is defined %}
Section "Device"
  Identifier  "Device1"
  Driver      "intel"
  Option      "TearFree" "true"
  Option      "ZaphodHeads" "{{ secondary_output }}"
  Screen      1  
EndSection

Section "ServerLayout"
    Identifier     "Layout0"
    Screen      0  "Screen0" 0 0
    Screen      1  "Screen1" RightOf "Screen0"
EndSection
{% endif %}

Section "Screen"
  Identifier  "Screen0"
  Device      "Device0"
  Monitor     "{{ primary_output }}"
  DefaultDepth  24
  SubSection "Display"
    Depth       24
{% if xorg.primary.mode %}
    Modes     "{{ xorg.primary.mode }}"
{% else %}
    Modes     "1920x1080_50" "1920x1080_60" "1920x1080_24"
{% endif %}
  EndSubSection
EndSection

{% if xorg.secondary is defined %}
Section "Screen"
  Identifier  "Screen1"
  Device      "Device1"
  Monitor     "{{ secondary_output }}"
  DefaultDepth  24
  SubSection "Display"
    Depth       24
{% if xorg.secondary.mode %}
    Modes     "{{ xorg.secondary.mode }}"
{% else %}
    Modes     "1920x1080_50" "1920x1080_60" "1920x1080_24"
{% endif %}
  EndSubSection
EndSection

{% endif %}
Section "Monitor"
  Identifier  "{{ primary_output }}"
{% if xrandr["Screen 0:"][xorg.primary.connector].modelines %}
  {{ xrandr["Screen 0:"][xorg.primary.connector].modelines[xorg.primary.mode]|default("") }}
{% elif xorg.primary.modelines %}
{% for modeline in xorg.primary.modelines %}
  {{ modeline }}
{% endfor %}
{% else %}
  Modeline    "1920x1080_24"     74.230 1920 2560 2604 2752 1080 1084 1089 1125 +hsync +vsync
  Modeline    "1920x1080_50"    148.500 1920 2448 2492 2640 1080 1084 1089 1125 +hsync +vsync
  Modeline    "1920x1080_60"    148.500 1920 2008 2056 2200 1080 1084 1089 1125 +hsync +vsync
{% endif %}
EndSection

{% if xorg.secondary is defined %}
Section "Monitor"
  Identifier  "{{ secondary_output }}"
{% if xorg.secondary.modelines %}
{% for modeline in xorg.secondary.modelines %}
  {{ modeline }}
{% endfor %}
{% else %}
  Modeline    "1920x1080_24"     74.230 1920 2560 2604 2752 1080 1084 1089 1125 +hsync +vsync
  Modeline    "1920x1080_50"    148.500 1920 2448 2492 2640 1080 1084 1089 1125 +hsync +vsync
  Modeline    "1920x1080_60"    148.500 1920 2008 2056 2200 1080 1084 1089 1125 +hsync +vsync
{% endif %}
EndSection

{% endif %}
{% for connector, data in xrandr["Screen 0:"].items() | list if not (
    data.is_connected|bool or
    connector == xorg.primary.connector or
    (xorg.secondary is defined and connector == xorg.secondary.connector))
 %}
Section "Monitor"
  Identifier "{{ connector|replace("-","") }}"
  Option "Ignore" "true"
EndSection

{% endfor %}
</pre>
</div>
</div>
</li>
<li><a id="org7e14b91"></a>xorg.conf<br />
<div class="outline-text-6" id="text-6-15-5-1-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>roles/yavdr-xorg/templates/xorg-verbose.conf.j2</label><pre class="src src-conf">{{ ansible_managed | comment }}

Section "Device"
        Identifier "nvidia"
        Driver  "nvidia"
        Option  "DynamicTwinView"     "true"
        Option  "NoFlip"              "false"
EndSection

Section "Screen"
        Identifier      "screen"
        Device          "nvidia"
EndSection
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>roles/yavdr-xorg/templates/xorg.conf.j2</label><pre class="src src-conf">{{ ansible_managed | comment }}

Section "ServerLayout"
    Identifier     "Layout0"
    Screen         0  "Screen0" 0 0
{% if xorg.secondary is defined %}
    Screen         1  "Screen1" RightOf "Screen0"
{% endif %}
    #InputDevice    "Keyboard0" "CoreKeyboard"
    #InputDevice    "Mouse0" "CorePointer"
    Option         "Xinerama" "0"
EndSection

Section "InputClass"
    Identifier "exclude eventlircd devices"
    MatchTag   "eventlircd"
    Option     "Ignore"    "True"
EndSection

Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "{{ xorg.primary.vendor }}"
    ModelName      "{{ xorg.primary.model }}"
    Option         "DPMS"
    Option         "ExactModeTimingsDVI" "True"
EndSection

Section "Device"
    Identifier     "Device0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    Option         "NoLogo"              "true"
{% if xorg.primary.bus_id is defined %}
    BoardName      "{{ xorg.primary.gpu_name }}"
    BusID          "{{ xorg.primary.bus_id }}"
{% else %}
    BoardName      "Unknown"
{% endif %}
{% if nvidia_force_dpi | int(0) &gt; 0  %}
    Option         "UseEdidDpi" "FALSE"
    Option         "DPI" "{{ nvidia_force_dpi }} x {{ nvidia_force_dpi }}"
{% endif %}
    Screen          0
    Option         "ConnectedMonitor" "{{ xorg.primary.connector }}{% if xorg.secondary is defined %}, {{ xorg.secondary.connector }}{% endif %}"
    Option         "CustomEDID" "{{ xorg.primary.connector }}:/etc/X11/edid.{{ xorg.primary.connector }}.bin{% if xorg.secondary is defined %};{{ xorg.secondary.connector }}:/etc/X11/edid.{{ xorg.secondary.connector }}.bin{% endif %}"
EndSection

Section "Screen"
    Identifier     "Screen0"
    Device         "Device0"
    Monitor        "Monitor0"
    DefaultDepth    24
    Option         "nvidiaXineramaInfoOrder" "{{ xorg.primary.connector }}"
    Option         "UseDisplayDevice" "{{ xorg.primary.connector }}"
    Option         "metamodes" "{{ xorg.primary.connector }}: {{ xorg.primary.mode }} +0+0 {ForceCompositionPipeline=Off, ForceFullCompositionPipeline=Off}"
    Option         "AllowIndirectGLXProtocol" "off"
    Option         "TripleBuffer" "on"
    Option         "SLI" "Off"
    Option         "MultiGPU" "Off"
    Option         "BaseMosaic" "off"
    SubSection     "Display"
        Depth       24
    EndSubSection
EndSection

{% if xorg.secondary is defined %}
Section "Device"
    Identifier     "Device1"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    Option  "NoLogo"              "true"
{% if xorg.secondary.bus_id is defined %}
    BoardName      "{{ xorg.primary.gpu_name }}"
    BusID          "{{ xorg.primary.bus_id }}"
{% else %}
    BoardName      "Unknown"
{% endif %}
    Screen          1
EndSection

Section "Monitor"
    Identifier     "Monitor1"
    VendorName     "{{ xorg.secondary.vendor }}"
    ModelName      "{{ xorg.secondary.model }}"
EndSection

Section "Screen"
    Identifier     "Screen1"
    Device         "Device1"
    Monitor        "Monitor1"
    DefaultDepth    24
    Option         "nvidiaXineramaInfoOrder" "{{ xorg.secondary.connector }}"
    #Option         "ConnectedMonitor" "{{ xorg.secondary.connector }}"
    Option         "UseDisplayDevice" "{{ xorg.secondary.connector }}"
    #Option         "CustomEDID" "{{ xorg.secondary.connector }}:/etc/X11/edid.{{ xorg.secondary.connector }}.bin"
    Option         "metamodes" "{{ xorg.secondary.connector }}: {{ xorg.secondary.mode }} +0+0 {ForceCompositionPipeline=Off, ForceFullCompositionPipeline=Off}"
    Option         "AllowIndirectGLXProtocol" "off"
    Option         "TripleBuffer" "on"
    Option         "SLI" "Off"
    Option         "MultiGPU" "Off"
    Option         "BaseMosaic" "off"
    SubSection     "Display"
        Depth       24
    EndSubSection
EndSection
{% endif %}

Section "Extensions"
    Option         "Composite" "Disable"
EndSection
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">{{ ansible_managed | comment }}

Section "ServerLayout"
    Identifier     "Layout0"
    Screen      0  "Screen0"
    {% if xorg.best_tv_mode.secondary is defined %}
    Screen      1  "Screen1" RightOf "Screen0"
    {% endif %}
    InputDevice    "Keyboard0" "CoreKeyboard"
    InputDevice    "Mouse0" "CorePointer"
EndSection

Section "InputDevice"
    # generated from default
    Identifier     "Mouse0"
    Driver         "mouse"
    Option         "Protocol" "auto"
    Option         "Device" "/dev/psaux"
    Option         "Emulate3Buttons" "no"
    Option         "ZAxisMapping" "4 5"
EndSection

# ignore devices with eventlircd tag
# ENV{ID_INPUT.tags}+="eventlircd"
# must be set by an udev rule
Section "InputClass"
    Identifier "ignore eventlircd devices"
    MatchTag "eventlircd"
    Option "Ignore" "True"
EndSection



Section "InputDevice"
    # generated from default
    Identifier     "Keyboard0"
    Driver         "kbd"
EndSection


Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "Unknown"
{# TODO: VGA2SCART support (if needed)
{% if system.x11.display.0.default == "VGA2Scart_4_3" or system.x11.display.0.default == "VGA2Scart_16_9" %}
    HorizSync       14-17
    VertRefresh     49-61
    {% if system.x11.display.0.default == "VGA2Scart_4_3" %}
    Modeline "VGA2Scart_4_3" 13.875 720 744 808 888 576 580 585 625 -HSync -Vsync interlace
    {% elif system.x11.display.0.default == "VGA2Scart_16_9" %}
    Modeline "VGA2Scart_16_9" 19 1024 1032 1120 1216 576 581 586 625 -Hsync -Vsync interlace
    {% endif %}
{% endif %}
#}
    Option         "DPMS"
    Option         "ExactModeTimingsDVI" "True"
EndSection


{% if xrandr.best_tv_mode.secondary is defined %}
Section "Monitor"
    Identifier     "Monitor1"
    VendorName     "Unknown"
    ModelName      "Unknown"
{#
{% if system.x11.display.1.default in ("VGA2Scart_4_3",  "VGA2Scart_16_9") %}
    HorizSync       14-17
    VertRefresh     49-61
    {% if system.x11.display.1.default == "VGA2Scart_4_3" %}
    Modeline "VGA2Scart_4_3" 13.875 720 744 808 888 576 580 585 625 -HSync -Vsync interlace
    {% elif system.x11.display.1.default == "VGA2Scart_16_9" %}
    Modeline "VGA2Scart_16_9" 19 1024 1032 1120 1216 576 581 586 625 -Hsync -Vsync interlace
    {% endif %}
    Option         "DPMS"
    Option         "ExactModeTimingsDVI" "True"
{% endif %}
#}
EndSection
{% endif %}

Section "Device"
    Identifier     "Device0"
{% if system.hardware.nvidia.detected %}
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
{% endif %}
    Screen          0
    Option         "DPI" "100x100"
{% if system.hardware.nvidia.busid is defined and system.hardware.busid %}
    BusID          "PCI: {{ system.hardware.nvidia.busid }}"
{% endif %}
    Option         "NoLogo" "True"
    Option         "UseEvents" "True"
    Option         "TripleBuffer" "False"
    Option         "AddARGBGLXVisuals" "True"
    Option         "TwinView" "0"
    Option         "DynamicTwinView" "0"
    Option         "OnDemandVBlankinterrupts" "on"
    Option         "FlatPanelProperties" "Scaling = Native"
EndSection

{% if xrandr.best_tv_mode.secondary is defined %}
Section "Device"
    Identifier     "Device1"
    {% if system.hardware.nvidia.detected %}
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    {% endif %}
    Screen          1
    {% if system.hardware.nvidia.busid is defined and system.hardware.nvidia.busid %}
    BusID          "PCI: {{ system.hardware.nvidia.busid }}"
    {% endif %}
    Option         "NoLogo" "True"
    Option         "UseEvents" "True"
    Option         "TripleBuffer" "False"
    Option         "AddARGBGLXVisuals" "True"
    Option         "TwinView" "0"
    Option         "DynamicTwinView" "0"
EndSection
{% endif %}


Section "Screen"
    Identifier     "Screen0"
    Device         "Device0"
    Monitor        "Monitor0"
    DefaultDepth    24
    SubSection     "Display"
        Depth       24
{% if xrandr.best_tv_mode.primary is defined %}
        Modes      "{{ xrandr.best_tv_mode.primary.mode }}"{#{% for mode in xrandr %}{% if mode != system.x11.display.0.default %} "{{ mode }}"{% endif %}{% endfor %}#} nvidia-auto-select

{% elif system.hardware.nvidia.detected == 1 %}
        Modes      "nvidia-auto-select"
{% endif %}
    EndSubSection
{% if system.x11.display.0.default or system.x11.default %}
    {% if system.x11.display.0.device is definded and system.x11.display.0.device %}
    Option         "ConnectedMonitor" {{ system.x11.display.0.device }}
    {% else %}
    Option         "ConnectedMonitor" {{ system.x11.default }}
    {% endif %}
    #     Option         "ConnectedMonitor" "&lt;?cs if:(?system.x11.display.0.device) ?&gt;&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;&lt;?cs else ?&gt;&lt;?cs var:system.x11.default ?&gt;&lt;?cs /if ?&gt;&lt;?cs if:(?system.x11.dualhead.enabled &amp;&amp; system.x11.dualhead.enabled == 1) ?&gt;, &lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;&lt;?cs /if ?&gt;"
    #Option         "ConnectedMonitor"
    "&lt;?cs if:(?system.x11.display.0.device) ?&gt;
          &lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;
     &lt;?cs else ?&gt;
          &lt;?cs var:system.x11.default ?&gt;
     &lt;?cs /if ?&gt;
     &lt;?cs if:(?system.x11.dualhead.enabled &amp;&amp; system.x11.dualhead.enabled == 1) ?&gt;, &lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;&lt;?cs /if ?&gt;"
#     Option         "UseDisplayDevice" "&lt;?cs if:(?system.x11.display.0.device) ?&gt;&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;&lt;?cs else ?&gt;&lt;?cs var:system.x11.default ?&gt;&lt;?cs /if ?&gt;"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(?system.hardware.nvidia.0.edid &amp;&amp; system.hardware.nvidia.0.edid == "1") ?&gt;
#     Option         "CustomEDID" "&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;:/etc/X11/edid.0.yavdr"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(system.hardware.nvidia.detected == 1 &amp;&amp; ?system.x11.display.0.device) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;: &lt;?cs var:system.x11.display.0.default ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.0.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.0.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusy ?&gt; }"
# &lt;?cs each:mode = system.x11.display.0.mode ?&gt;&lt;?cs if:(mode != system.x11.display.0.default) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;: &lt;?cs var:mode ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.0.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.0.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusy ?&gt; }"&lt;?cs /if ?&gt;&lt;?cs /each ?&gt;
{% endif %}
EndSection

{% if system.x11.dualhead.enabled == "1" %}
Section "Screen"

     Identifier     "Screen1"
     Device         "Device1"
     Monitor        "Monitor1"
     DefaultDepth    24
     SubSection     "Display"
         Depth       24
{% if system.x11.display.0.default is defined and system.x11.display.0.default %}
         Modes      "{{ system.x11.display.1.default }}"{% for mode in system.x11.display.1.mode %}{% if mode != system.x11.display.1.default %} "{{ mode }}"{% endif %}{% endfor %}

{% elif system.hardware.nvidia.detected == "1" %}
         Modes      "nvidia-auto-select"
{% endif %}
      EndSubSection

# &lt;?cs if:(?system.x11.display.1.default &amp;&amp; system.x11.display.1.default != "" &amp;&amp; system.x11.display.1.default != "disabled") ?&gt;
#     Option         "UseDisplayDevice" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(?system.hardware.nvidia.1.edid &amp;&amp; system.hardware.nvidia.1.edid == "1") ?&gt;
#     Option         "CustomEDID" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;:/etc/X11/edid.1.yavdr"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(system.hardware.nvidia.detected == 1 &amp;&amp; ?system.x11.display.1.device) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;: &lt;?cs var:system.x11.display.1.default ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.1.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.1.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusy ?&gt; }"
# &lt;?cs each:mode = system.x11.display.1.mode ?&gt;&lt;?cs if:(mode != system.x11.display.1.default) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;: &lt;?cs var:mode ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.1.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.1.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusy ?&gt; }"&lt;?cs /if ?&gt;&lt;?cs /each ?&gt;
# &lt;?cs /if ?&gt;
EndSection
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="org2591019"></a>snippet to disable screen blanking<br />
<div class="outline-text-6" id="text-6-15-5-1-7">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}
Section "ServerFlags"
    Option         "NoPM" "true"
    Option         "blank time" "0"
    Option         "standby time" "0"
    Option         "suspend time" "0"
    Option         "off time" "0"
EndSection
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org3364323"></a>vdr<br />
<div class="outline-text-5" id="text-6-15-5-2">
<p>
Set environment variables for system locale and user session on startup
</p>
<div class="org-src-container">
<pre class="src src-conf">[Service]
EnvironmentFile=-/etc/default/locale
Environment=XDG_RUNTIME_DIR=/run/user/{{ vdr.uid }}/
EnvironmentFile=-/var/lib/vdr/.session-env
</pre>
</div>
</div>
</li>
<li><a id="org2623c5e"></a>initramfs EDID hook<br />
<div class="outline-text-5" id="text-6-15-5-3">
<div class="org-src-container">
<pre class="src src-jinja2">#!/bin/bash
{{ ansible_managed | comment }}
# This hook copies EDID files with the naming scheme "edid.${OUTPUT}.bin" to the initramfs.

[ "$1" = "prereqs" ] &amp;&amp; { echo "udev"; exit 0; }

# load hook helper functions
. /usr/share/initramfs-tools/hook-functions

rm /lib/firmware/edid/edid.*.bin
find "/etc/X11/" -name "edid.*.bin" -type f -exec cp -t "/lib/firmware/edid/" {} +
mkdir -p "${DESTDIR}/lib/firmware/edid"
find "/etc/X11/" -name "edid.*.bin" -type f -exec cp -t "${DESTDIR}/lib/firmware/edid/" {} +
manual_add_modules i915 radeon
exit 0
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orge6df0dd" class="outline-3">
<h3 id="orge6df0dd"><span class="section-number-3">6.16</span> yavdr-desktop</h3>
<div class="outline-text-3" id="text-6-16">
</div>
<div id="outline-container-orgb3e9eec" class="outline-4">
<h4 id="orgb3e9eec"><span class="section-number-4">6.16.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-16-1">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>roles/yavdr-desktop.yml</label><pre class="src src-yaml">---
dependencies:
    - role: session-common
    - role: udiskie
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb01075e" class="outline-4">
<h4 id="orgb01075e"><span class="section-number-4">6.16.2</span> Tasks</h4>
<div class="outline-text-4" id="text-6-16-2">
</div>
<ol class="org-ol">
<li><a id="org93b8bdc"></a>main.yml<br />
<div class="outline-text-5" id="text-6-16-2-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/yavdr-desktop/tasks/main.yml

- name: create folders for user configuration files
  file:
    state: directory
    dest: '{{ item }}'
    mode: '0775'
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
  loop:
    - '{{ vdr.home }}/.config/systemd/user'
    - '{{ vdr.home }}/.config/openbox'
    - '{{ vdr.home }}/.config/pulse'
    - '{{ vdr.home }}/bin'

- name: expand template for .xinitrc for vdr user
  template:
      src: 'templates/.xinitrc.j2'
      dest: '{{ vdr.home }}/.xinitrc'
      mode: 0755
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: "expand template for vdr's .Xresources"
  template:
      src: 'templates/.Xresources.j2'
      dest: '{{ vdr.home }}/.Xresources'
      mode: 0644
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: expand template for openbox autostart
  template:
      src: 'templates/openbox/autostart.j2'
      dest: '{{ vdr.home }}/.config/openbox/autostart'
      mode: 0755
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: expand rc.xml for openbox
  template:
      src: 'templates/openbox/rc.xml.j2'
      dest: '{{ vdr.home }}/.config/openbox/rc.xml'
      mode: 0644
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: expand rc2.xml for openbox on second display
  template:
      src: 'templates/openbox/rc2.xml.j2'
      dest: '{{ vdr.home }}/.config/openbox/rc2.xml'
      mode: 0644
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: create yavdr-desktop.target for the user session
  template:
      src: 'templates/systemd/user/yavdr-desktop.target.j2'
      dest: '{{ vdr.home }}/.config/systemd/user/yavdr-desktop.target'
      mode: 0644
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: disable pulseaudio autospawning
  lineinfile:
    path: '{{ vdr.home }}/.config/pulse/client.conf'
    line: 'autospawn = yes'
    create: yes
    state: present
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: create wm-exit.service for the session
  template:
    src: templates/systemd/user/wm-exit.service.j2
    dest: '{{ vdr.home }}/.config/systemd/user/wm-exit.service'
    mode: 0644
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: create detect-second-display.service for the session
  template:
    src: templates/systemd/user/detect-second-display.service.j2
    dest: '{{ vdr.home }}/.config/systemd/user/detect-second-display.service'
    mode: 0644
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: create detect-second-diplay script
  template:
    src: templates/bin/detect-second-display.j2
    dest: '{{ vdr.home }}/bin/detect-second-display'
    mode: 0755
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: create switch-displays script
  template:
    src: templates/bin/switch-displays.j2
    dest: '{{ vdr.home }}/bin/switch-displays'
    mode: 0755
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: create openbox-second.service for the session
  template:
    src: templates/systemd/user/openbox-second.service.j2
    dest: '{{ vdr.home }}/.config/systemd/user/openbox-second.service'
    mode: 0644
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'

- name: create osd2web.service for the session
  template:
    src: templates/systemd/user/osd2web.service.j2
    dest: '{{ vdr.home }}/.config/systemd/user/osd2web.service'
    owner: '{{ vdr.user }}'
    group: '{{ vdr.group }}'
    mode: 0644

- name: create irexec configuration for the session
  block:
    - template:
        src: templates/systemd/user/irexec.service.j2
        dest: '{{ vdr.home }}/.config/systemd/user/irexec.service'
        mode: 0644
        owner: '{{ vdr.user }}'
        group: '{{ vdr.group }}'
    - template:
        src: templates/.lircrc.j2
        dest: '{{ vdr.home }}/.lircrc'
        mode: 0644
        owner: '{{ vdr.user }}'
        group: '{{ vdr.group }}'
        force: no

- name: link /usr/bin/start-desktop to /var/lib/vdr/plugins/desktop/starter
  file:
    src: /usr/bin/start-desktop
    dest: /var/lib/vdr/plugins/desktop/starter
    state: link

- name: enable and start yavdr-xorg for the vdr user
  systemd:
    daemon_reload: yes
    name: 'yavdr-xorg'
    enabled: yes
    state: started

- name: enable tmux.service
  systemd:
    name: tmux.service
    state: started
    masked: no
    enabled: yes
    scope: user
  become: yes
  become_user: vdr
    
- name: enable and start udiskie.service
  systemd:
    name: 'udiskie.service'
    state: started
    masked: no
    enabled: yes
    scope: user
  become: yes
  become_user: vdr

</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org4b5dd66" class="outline-4">
<h4 id="org4b5dd66"><span class="section-number-4">6.16.3</span> Templates</h4>
<div class="outline-text-4" id="text-6-16-3">
</div>
<ol class="org-ol">
<li><a id="orgd912ac2"></a>xorg configuration<br />
<ol class="org-ol">
<li><a id="org6352885"></a>.Xresources<br />
<div class="outline-text-6" id="text-6-16-3-1-1">
<div class="org-src-container">
<pre class="src src-shell">xterm*background: Black
xterm*foreground: grey
XTerm*locale: true
XTerm*metaSendsEscape: true
XTerm*eightBitInput: false
XTerm*backarrowKey: false
XTerm*ttyModes: erase ^?
Xterm*saveLines: 4096
XTerm.vt100.metaSendsEscape: true
XTerm.vt100.geometry: 80x32
XTerm.vt100.renderFont: true
xterm*faceName: xft:DejaVu Sans Mono
xterm*faceSize: 14
xterm*renderFont: true
XTerm.vt100.faceName: xft:DejaVu Sans Mono:size=12:antialias=false
XTerm.vt100.font: 7x13
</pre>
</div>
</div>
</li>
<li><a id="org2d6d036"></a>.xinitrc<br />
<div class="outline-text-6" id="text-6-16-3-1-2">
<div class="org-src-container">
<pre class="src src-shell">#!/bin/bash
{{ ansible_managed | comment }}
exec openbox-session
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgeb72c2a"></a>openbox<br />
<ol class="org-ol">
<li><a id="org2dbba17"></a>autostart<br />
<div class="outline-text-6" id="text-6-16-3-2-1">
<div class="org-src-container">
<pre class="src src-shell"># forward environment variables to an environment file and the systemd user session
env | grep "DISPLAY\|DBUS_SESSION_BUS_ADDRESS\|XDG_RUNTIME_DIR" &gt; ~/.session-env
systemctl --user import-environment DISPLAY XAUTHORITY XDG_RUNTIME_DIR DBUS_SESSION_BUS_ADDRESS

feh --no-fehbg  --bg-center "/usr/share/yavdr/images/yavdr_logo.png"

enabled_services=(
    "detect-second-display.service"
    "openbox-second.service" "osd2web.service"
    "yavdr-frontend.service" "pulseaudio.socket"
    "pulseaudio.service" "wm-exit.service" "irexec.service")
disabled_services=()

# enable configured services for the user session
for service in "${enabled_services[@]}"; do
  systemctl --user enable "$service"
done

# disable unwanted services for the user session
for service in "${disabled_services[@]}"; do
  systemctl --user disable "$service"
done

if which dbus-update-activation-environment &gt;/dev/null 2&gt;&amp;1; then
        dbus-update-activation-environment DISPLAY XAUTHORITY XDG_RUNTIME_DIR
fi

# start systemd units for the yavdr user session
systemctl --user isolate yavdr-desktop.target
</pre>
</div>
</div>
</li>
<li><a id="orgb700cc7"></a>rc.xml<br />
<div class="outline-text-6" id="text-6-16-3-2-2">
<div class="org-src-container">
<pre class="src src-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;openbox_config xmlns="http://openbox.org/3.4/rc" xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
&lt;!-- Do not edit this file, it will be overwritten on install.
        Copy the file to $HOME/.config/openbox/ instead. --&gt;
  &lt;resistance&gt;
    &lt;strength&gt;10&lt;/strength&gt;
    &lt;screen_edge_strength&gt;20&lt;/screen_edge_strength&gt;
  &lt;/resistance&gt;
  &lt;focus&gt;
    &lt;focusNew&gt;yes&lt;/focusNew&gt;
    &lt;!-- always try to focus new windows when they appear. other rules do
       apply --&gt;
    &lt;followMouse&gt;no&lt;/followMouse&gt;
    &lt;!-- move focus to a window when you move the mouse into it --&gt;
    &lt;focusLast&gt;yes&lt;/focusLast&gt;
    &lt;!-- focus the last used window when changing desktops, instead of the one
       under the mouse pointer. when followMouse is enabled --&gt;
    &lt;underMouse&gt;no&lt;/underMouse&gt;
    &lt;!-- move focus under the mouse, even when the mouse is not moving --&gt;
    &lt;focusDelay&gt;200&lt;/focusDelay&gt;
    &lt;!-- when followMouse is enabled, the mouse must be inside the window for
       this many milliseconds (1000 = 1 sec) before moving focus to it --&gt;
    &lt;raiseOnFocus&gt;no&lt;/raiseOnFocus&gt;
    &lt;!-- when followMouse is enabled, and a window is given focus by moving the
       mouse into it, also raise the window --&gt;
  &lt;/focus&gt;
  &lt;placement&gt;
    &lt;policy&gt;Smart&lt;/policy&gt;
    &lt;!-- 'Smart' or 'UnderMouse' --&gt;
    &lt;center&gt;yes&lt;/center&gt;
    &lt;!-- whether to place windows in the center of the free area found or
       the top left corner --&gt;
    &lt;monitor&gt;Active&lt;/monitor&gt;
    &lt;!-- with Smart placement on a multi-monitor system, try to place new windows
       on: 'Any' - any monitor, 'Mouse' - where the mouse is, 'Active' - where
       the active window is, 'Primary' - only on the primary monitor --&gt;
    &lt;primaryMonitor&gt;Active&lt;/primaryMonitor&gt;
    &lt;!-- The monitor where Openbox should place popup dialogs such as the
       focus cycling popup, or the desktop switch popup.  It can be an index
       from 1, specifying a particular monitor.  Or it can be one of the
       following: 'Mouse' - where the mouse is, or
                  'Active' - where the active window is --&gt;
  &lt;/placement&gt;
  &lt;theme&gt;
    &lt;name&gt;Onyx&lt;/name&gt;
    &lt;titleLayout&gt;NLIMC&lt;/titleLayout&gt;
    &lt;!--
      available characters are NDSLIMC, each can occur at most once.
      N: window icon
      L: window label (AKA title).
      I: iconify
      M: maximize
      C: close
      S: shade (roll up/down)
      D: omnipresent (on all desktops).
  --&gt;
    &lt;keepBorder&gt;no&lt;/keepBorder&gt;
    &lt;animateIconify&gt;yes&lt;/animateIconify&gt;
    &lt;font place="ActiveWindow"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;8&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="InactiveWindow"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;8&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="MenuHeader"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;normal&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="MenuItem"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;normal&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="ActiveOnScreenDisplay"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="InactiveOnScreenDisplay"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
  &lt;/theme&gt;
  &lt;desktops&gt;
    &lt;!-- this stuff is only used at startup, pagers allow you to change them
       during a session

       these are default values to use when other ones are not already set
       by other applications, or saved in your session

       use obconf if you want to change these without having to log out
       and back in --&gt;
    &lt;number&gt;2&lt;/number&gt;
    &lt;firstdesk&gt;1&lt;/firstdesk&gt;
    &lt;names&gt;
      &lt;!-- set names up here if you want to, like this:
    &lt;name&gt;desktop 1&lt;/name&gt;
    &lt;name&gt;desktop 2&lt;/name&gt;
    --&gt;
    &lt;/names&gt;
    &lt;popupTime&gt;875&lt;/popupTime&gt;
    &lt;!-- The number of milliseconds to show the popup for when switching
       desktops.  Set this to 0 to disable the popup. --&gt;
  &lt;/desktops&gt;
  &lt;resize&gt;
    &lt;drawContents&gt;yes&lt;/drawContents&gt;
    &lt;popupShow&gt;Nonpixel&lt;/popupShow&gt;
    &lt;!-- 'Always', 'Never', or 'Nonpixel' (xterms and such) --&gt;
    &lt;popupPosition&gt;Center&lt;/popupPosition&gt;
    &lt;!-- 'Center', 'Top', or 'Fixed' --&gt;
    &lt;popupFixedPosition&gt;
      &lt;!-- these are used if popupPosition is set to 'Fixed' --&gt;
      &lt;x&gt;10&lt;/x&gt;
      &lt;!-- positive number for distance from left edge, negative number for
         distance from right edge, or 'Center' --&gt;
      &lt;y&gt;10&lt;/y&gt;
      &lt;!-- positive number for distance from top edge, negative number for
         distance from bottom edge, or 'Center' --&gt;
    &lt;/popupFixedPosition&gt;
  &lt;/resize&gt;
  &lt;!-- You can reserve a portion of your screen where windows will not cover when
     they are maximized, or when they are initially placed.
     Many programs reserve space automatically, but you can use this in other
     cases. --&gt;
  &lt;margins&gt;
    &lt;top&gt;0&lt;/top&gt;
    &lt;bottom&gt;0&lt;/bottom&gt;
    &lt;left&gt;0&lt;/left&gt;
    &lt;right&gt;0&lt;/right&gt;
  &lt;/margins&gt;
  &lt;dock&gt;
    &lt;position&gt;TopLeft&lt;/position&gt;
    &lt;!-- (Top|Bottom)(Left|Right|)|Top|Bottom|Left|Right|Floating --&gt;
    &lt;floatingX&gt;0&lt;/floatingX&gt;
    &lt;floatingY&gt;0&lt;/floatingY&gt;
    &lt;noStrut&gt;no&lt;/noStrut&gt;
    &lt;stacking&gt;Above&lt;/stacking&gt;
    &lt;!-- 'Above', 'Normal', or 'Below' --&gt;
    &lt;direction&gt;Vertical&lt;/direction&gt;
    &lt;!-- 'Vertical' or 'Horizontal' --&gt;
    &lt;autoHide&gt;no&lt;/autoHide&gt;
    &lt;hideDelay&gt;300&lt;/hideDelay&gt;
    &lt;!-- in milliseconds (1000 = 1 second) --&gt;
    &lt;showDelay&gt;300&lt;/showDelay&gt;
    &lt;!-- in milliseconds (1000 = 1 second) --&gt;
    &lt;moveButton&gt;Middle&lt;/moveButton&gt;
    &lt;!-- 'Left', 'Middle', 'Right' --&gt;
  &lt;/dock&gt;
  &lt;keyboard&gt;
    &lt;chainQuitKey&gt;C-g&lt;/chainQuitKey&gt;
    &lt;!-- Keybindings for yavdr-frontend --&gt;
    &lt;keybind key="W-a"&gt;
      &lt;action name="Execute"&gt;
      &lt;command&gt;frontend-dbus-send start&lt;/command&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-s"&gt;
      &lt;action name="Execute"&gt;
      &lt;command&gt;frontend-dbus-send stop&lt;/command&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-x"&gt;
      &lt;action name="Execute"&gt;
      &lt;command&gt;frontend-dbus-send switchbetween kodi vdr&lt;/command&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="XF86HomePage"&gt;
      &lt;action name="Execute"&gt;
      &lt;command&gt;frontend-dbus-send toggle&lt;/command&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for desktop switching --&gt;
    &lt;keybind key="C-A-Left"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;left&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Right"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;right&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Up"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;up&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Down"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;down&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Left"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;left&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Right"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;right&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Up"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;up&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Down"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;down&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F1"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;1&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F2"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;2&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F3"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;3&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F4"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;4&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-d"&gt;
      &lt;action name="ToggleShowDesktop"/&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for windows --&gt;
    &lt;keybind key="A-F4"&gt;
      &lt;action name="Close"/&gt;
    &lt;/keybind&gt;
    &lt;keybind key="A-Escape"&gt;
      &lt;action name="Lower"/&gt;
      &lt;action name="FocusToBottom"/&gt;
      &lt;action name="Unfocus"/&gt;
    &lt;/keybind&gt;
    &lt;keybind key="A-space"&gt;
      &lt;action name="ShowMenu"&gt;
        &lt;menu&gt;client-menu&lt;/menu&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Take a screenshot of the current window with scrot when Alt+Print are pressed --&gt;
    &lt;keybind key="A-Print"&gt;
      &lt;action name="Execute"&gt;
        &lt;command&gt;scrot -s&lt;/command&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for window switching --&gt;
    &lt;keybind key="A-Tab"&gt;
      &lt;action name="NextWindow"&gt;
        &lt;finalactions&gt;
          &lt;action name="Focus"/&gt;
          &lt;action name="Raise"/&gt;
          &lt;action name="Unshade"/&gt;
        &lt;/finalactions&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="A-S-Tab"&gt;
      &lt;action name="PreviousWindow"&gt;
        &lt;finalactions&gt;
          &lt;action name="Focus"/&gt;
          &lt;action name="Raise"/&gt;
          &lt;action name="Unshade"/&gt;
        &lt;/finalactions&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Tab"&gt;
      &lt;action name="NextWindow"&gt;
        &lt;panels&gt;yes&lt;/panels&gt;
        &lt;desktop&gt;yes&lt;/desktop&gt;
        &lt;finalactions&gt;
          &lt;action name="Focus"/&gt;
          &lt;action name="Raise"/&gt;
          &lt;action name="Unshade"/&gt;
        &lt;/finalactions&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for window switching with the arrow keys --&gt;
    &lt;keybind key="W-S-Right"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;right&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-S-Left"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;left&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-S-Up"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;up&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-S-Down"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;down&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
  &lt;/keyboard&gt;
  &lt;mouse&gt;
    &lt;dragThreshold&gt;1&lt;/dragThreshold&gt;
    &lt;!-- number of pixels the mouse must move before a drag begins --&gt;
    &lt;doubleClickTime&gt;500&lt;/doubleClickTime&gt;
    &lt;!-- in milliseconds (1000 = 1 second) --&gt;
    &lt;screenEdgeWarpTime&gt;400&lt;/screenEdgeWarpTime&gt;
    &lt;!-- Time before changing desktops when the pointer touches the edge of the
       screen while moving a window, in milliseconds (1000 = 1 second).
       Set this to 0 to disable warping --&gt;
    &lt;screenEdgeWarpMouse&gt;false&lt;/screenEdgeWarpMouse&gt;
    &lt;!-- Set this to TRUE to move the mouse pointer across the desktop when
       switching due to hitting the edge of the screen --&gt;
    &lt;context name="Frame"&gt;
      &lt;mousebind button="A-Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Left" action="Click"&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Left" action="Drag"&gt;
        &lt;action name="Move"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Right" action="Drag"&gt;
        &lt;action name="Resize"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Middle" action="Press"&gt;
        &lt;action name="Lower"/&gt;
        &lt;action name="FocusToBottom"/&gt;
        &lt;action name="Unfocus"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-S-Up" action="Click"&gt;
        &lt;action name="SendToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-S-Down" action="Click"&gt;
        &lt;action name="SendToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Titlebar"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Move"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="DoubleClick"&gt;
        &lt;action name="ToggleMaximize"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Up" action="Click"&gt;
        &lt;action name="if"&gt;
          &lt;shaded&gt;no&lt;/shaded&gt;
          &lt;then&gt;
            &lt;action name="Shade"/&gt;
            &lt;action name="FocusToBottom"/&gt;
            &lt;action name="Unfocus"/&gt;
            &lt;action name="Lower"/&gt;
          &lt;/then&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Down" action="Click"&gt;
        &lt;action name="if"&gt;
          &lt;shaded&gt;yes&lt;/shaded&gt;
          &lt;then&gt;
            &lt;action name="Unshade"/&gt;
            &lt;action name="Raise"/&gt;
          &lt;/then&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Titlebar Top Right Bottom Left TLCorner TRCorner BRCorner BLCorner"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="Lower"/&gt;
        &lt;action name="FocusToBottom"/&gt;
        &lt;action name="Unfocus"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Top"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;top&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Left"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;left&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Right"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;right&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Bottom"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;bottom&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="TRCorner BRCorner TLCorner BLCorner"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Client"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Icon"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="AllDesktops"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="ToggleOmnipresent"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Shade"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="ToggleShade"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Iconify"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="Iconify"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Maximize"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="ToggleMaximize"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Click"&gt;
        &lt;action name="ToggleMaximize"&gt;
          &lt;direction&gt;vertical&lt;/direction&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Click"&gt;
        &lt;action name="ToggleMaximize"&gt;
          &lt;direction&gt;horizontal&lt;/direction&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Close"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="Close"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Desktop"&gt;
      &lt;mousebind button="Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Root"&gt;
      &lt;!-- Menus --&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-list-combined-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;root-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="MoveResize"&gt;
      &lt;mousebind button="Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
  &lt;/mouse&gt;
  &lt;menu&gt;
    &lt;!-- You can specify more than one menu file in here and they are all loaded,
       just don't make menu ids clash or, well, it'll be kind of pointless --&gt;
    &lt;!-- default menu file (or custom one in $HOME/.config/openbox/) --&gt;
    &lt;!-- system menu files on Debian systems --&gt;
    &lt;file&gt;/var/lib/openbox/debian-menu.xml&lt;/file&gt;
    &lt;file&gt;menu.xml&lt;/file&gt;
    &lt;hideDelay&gt;200&lt;/hideDelay&gt;
    &lt;!-- if a press-release lasts longer than this setting (in milliseconds), the
       menu is hidden again --&gt;
    &lt;middle&gt;no&lt;/middle&gt;
    &lt;!-- center submenus vertically about the parent entry --&gt;
    &lt;submenuShowDelay&gt;100&lt;/submenuShowDelay&gt;
    &lt;!-- time to delay before showing a submenu after hovering over the parent
       entry.
       if this is a negative value, then the delay is infinite and the
       submenu will not be shown until it is clicked on --&gt;
    &lt;submenuHideDelay&gt;400&lt;/submenuHideDelay&gt;
    &lt;!-- time to delay before hiding a submenu when selecting another
       entry in parent menu
       if this is a negative value, then the delay is infinite and the
       submenu will not be hidden until a different submenu is opened --&gt;
    &lt;showIcons&gt;yes&lt;/showIcons&gt;
    &lt;!-- controls if icons appear in the client-list-(combined-)menu --&gt;
    &lt;manageDesktops&gt;yes&lt;/manageDesktops&gt;
    &lt;!-- show the manage desktops section in the client-list-(combined-)menu --&gt;
  &lt;/menu&gt;
    &lt;!--
  # this is an example with comments through out. use these to make your
  # own rules, but without the comments of course.
  # you may use one or more of the name/class/role/title/type rules to specify
  # windows to match

  &lt;application name="the window's _OB_APP_NAME property (see obxprop)"
              class="the window's _OB_APP_CLASS property (see obxprop)"
          groupname="the window's _OB_APP_GROUP_NAME property (see obxprop)"
         groupclass="the window's _OB_APP_GROUP_CLASS property (see obxprop)"
               role="the window's _OB_APP_ROLE property (see obxprop)"
              title="the window's _OB_APP_TITLE property (see obxprop)"
               type="the window's _OB_APP_TYPE property (see obxprob)..
                      (if unspecified, then it is 'dialog' for child windows)"&gt;
  # you may set only one of name/class/role/title/type, or you may use more
  # than one together to restrict your matches.

  # the name, class, role, and title use simple wildcard matching such as those
  # used by a shell. you can use * to match any characters and ? to match
  # any single character.

  # the type is one of: normal, dialog, splash, utility, menu, toolbar, dock,
  #    or desktop

  # when multiple rules match a window, they will all be applied, in the
  # order that they appear in this list


    # each rule element can be left out or set to 'default' to specify to not
    # change that attribute of the window

    &lt;decor&gt;yes&lt;/decor&gt;
    # enable or disable window decorations

    &lt;shade&gt;no&lt;/shade&gt;
    # make the window shaded when it appears, or not

    &lt;position force="no"&gt;
      # the position is only used if both an x and y coordinate are provided
      # (and not set to 'default')
      # when force is "yes", then the window will be placed here even if it
      # says you want it placed elsewhere.  this is to override buggy
      # applications who refuse to behave
      &lt;x&gt;center&lt;/x&gt;
      # a number like 50, or 'center' to center on screen. use a negative number
      # to start from the right (or bottom for &lt;y&gt;), ie -50 is 50 pixels from
      # the right edge (or bottom). use 'default' to specify using value
      # provided by the application, or chosen by openbox, instead.
      &lt;y&gt;200&lt;/y&gt;
      &lt;monitor&gt;1&lt;/monitor&gt;
      # specifies the monitor in a xinerama setup.
      # 1 is the first head, or 'mouse' for wherever the mouse is
    &lt;/position&gt;

    &lt;size&gt;
      # the size to make the window.
      &lt;width&gt;20&lt;/width&gt;
      # a number like 20, or 'default' to use the size given by the application.
      # you can use fractions such as 1/2 or percentages such as 75% in which
      # case the value is relative to the size of the monitor that the window
      # appears on.
      &lt;height&gt;30%&lt;/height&gt;
    &lt;/size&gt;

    &lt;focus&gt;yes&lt;/focus&gt;
    # if the window should try be given focus when it appears. if this is set
    # to yes it doesn't guarantee the window will be given focus. some
    # restrictions may apply, but Openbox will try to

    &lt;desktop&gt;1&lt;/desktop&gt;
    # 1 is the first desktop, 'all' for all desktops

    &lt;layer&gt;normal&lt;/layer&gt;
    # 'above', 'normal', or 'below'

    &lt;iconic&gt;no&lt;/iconic&gt;
    # make the window iconified when it appears, or not

    &lt;skip_pager&gt;no&lt;/skip_pager&gt;
    # asks to not be shown in pagers

    &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    # asks to not be shown in taskbars. window cycling actions will also
    # skip past such windows

    &lt;fullscreen&gt;yes&lt;/fullscreen&gt;
    # make the window in fullscreen mode when it appears

    &lt;maximized&gt;true&lt;/maximized&gt;
    # 'Horizontal', 'Vertical' or boolean (yes/no)
  &lt;/application&gt;

  # end of the example
--&gt;
  &lt;applications&gt;
    &lt;application title="softhddevice"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="softhdcuvid"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="vaapidevice"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application class="VDR"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="browser"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="osd2Web"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
  &lt;/applications&gt;
&lt;/openbox_config&gt;

</pre>
</div>
</div>
</li>
<li><a id="org047ee60"></a>rc2.xml<br />
<div class="outline-text-6" id="text-6-16-3-2-3">
<div class="org-src-container">
<pre class="src src-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;openbox_config xmlns="http://openbox.org/3.4/rc" xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
&lt;!-- Do not edit this file, it will be overwritten on install.
        Copy the file to $HOME/.config/openbox/ instead. --&gt;
  &lt;resistance&gt;
    &lt;strength&gt;10&lt;/strength&gt;
    &lt;screen_edge_strength&gt;20&lt;/screen_edge_strength&gt;
  &lt;/resistance&gt;
  &lt;focus&gt;
    &lt;focusNew&gt;no&lt;/focusNew&gt;
    &lt;!-- always try to focus new windows when they appear. other rules do
       apply --&gt;
    &lt;followMouse&gt;no&lt;/followMouse&gt;
    &lt;!-- move focus to a window when you move the mouse into it --&gt;
    &lt;focusLast&gt;yes&lt;/focusLast&gt;
    &lt;!-- focus the last used window when changing desktops, instead of the one
       under the mouse pointer. when followMouse is enabled --&gt;
    &lt;underMouse&gt;no&lt;/underMouse&gt;
    &lt;!-- move focus under the mouse, even when the mouse is not moving --&gt;
    &lt;focusDelay&gt;200&lt;/focusDelay&gt;
    &lt;!-- when followMouse is enabled, the mouse must be inside the window for
       this many milliseconds (1000 = 1 sec) before moving focus to it --&gt;
    &lt;raiseOnFocus&gt;no&lt;/raiseOnFocus&gt;
    &lt;!-- when followMouse is enabled, and a window is given focus by moving the
       mouse into it, also raise the window --&gt;
  &lt;/focus&gt;
  &lt;placement&gt;
    &lt;policy&gt;Smart&lt;/policy&gt;
    &lt;!-- 'Smart' or 'UnderMouse' --&gt;
    &lt;center&gt;yes&lt;/center&gt;
    &lt;!-- whether to place windows in the center of the free area found or
       the top left corner --&gt;
    &lt;monitor&gt;Active&lt;/monitor&gt;
    &lt;!-- with Smart placement on a multi-monitor system, try to place new windows
       on: 'Any' - any monitor, 'Mouse' - where the mouse is, 'Active' - where
       the active window is, 'Primary' - only on the primary monitor --&gt;
    &lt;primaryMonitor&gt;Active&lt;/primaryMonitor&gt;
    &lt;!-- The monitor where Openbox should place popup dialogs such as the
       focus cycling popup, or the desktop switch popup.  It can be an index
       from 1, specifying a particular monitor.  Or it can be one of the
       following: 'Mouse' - where the mouse is, or
                  'Active' - where the active window is --&gt;
  &lt;/placement&gt;
  &lt;theme&gt;
    &lt;name&gt;Onyx&lt;/name&gt;
    &lt;titleLayout&gt;NLIMC&lt;/titleLayout&gt;
    &lt;!--
      available characters are NDSLIMC, each can occur at most once.
      N: window icon
      L: window label (AKA title).
      I: iconify
      M: maximize
      C: close
      S: shade (roll up/down)
      D: omnipresent (on all desktops).
  --&gt;
    &lt;keepBorder&gt;no&lt;/keepBorder&gt;
    &lt;animateIconify&gt;yes&lt;/animateIconify&gt;
    &lt;font place="ActiveWindow"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;8&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="InactiveWindow"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;8&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="MenuHeader"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;normal&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="MenuItem"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;normal&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="ActiveOnScreenDisplay"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
    &lt;font place="InactiveOnScreenDisplay"&gt;
      &lt;name&gt;sans&lt;/name&gt;
      &lt;size&gt;9&lt;/size&gt;
      &lt;!-- font size in points --&gt;
      &lt;weight&gt;bold&lt;/weight&gt;
      &lt;!-- 'bold' or 'normal' --&gt;
      &lt;slant&gt;normal&lt;/slant&gt;
      &lt;!-- 'italic' or 'normal' --&gt;
    &lt;/font&gt;
  &lt;/theme&gt;
  &lt;desktops&gt;
    &lt;!-- this stuff is only used at startup, pagers allow you to change them
       during a session

       these are default values to use when other ones are not already set
       by other applications, or saved in your session

       use obconf if you want to change these without having to log out
       and back in --&gt;
    &lt;number&gt;2&lt;/number&gt;
    &lt;firstdesk&gt;1&lt;/firstdesk&gt;
    &lt;names&gt;
      &lt;!-- set names up here if you want to, like this:
    &lt;name&gt;desktop 1&lt;/name&gt;
    &lt;name&gt;desktop 2&lt;/name&gt;
    --&gt;
    &lt;/names&gt;
    &lt;popupTime&gt;875&lt;/popupTime&gt;
    &lt;!-- The number of milliseconds to show the popup for when switching
       desktops.  Set this to 0 to disable the popup. --&gt;
  &lt;/desktops&gt;
  &lt;resize&gt;
    &lt;drawContents&gt;yes&lt;/drawContents&gt;
    &lt;popupShow&gt;Nonpixel&lt;/popupShow&gt;
    &lt;!-- 'Always', 'Never', or 'Nonpixel' (xterms and such) --&gt;
    &lt;popupPosition&gt;Center&lt;/popupPosition&gt;
    &lt;!-- 'Center', 'Top', or 'Fixed' --&gt;
    &lt;popupFixedPosition&gt;
      &lt;!-- these are used if popupPosition is set to 'Fixed' --&gt;
      &lt;x&gt;10&lt;/x&gt;
      &lt;!-- positive number for distance from left edge, negative number for
         distance from right edge, or 'Center' --&gt;
      &lt;y&gt;10&lt;/y&gt;
      &lt;!-- positive number for distance from top edge, negative number for
         distance from bottom edge, or 'Center' --&gt;
    &lt;/popupFixedPosition&gt;
  &lt;/resize&gt;
  &lt;!-- You can reserve a portion of your screen where windows will not cover when
     they are maximized, or when they are initially placed.
     Many programs reserve space automatically, but you can use this in other
     cases. --&gt;
  &lt;margins&gt;
    &lt;top&gt;0&lt;/top&gt;
    &lt;bottom&gt;0&lt;/bottom&gt;
    &lt;left&gt;0&lt;/left&gt;
    &lt;right&gt;0&lt;/right&gt;
  &lt;/margins&gt;
  &lt;dock&gt;
    &lt;position&gt;TopLeft&lt;/position&gt;
    &lt;!-- (Top|Bottom)(Left|Right|)|Top|Bottom|Left|Right|Floating --&gt;
    &lt;floatingX&gt;0&lt;/floatingX&gt;
    &lt;floatingY&gt;0&lt;/floatingY&gt;
    &lt;noStrut&gt;no&lt;/noStrut&gt;
    &lt;stacking&gt;Above&lt;/stacking&gt;
    &lt;!-- 'Above', 'Normal', or 'Below' --&gt;
    &lt;direction&gt;Vertical&lt;/direction&gt;
    &lt;!-- 'Vertical' or 'Horizontal' --&gt;
    &lt;autoHide&gt;no&lt;/autoHide&gt;
    &lt;hideDelay&gt;300&lt;/hideDelay&gt;
    &lt;!-- in milliseconds (1000 = 1 second) --&gt;
    &lt;showDelay&gt;300&lt;/showDelay&gt;
    &lt;!-- in milliseconds (1000 = 1 second) --&gt;
    &lt;moveButton&gt;Middle&lt;/moveButton&gt;
    &lt;!-- 'Left', 'Middle', 'Right' --&gt;
  &lt;/dock&gt;
  &lt;keyboard&gt;
    &lt;chainQuitKey&gt;C-g&lt;/chainQuitKey&gt;
    &lt;!-- Keybindings for desktop switching --&gt;
    &lt;keybind key="C-A-Left"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;left&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Right"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;right&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Up"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;up&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Down"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;down&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Left"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;left&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Right"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;right&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Up"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;up&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="S-A-Down"&gt;
      &lt;action name="SendToDesktop"&gt;
        &lt;to&gt;down&lt;/to&gt;
        &lt;wrap&gt;no&lt;/wrap&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F1"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;1&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F2"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;2&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F3"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;3&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-F4"&gt;
      &lt;action name="GoToDesktop"&gt;
        &lt;to&gt;4&lt;/to&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-d"&gt;
      &lt;action name="ToggleShowDesktop"/&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for windows --&gt;
    &lt;keybind key="A-F4"&gt;
      &lt;action name="Close"/&gt;
    &lt;/keybind&gt;
    &lt;keybind key="A-Escape"&gt;
      &lt;action name="Lower"/&gt;
      &lt;action name="FocusToBottom"/&gt;
      &lt;action name="Unfocus"/&gt;
    &lt;/keybind&gt;
    &lt;keybind key="A-space"&gt;
      &lt;action name="ShowMenu"&gt;
        &lt;menu&gt;client-menu&lt;/menu&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Take a screenshot of the current window with scrot when Alt+Print are pressed --&gt;
    &lt;keybind key="A-Print"&gt;
      &lt;action name="Execute"&gt;
        &lt;command&gt;scrot -s&lt;/command&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for window switching --&gt;
    &lt;keybind key="A-Tab"&gt;
      &lt;action name="NextWindow"&gt;
        &lt;finalactions&gt;
          &lt;action name="Focus"/&gt;
          &lt;action name="Raise"/&gt;
          &lt;action name="Unshade"/&gt;
        &lt;/finalactions&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="A-S-Tab"&gt;
      &lt;action name="PreviousWindow"&gt;
        &lt;finalactions&gt;
          &lt;action name="Focus"/&gt;
          &lt;action name="Raise"/&gt;
          &lt;action name="Unshade"/&gt;
        &lt;/finalactions&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="C-A-Tab"&gt;
      &lt;action name="NextWindow"&gt;
        &lt;panels&gt;yes&lt;/panels&gt;
        &lt;desktop&gt;yes&lt;/desktop&gt;
        &lt;finalactions&gt;
          &lt;action name="Focus"/&gt;
          &lt;action name="Raise"/&gt;
          &lt;action name="Unshade"/&gt;
        &lt;/finalactions&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;!-- Keybindings for window switching with the arrow keys --&gt;
    &lt;keybind key="W-S-Right"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;right&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-S-Left"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;left&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-S-Up"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;up&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
    &lt;keybind key="W-S-Down"&gt;
      &lt;action name="DirectionalCycleWindows"&gt;
        &lt;direction&gt;down&lt;/direction&gt;
      &lt;/action&gt;
    &lt;/keybind&gt;
  &lt;/keyboard&gt;
  &lt;mouse&gt;
    &lt;dragThreshold&gt;1&lt;/dragThreshold&gt;
    &lt;!-- number of pixels the mouse must move before a drag begins --&gt;
    &lt;doubleClickTime&gt;500&lt;/doubleClickTime&gt;
    &lt;!-- in milliseconds (1000 = 1 second) --&gt;
    &lt;screenEdgeWarpTime&gt;400&lt;/screenEdgeWarpTime&gt;
    &lt;!-- Time before changing desktops when the pointer touches the edge of the
       screen while moving a window, in milliseconds (1000 = 1 second).
       Set this to 0 to disable warping --&gt;
    &lt;screenEdgeWarpMouse&gt;false&lt;/screenEdgeWarpMouse&gt;
    &lt;!-- Set this to TRUE to move the mouse pointer across the desktop when
       switching due to hitting the edge of the screen --&gt;
    &lt;context name="Frame"&gt;
      &lt;mousebind button="A-Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Left" action="Click"&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Left" action="Drag"&gt;
        &lt;action name="Move"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Right" action="Drag"&gt;
        &lt;action name="Resize"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Middle" action="Press"&gt;
        &lt;action name="Lower"/&gt;
        &lt;action name="FocusToBottom"/&gt;
        &lt;action name="Unfocus"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-S-Up" action="Click"&gt;
        &lt;action name="SendToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-S-Down" action="Click"&gt;
        &lt;action name="SendToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Titlebar"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Move"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="DoubleClick"&gt;
        &lt;action name="ToggleMaximize"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Up" action="Click"&gt;
        &lt;action name="if"&gt;
          &lt;shaded&gt;no&lt;/shaded&gt;
          &lt;then&gt;
            &lt;action name="Shade"/&gt;
            &lt;action name="FocusToBottom"/&gt;
            &lt;action name="Unfocus"/&gt;
            &lt;action name="Lower"/&gt;
          &lt;/then&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Down" action="Click"&gt;
        &lt;action name="if"&gt;
          &lt;shaded&gt;yes&lt;/shaded&gt;
          &lt;then&gt;
            &lt;action name="Unshade"/&gt;
            &lt;action name="Raise"/&gt;
          &lt;/then&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Titlebar Top Right Bottom Left TLCorner TRCorner BRCorner BLCorner"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="Lower"/&gt;
        &lt;action name="FocusToBottom"/&gt;
        &lt;action name="Unfocus"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Top"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;top&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Left"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;left&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Right"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;right&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Bottom"&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"&gt;
          &lt;edge&gt;bottom&lt;/edge&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="TRCorner BRCorner TLCorner BLCorner"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Drag"&gt;
        &lt;action name="Resize"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Client"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Icon"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="AllDesktops"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="ToggleOmnipresent"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Shade"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="ToggleShade"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Iconify"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="Iconify"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Maximize"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="ToggleMaximize"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Middle" action="Click"&gt;
        &lt;action name="ToggleMaximize"&gt;
          &lt;direction&gt;vertical&lt;/direction&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Click"&gt;
        &lt;action name="ToggleMaximize"&gt;
          &lt;direction&gt;horizontal&lt;/direction&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Close"&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
        &lt;action name="Unshade"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Click"&gt;
        &lt;action name="Close"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Desktop"&gt;
      &lt;mousebind button="Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="C-A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Left" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="Focus"/&gt;
        &lt;action name="Raise"/&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="Root"&gt;
      &lt;!-- Menus --&gt;
      &lt;mousebind button="Middle" action="Press"&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;client-list-combined-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Right" action="Press"&gt;
        &lt;action name="ShowMenu"&gt;
          &lt;menu&gt;root-menu&lt;/menu&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
    &lt;context name="MoveResize"&gt;
      &lt;mousebind button="Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Up" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;previous&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
      &lt;mousebind button="A-Down" action="Click"&gt;
        &lt;action name="GoToDesktop"&gt;
          &lt;to&gt;next&lt;/to&gt;
        &lt;/action&gt;
      &lt;/mousebind&gt;
    &lt;/context&gt;
  &lt;/mouse&gt;
  &lt;menu&gt;
    &lt;!-- You can specify more than one menu file in here and they are all loaded,
       just don't make menu ids clash or, well, it'll be kind of pointless --&gt;
    &lt;!-- default menu file (or custom one in $HOME/.config/openbox/) --&gt;
    &lt;!-- system menu files on Debian systems --&gt;
    &lt;file&gt;/var/lib/openbox/debian-menu.xml&lt;/file&gt;
    &lt;file&gt;menu.xml&lt;/file&gt;
    &lt;hideDelay&gt;200&lt;/hideDelay&gt;
    &lt;!-- if a press-release lasts longer than this setting (in milliseconds), the
       menu is hidden again --&gt;
    &lt;middle&gt;no&lt;/middle&gt;
    &lt;!-- center submenus vertically about the parent entry --&gt;
    &lt;submenuShowDelay&gt;100&lt;/submenuShowDelay&gt;
    &lt;!-- time to delay before showing a submenu after hovering over the parent
       entry.
       if this is a negative value, then the delay is infinite and the
       submenu will not be shown until it is clicked on --&gt;
    &lt;submenuHideDelay&gt;400&lt;/submenuHideDelay&gt;
    &lt;!-- time to delay before hiding a submenu when selecting another
       entry in parent menu
       if this is a negative value, then the delay is infinite and the
       submenu will not be hidden until a different submenu is opened --&gt;
    &lt;showIcons&gt;yes&lt;/showIcons&gt;
    &lt;!-- controls if icons appear in the client-list-(combined-)menu --&gt;
    &lt;manageDesktops&gt;yes&lt;/manageDesktops&gt;
    &lt;!-- show the manage desktops section in the client-list-(combined-)menu --&gt;
  &lt;/menu&gt;
    &lt;!--
  # this is an example with comments through out. use these to make your
  # own rules, but without the comments of course.
  # you may use one or more of the name/class/role/title/type rules to specify
  # windows to match

  &lt;application name="the window's _OB_APP_NAME property (see obxprop)"
              class="the window's _OB_APP_CLASS property (see obxprop)"
          groupname="the window's _OB_APP_GROUP_NAME property (see obxprop)"
         groupclass="the window's _OB_APP_GROUP_CLASS property (see obxprop)"
               role="the window's _OB_APP_ROLE property (see obxprop)"
              title="the window's _OB_APP_TITLE property (see obxprop)"
               type="the window's _OB_APP_TYPE property (see obxprob)..
                      (if unspecified, then it is 'dialog' for child windows)"&gt;
  # you may set only one of name/class/role/title/type, or you may use more
  # than one together to restrict your matches.

  # the name, class, role, and title use simple wildcard matching such as those
  # used by a shell. you can use * to match any characters and ? to match
  # any single character.

  # the type is one of: normal, dialog, splash, utility, menu, toolbar, dock,
  #    or desktop

  # when multiple rules match a window, they will all be applied, in the
  # order that they appear in this list


    # each rule element can be left out or set to 'default' to specify to not
    # change that attribute of the window

    &lt;decor&gt;yes&lt;/decor&gt;
    # enable or disable window decorations

    &lt;shade&gt;no&lt;/shade&gt;
    # make the window shaded when it appears, or not

    &lt;position force="no"&gt;
      # the position is only used if both an x and y coordinate are provided
      # (and not set to 'default')
      # when force is "yes", then the window will be placed here even if it
      # says you want it placed elsewhere.  this is to override buggy
      # applications who refuse to behave
      &lt;x&gt;center&lt;/x&gt;
      # a number like 50, or 'center' to center on screen. use a negative number
      # to start from the right (or bottom for &lt;y&gt;), ie -50 is 50 pixels from
      # the right edge (or bottom). use 'default' to specify using value
      # provided by the application, or chosen by openbox, instead.
      &lt;y&gt;200&lt;/y&gt;
      &lt;monitor&gt;1&lt;/monitor&gt;
      # specifies the monitor in a xinerama setup.
      # 1 is the first head, or 'mouse' for wherever the mouse is
    &lt;/position&gt;

    &lt;size&gt;
      # the size to make the window.
      &lt;width&gt;20&lt;/width&gt;
      # a number like 20, or 'default' to use the size given by the application.
      # you can use fractions such as 1/2 or percentages such as 75% in which
      # case the value is relative to the size of the monitor that the window
      # appears on.
      &lt;height&gt;30%&lt;/height&gt;
    &lt;/size&gt;

    &lt;focus&gt;yes&lt;/focus&gt;
    # if the window should try be given focus when it appears. if this is set
    # to yes it doesn't guarantee the window will be given focus. some
    # restrictions may apply, but Openbox will try to

    &lt;desktop&gt;1&lt;/desktop&gt;
    # 1 is the first desktop, 'all' for all desktops

    &lt;layer&gt;normal&lt;/layer&gt;
    # 'above', 'normal', or 'below'

    &lt;iconic&gt;no&lt;/iconic&gt;
    # make the window iconified when it appears, or not

    &lt;skip_pager&gt;no&lt;/skip_pager&gt;
    # asks to not be shown in pagers

    &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    # asks to not be shown in taskbars. window cycling actions will also
    # skip past such windows

    &lt;fullscreen&gt;yes&lt;/fullscreen&gt;
    # make the window in fullscreen mode when it appears

    &lt;maximized&gt;true&lt;/maximized&gt;
    # 'Horizontal', 'Vertical' or boolean (yes/no)
  &lt;/application&gt;

  # end of the example
--&gt;
  &lt;applications&gt;
    &lt;application title="softhddevice"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="softhdcuvid"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="vaapidevice"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application class="VDR"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="browser"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
    &lt;application title="osd2Web"&gt;
      &lt;decor&gt;no&lt;/decor&gt;
      &lt;maximized&gt;yes&lt;/maximized&gt;
      &lt;!--&lt;skip_pager&gt;yes&lt;/skip_pager&gt;--&gt;
      &lt;skip_taskbar&gt;no&lt;/skip_taskbar&gt;
    &lt;/application&gt;
  &lt;/applications&gt;
&lt;/openbox_config&gt;

</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org4c70fe5"></a>Systemd User Session<br />
<ol class="org-ol">
<li><a id="org06d95cc"></a>yavdr-desktop.target<br />
<div class="outline-text-6" id="text-6-16-3-3-1">
<div class="org-src-container">
<pre class="src src-shell">[Unit]
Description=yaVDR Desktop
Requires=default.target
After=default.target pulseaudio.service
Wants=dbus.service pulseaudio.service
AllowIsolate=yes
</pre>
</div>
</div>
</li>
<li><a id="org1c64cc9"></a>detect-second-display<br />
<div class="outline-text-6" id="text-6-16-3-3-2">
<div class="org-src-container">
<pre class="src src-shell">#!/bin/bash
source &lt;(systemctl --user show-environment)
SECOND_DISPLAY="${DISPLAY%\.[0-9]*}.1"
if xrandr -d "$SECOND_DISPLAY" -q | grep -q "connected"; then
    [ "$DISPLAY" != "$SECOND_DISPLAY" ] &amp;&amp; d="DISPLAY=$SECOND_DISPLAY" || d="DISPLAY=$DISPLAY"
    echo "$d" &gt; ~/.second_display;
else
    rm -f ~/.second_display
fi
</pre>
</div>
<div class="org-src-container">
<pre class="src src-conf">[Unit]
Description=Detect second DISPLAY using xrandr

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=%h/bin/detect-second-display

[Install]
WantedBy=yavdr-desktop.target
</pre>
</div>
</div>
</li>
<li><a id="org64ebe75"></a>switch-displays<br />
<div class="outline-text-6" id="text-6-16-3-3-3">
<p>
This script exchanges the primary and secondary screen. It needs access to the systemd user session.
</p>
<div class="org-src-container">
<pre class="src src-shell">#!/bin/bash
source &lt;(systemctl --user show-environment)
[[ "$DISPLAY" =~ \.1$ ]] &amp;&amp; DISPLAY="${DISPLAY%.1}.0" || DISPLAY="${DISPLAY%.0}.1"

frontend-dbus-send stop
systemctl --user stop osd2web
frontend-dbus-send setDisplay "$DISPLAY"
systemctl --user start osd2web
frontend-dbus-send start
</pre>
</div>
</div>
</li>
<li><a id="org28427e4"></a>openbox-second.service<br />
<div class="outline-text-6" id="text-6-16-3-3-4">
<div class="org-src-container">
<pre class="src src-conf">[Unit]
Description=Start openbox on the second DISPLAY if it exists
After=detect-second-display.service
Wants=detect-second-display.service
Before=yavdr-frontend.service
ConditionFileNotEmpty=%h/.second_display

[Service]
EnvironmentFile=%h/.second_display
ExecStart=/usr/bin/openbox --config-file %h/.config/openbox/rc2.xml
ExecStartPost=/usr/bin/xset -dpms s off -display $DISPLAY
ExecStartPost=/usr/bin/feh --no-fehbg --bg-center "/usr/share/yavdr/images/yavdr_logo.png"

[Install]
WantedBy=yavdr-desktop.target
</pre>
</div>
</div>
</li>
<li><a id="org0254413"></a>osd2web.service<br />
<div class="outline-text-6" id="text-6-16-3-3-5">
<div class="org-src-container">
<pre class="src src-conf">[Unit]
Description=Start a kiosk browser on the second DISPLAY if it exists
After=detect-second-display.service openbox-second.service
Wants=detect-second-display.service openbox-second.service
ConditionFileNotEmpty=%h/.second_display

[Service]
EnvironmentFile=%h/.second_display
Environment=url="http://localhost:4444/skins/horchiTft/index.html?theme=anthraize&amp;onlyView=1"
Environment=browser={{"kiosk-browser" if nvidia_detected | bool else "firefox --no-remote --kiosk --private-window"  }}
EnvironmentFile=-%h/.config/osd2web/config
ExecStart=/usr/bin/on_vdr -o -c '${browser} "${url}"'
KillSignal=SIGINT

[Install]
WantedBy=yavdr-desktop.target
</pre>
</div>
</div>
</li>
<li><a id="org29f7948"></a>wm-exit.service<br />
<div class="outline-text-6" id="text-6-16-3-3-6">
<div class="org-src-container">
<pre class="src src-conf">[Unit]
Description=exit window manager gracefully

[Service]
ExecStart=/bin/true
ExecStop=/usr/bin/openbox --exit
RemainAfterExit=True

[Install]
WantedBy=default.target
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="orgbbd14b4"></a>irexec<br />
<div class="outline-text-5" id="text-6-16-3-4">
<p>
irexec.service starts irexec for the user session
</p>
<div class="org-src-container">
<pre class="src src-shell">[Unit]
Description=LIRC command handler

[Service]
Type=simple
ExecStart=/usr/bin/irexec %h/.lircrc

[Install]
WantedBy=yavdr-desktop.target
</pre>
</div>
<p>
~/.lircrc contains the irexec configuration
</p>
<div class="org-src-container">
<pre class="src src-shell">begin
    prog = irexec
    button = KEY_HOME
    config = frontend-dbus-send switchbetween kodi vdr
end
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org3c9009f" class="outline-3">
<h3 id="org3c9009f"><span class="section-number-3">6.17</span> samba-install</h3>
<div class="outline-text-3" id="text-6-17">
</div>
<div id="outline-container-org85785b6" class="outline-4">
<h4 id="org85785b6"><span class="section-number-4">6.17.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-17-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/samba-install/tasks/main.yml

- name: install samba server
  apt:
    name:
      - samba
      - samba-common
      - samba-common-bin
      - tdb-tools
    state: present
    install_recommends: no

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb6bb1bd" class="outline-3">
<h3 id="orgb6bb1bd"><span class="section-number-3">6.18</span> samba-config</h3>
<div class="outline-text-3" id="text-6-18">
</div>
<div id="outline-container-org6153f74" class="outline-4">
<h4 id="org6153f74"><span class="section-number-4">6.18.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-18-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/samba-config/tasks/main.yml

# TODO:
# - name: divert original smbd.conf

- name: touch smb.conf.custom
  file:
    state: touch
    dest: '/etc/samba/smb.conf.custom'
  notify: [ 'Restart Samba' ]

- name: expand template for smb.conf
  template:
    src: 'templates/smb.conf.j2'
    dest: '/etc/samba/smb.conf'
    #validate: 'testparm -s %s'
  notify: [ 'Restart Samba' ]
</pre>
</div>
</div>
</div>
<div id="outline-container-orga8c41c7" class="outline-4">
<h4 id="orga8c41c7"><span class="section-number-4">6.18.2</span> templates</h4>
<div class="outline-text-4" id="text-6-18-2">
</div>
<ol class="org-ol">
<li><a id="orgd355436"></a>smb.conf<br />
<ol class="org-ol">
<li><a id="org81604bb"></a>global settings<br />
<div class="outline-text-6" id="text-6-18-2-1-1">
<div class="org-src-container">
<pre class="src src-yaml">{{ ansible_managed | comment }}

#======================= Global Settings =======================

[global]

## Browsing/Identification ###

# Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = {{ samba.workgroup }}

# server string is the equivalent of the NT Description field
   server string = %h server (Samba, Ubuntu)

# This will prevent nmbd to search for NetBIOS names through DNS.
   dns proxy = no

#### Debugging/Accounting ####

# This tells Samba to use a separate log file for each machine
# that connects
   log file = /var/log/samba/log.%m

# Cap the size of the individual log files (in KiB).
   max log size = 1000

# We want Samba to log a minimum amount of information to syslog. Everything
# should go to /var/log/samba/log.{smbd,nmbd} instead. If you want to log
# through syslog you should set the following parameter to something higher.
   syslog = 0

# Do something sensible when Samba crashes: mail the admin a backtrace
   panic action = /usr/share/samba/panic-action %d


####### Authentication #######

# "security = user" is always a good idea. This will require a Unix account
# in this server for every user accessing the server. See
# /usr/share/doc/samba-doc/htmldocs/Samba3-HOWTO/ServerType.html
# in the samba-doc package for details.
#   security = user

# You may wish to use password encryption.  See the section on
# 'encrypt passwords' in the smb.conf(5) manpage before enabling.
   encrypt passwords = true

# If you are using encrypted passwords, Samba will need to know what
# password database type you are using.
   passdb backend = tdbsam

   obey pam restrictions = yes

# This boolean parameter controls whether Samba attempts to sync the Unix
# password with the SMB password when the encrypted SMB password in the
# passdb is changed.
   unix password sync = yes

# For Unix password sync to work on a Debian GNU/Linux system, the following
# parameters must be set (thanks to Ian Kahan &lt;&lt;kahan@informatik.tu-muenchen.de&gt; for
# sending the correct chat script for the passwd program in Debian Sarge).
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .

# This boolean controls whether PAM will be used for password changes
# when requested by an SMB client instead of the program listed in
# 'passwd program'. The default is 'no'.
   pam password change = yes

# This option controls how unsuccessful authentication attempts are mapped
# to anonymous connections
   map to guest = bad password
   guest account = nobody

{% if samba.windows_compatible %}
# disable unix extensions and enable following symlinks
   unix extensions = no
   follow symlinks= yes
   wide links= yes
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="orgb1ba91a"></a>media directories<br />
<div class="outline-text-6" id="text-6-18-2-1-2">
<div class="org-src-container">
<pre class="src src-yaml">{% for name, path in media_dirs.items() | list %}
[{{ name }}]
   path = {{ path }}
   comment = {{ name }} on %h
   guest ok = yes
   writeable = yes
   browseable = yes
   create mode = 0664
   directory mode = 0775
   force user = {{ vdr.user }}
   force group = {{ vdr.group }}
   follow symlinks = yes
   wide links = yes

{% endfor %}
</pre>
</div>
</div>
</li>
<li><a id="org83315c6"></a>include custom samba exports<br />
<div class="outline-text-6" id="text-6-18-2-1-3">
<div class="org-src-container">
<pre class="src src-yaml">include = /etc/samba/smb.conf.custom
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="outline-container-org55daebe" class="outline-3">
<h3 id="org55daebe"><span class="section-number-3">6.19</span> autoinstall-ubuntu-drivers</h3>
<div class="outline-text-3" id="text-6-19">
<p>
The tool ubuntu-drivers is used to install the matching driver version for nvidia graphics cards, virtualbox guest additions and Intel and AMD microcode updates.
Please note that you need to disable this role if you are using nvidia drivers which are not in the official ubuntu package repositories.
</p>
</div>
<div id="outline-container-org5f1cef5" class="outline-4">
<h4 id="org5f1cef5"><span class="section-number-4">6.19.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-19-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-ubuntu-drivers/tasks/main.yml

- name: autoinstall ubuntu-drivers-common
  block:
    - name: apt | install ubuntu-drivers-common
      apt:
        name: ubuntu-drivers-common
        state: present

    - name: use ubuntu-drivers to install additional drivers automatically
      command: ubuntu-drivers --package-list /etc/yavdr/autoinstalled autoinstall
  when: (ansible_virtualization_type != "virtualbox" and ansible_virtualization_role != "guest")
        # ubuntu-drivers-common tries to autoinstall
        # conflicting packages for virtualbox in Ubuntu 16.04 and 18.04 :(
        # also alternates between virtualbox-guest-dkms and virtualbox-guest-dkms-hwe on successive runs
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7b78a56" class="outline-3">
<h3 id="org7b78a56"><span class="section-number-3">6.20</span> autoinstall-virtualbox-guest</h3>
<div class="outline-text-3" id="text-6-20">
<p>
This role installs the guest additions for virtualbox guests on Ubuntu 18.04
</p>

<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-virtualbox-guest/tasks/main.yml

- name: collect facts about installed packages
  package_facts:
    manager: "apt"

- name: install virtualbox guest additions
  block:
    - name: install packages
      apt:
        state: present
        name:
          - dkms
          - '{{ "virtualbox-guest-x11-hwe" if "xserver-xorg-hwe-18.04" in ansible_facts.packages else "virtualbox-guest-x11" }}'
          - '{{ "virtualbox-guest-dkms-hwe" if "linux-generic-hwe-18.04" in ansible_facts.packages else "virtualbox-guest-dkms" }}'

    # TODO: set xineliboutput as frontend
  when:
    - ansible_virtualization_type == "virtualbox"
    - ansible_virtualization_role == "guest"
    - ansible_distribution == "Ubuntu"

- name: set xineliboutput as frontend
  block:
    - apt:
        name:
          - vdr-plugin-xineliboutput
          - xineliboutput-sxfe
        state: present
    - command: '{{ item }}'
      loop:
        - vdrctl disable softhddevice
        - vdrctl disable vaapidevice
        - vdrctl disable xine
        - vdrctl disable pvr350
        - vdrctl enable xineliboutput
      ignore_errors: yes
  when:
    - ansible_virtualization_type in ["virtualbox", "VirtualPC", "VMware"]
    - ansible_virtualization_role == "guest"
</pre>
</div>
</div>
</div>
<div id="outline-container-org943d820" class="outline-3">
<h3 id="org943d820"><span class="section-number-3">6.21</span> autoinstall-atric-usb</h3>
<div class="outline-text-3" id="text-6-21">
</div>
<div id="outline-container-org1feb789" class="outline-4">
<h4 id="org1feb789"><span class="section-number-4">6.21.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-21-1">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
    - { role: collect-facts }
    - { role: yavdr-remote }

</pre>
</div>
</div>
</div>
<div id="outline-container-orgca19651" class="outline-4">
<h4 id="orgca19651"><span class="section-number-4">6.21.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-21-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-atric-usb/tasks/main.yml

- name: install and configure Atric IR-WakeupUSB
  block:
    - name: apt | install lirc-drv-irman
      apt:
        name: lirc-drv-irman
        state: present
      tags:
        - packages

    - name: write lirc configuration
      template:
        src: templates/lirc_options.conf.j2
        dest: /etc/lirc/lirc_options.conf
      tags:
        - config
        - systemd

    - name: run udevadm trigger to force udev rule to create symlinks
      shell: udevadm trigger -c add -s tty -w /dev/ttyACM*
      args:
          warn: no

    - name: enable lircd, eventlircd, lircd2uinput
      systemd:
        name: '{{ item }}'
        enabled: yes
        state: started
        masked: no
        daemon_reload: yes
      loop:
        - eventlircd.service
        - lircd2uinput.service
        - lircd.service
      tags:
        - systemd

  when: '"04d8:f844" in usb'
</pre>
</div>
</div>
</div>
<div id="outline-container-org8f88a36" class="outline-4">
<h4 id="org8f88a36"><span class="section-number-4">6.21.3</span> templates</h4>
<div class="outline-text-4" id="text-6-21-3">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}

[lircd]
nodaemon        = False
driver          = irman
device          = /dev/irman
output          = /var/run/lirc/lircd0
pidfile         = /var/run/lirc/lircd0.pid
plugindir       = /usr/lib/x86_64-linux-gnu/lirc/plugins
permission      = 666
allow-simulate  = No
repeat-max      = 600
#loglevel       = 6
#release        = true
#release_suffix = _EVUP
#logfile        = ...
#driver-options = ...

[lircmd]
uinput          = False
nodaemon        = False
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org18282f5" class="outline-3">
<h3 id="org18282f5"><span class="section-number-3">6.22</span> autoinstall-yausbir</h3>
<div class="outline-text-3" id="text-6-22">
</div>
<div id="outline-container-orgdbecb7a" class="outline-4">
<h4 id="orgdbecb7a"><span class="section-number-4">6.22.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-22-1">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
    - { role: yavdr-remote }

</pre>
</div>
</div>
</div>
<div id="outline-container-orgb6939be" class="outline-4">
<h4 id="orgb6939be"><span class="section-number-4">6.22.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-22-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-atric-usb/tasks/main.yml

- name: install and configure Atric IR-WakeupUSB
  block:
    - name: apt | install lirc-drv-yausbir
      apt:
        name: lirc-drv-yausbir
        state: present
      tags:
        - packages

    - name: write lirc configuration
      template:
        src: templates/lirc_options.conf.j2
        dest: /etc/lirc/lirc_options.conf
      tags:
        - config
        - systemd

    - name: enable lircd, eventlircd, lircd2uinput
      systemd:
        name: '{{ item }}'
        enabled: yes
        state: started
        masked: no
        daemon_reload: yes
      loop:
        - eventlircd.service
        - lircd2uinput.service
        - lircd.service
      tags:
        - systemd

  when: '"10c4:876c" in usb'
</pre>
</div>
</div>
</div>
<div id="outline-container-org5a74fb5" class="outline-4">
<h4 id="org5a74fb5"><span class="section-number-4">6.22.3</span> templates</h4>
<div class="outline-text-4" id="text-6-22-3">
<div class="org-src-container">
<pre class="src src-conf">{{ ansible_managed | comment }}

[lircd]
nodaemon        = False
driver          = ya_usbir
output          = /var/run/lirc/lircd0
pidfile         = /var/run/lirc/lircd0.pid
plugindir       = /usr/lib/x86_64-linux-gnu/lirc/plugins
permission      = 666
allow-simulate  = No
repeat-max      = 600
#loglevel       = 6
#release        = true
#release_suffix = _EVUP
#logfile        = ...
#driver-options = ...

[lircmd]
uinput          = False
nodaemon        = False
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7ef1917" class="outline-3">
<h3 id="org7ef1917"><span class="section-number-3">6.23</span> autoinstall-satip</h3>
<div class="outline-text-3" id="text-6-23">
<p>
If a Sat&gt;IP Server responds to a discovery request, the package vdr-plugin-satip is installed.
</p>
</div>
<div id="outline-container-orgc9077ca" class="outline-4">
<h4 id="orgc9077ca"><span class="section-number-4">6.23.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-23-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-satip/tasks/main.yml

- name: "detect SAT&gt;IP Server(s) on the network"
  action: satip_facts

- debug:
    var: satip_devices
    verbosity: 1

- name: apt | install vdr-plugin-satip if a Sat&gt;IP server has been detected
  apt:
    name: vdr-plugin-satip
    state: present
  when: satip_devices | length &gt; 0
  notify: [ 'Restart VDR' ]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org46c0e20" class="outline-3">
<h3 id="org46c0e20"><span class="section-number-3">6.24</span> autoinstall-targavfd</h3>
<div class="outline-text-3" id="text-6-24">
</div>
<div id="outline-container-org1bad9a8" class="outline-4">
<h4 id="org1bad9a8"><span class="section-number-4">6.24.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-24-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-targavfd/tasks/main.yml

- name: apt | install vdr-plugin-targavfd if connected
  apt:
    name: vdr-plugin-targavfd
  when: '"19c2:6a11" in usb'
  notify: [ 'Restart VDR' ]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org45d44a5" class="outline-3">
<h3 id="org45d44a5"><span class="section-number-3">6.25</span> autoinstall-imonlcd</h3>
<div class="outline-text-3" id="text-6-25">
<p>
This role handles IMON LCDs with USB-IDs <code>15c2:0038</code> and <code>15c2:ffdc</code>. According to <a href="http://www.vdr-wiki.de/wiki/index.php/Imonlcd-plugin#Beschreibung">http://www.vdr-wiki.de/wiki/index.php/Imonlcd-plugin#Beschreibung</a> there is a IMON VFD with USB-ID <code>15c2:ffdc</code>, which doesn&rsquo;t work with vdr-plugin-imonlcd. In this case please disable this role and adapt the role <code>autoinstall-imonvfd.</code>
</p>
</div>
<div id="outline-container-org076da3d" class="outline-4">
<h4 id="org076da3d"><span class="section-number-4">6.25.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-25-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-imonlcd/tasks/main.yml

- name: apt | install vdr-plugin-imonlcd if connected
  apt:
    name: vdr-plugin-imonlcd
  when: '"15c2:0038" in usb or "15c2:ffdc" in usb'
  notify: [ 'Restart VDR' ]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3f98564" class="outline-3">
<h3 id="org3f98564"><span class="section-number-3">6.26</span> autoinstall-imonvfd</h3>
<div class="outline-text-3" id="text-6-26">
<p>
This role handles IMON VFD devices with the USB-IDs <code>15c2:0036</code> and <code>15c2:0044</code>.
</p>
</div>
<div id="outline-container-org4888a43" class="outline-4">
<h4 id="org4888a43"><span class="section-number-4">6.26.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-26-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-imonvfd/tasks/main

- name: Set up IMON VFD
  block:
    - name: check which display type we got
      set_fact:
        imon_vfd_device: '{{ "imon_0044" if "15c2:0044" in usb else "imon_0036" }}'
    - name: apt | install lcdproc and vdr-plugin-lcdproc for IMON VFD
      apt:
        name:  vdr-plugin-lcdproc

    - name: copy udev rule for IMON VFD
      template:
        src: templates/92-imonvfd.rules.j2
        dest: /etc/udev/rules.d/92-imonvfd.rules
        mode: 0644
        force: yes
      notify: [ 'reboot required' ]

    - name: expand template for /etc/LCDd.conf
      template:
        src: templates/LCDd.conf.j2
        dest: /etc/LCDd.conf
        owner: root
        group: root
        mode: 0644
        force: yes

    - name: enable service LCDd.service and ensure it is not masked
      systemd:
        name: LCDd.service
        state: started
        enabled: yes
        masked: no
        daemon_reload: yes

  when: '"15c2:0036" in usb or "15c2:0044" in usb'
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7ba45f" class="outline-4">
<h4 id="orgd7ba45f"><span class="section-number-4">6.26.2</span> templates</h4>
<div class="outline-text-4" id="text-6-26-2">
</div>
<ol class="org-ol">
<li><a id="org4fc27d6"></a>udev rules<br />
<div class="outline-text-5" id="text-6-26-2-1">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

ACTION=="add", KERNEL=="lcd*", SUBSYSTEMS=="usb", ATTRS{idVendor}=="15c2", ATTRS{idProduct}=="*", MODE="0660", GROUP="vdr"
ACTION=="add", KERNEL=="lcd*", SUBSYSTEMS=="usb", ATTRS{idVendor}=="15c2", ATTRS{idProduct}=="0036", MODE="0660", GROUP="vdr", SYMLINK+="imon_0036"
ACTION=="add", KERNEL=="lcd*", SUBSYSTEMS=="usb", ATTRS{idVendor}=="15c2", ATTRS{idProduct}=="0044", MODE="0660", GROUP="vdr", SYMLINK+="imon_0044"
</pre>
</div>
</div>
</li>

<li><a id="orgfefb5db"></a>lcdproc.conf<br />
<div class="outline-text-5" id="text-6-26-2-2">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

## This file was originally created by cme command.
## You can run 'cme edit lcdproc' to modify this file.
## You may also modify the content of this file with your favorite editor.

[server]
DriverPath = /usr/lib/x86_64-linux-gnu/lcdproc/
NextScreenKey = Right
PrevScreenKey = Left
ReportToSyslog = yes
ToggleRotateKey = Enter

Driver=imon
Bind=127.0.0.1
Port=13666
User=nobody
Hello=" "
Hello=" "
GoodBye=" "
GoodBye=" "
WaitTime=5
ServerScreen=no
Heartbeat=off

[menu]
DownKey = Down
EnterKey = Enter
MenuKey = Escape
UpKey = Up

[imon]
Device=/dev/{{imon_vfd_device}}
Size=16x2
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org1725c7e" class="outline-3">
<h3 id="org1725c7e"><span class="section-number-3">6.27</span> autoinstall-libcecdaemon</h3>
<div class="outline-text-3" id="text-6-27">
</div>
<div id="outline-container-org5ae24f2" class="outline-4">
<h4 id="org5ae24f2"><span class="section-number-4">6.27.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-27-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-libcec-daemon/tasks/main.yml

- name: apt | install libcec-daemon if connected
  apt:
    name: libcec-daemon
  when:
    - "2548:1002" in usb
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8de2d37" class="outline-3">
<h3 id="org8de2d37"><span class="section-number-3">6.28</span> autoinstall-pvr350</h3>
<div class="outline-text-3" id="text-6-28">
</div>
<div id="outline-container-org1912d04" class="outline-4">
<h4 id="org1912d04"><span class="section-number-4">6.28.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-28-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-pvr350/tasks/main.yml

- name: apt | install vdr-plugin-pvr350 if connected
  apt:
    name: vdr-plugin-pvr350
  when: '"0070:4000" in pci'
  notify: [ 'Restart VDR' ]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5a5d483" class="outline-3">
<h3 id="org5a5d483"><span class="section-number-3">6.29</span> autoinstall-hauppauge-pvr</h3>
<div class="outline-text-3" id="text-6-29">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-hauppauge-pvr/tasks/main.yml

- name: apt | install vdr-plugin-pvrinput if a haupauge pvr card is found
  apt:
    name: vdr-plugin-pvrinput
  when: '"0070:4000" in pci or "4444:0016" in pci'
  notify: [ 'Restart VDR' ]
</pre>
</div>
</div>
</div>
<div id="outline-container-orge89e1b3" class="outline-3">
<h3 id="orge89e1b3"><span class="section-number-3">6.30</span> autoinstall-firmware</h3>
<div class="outline-text-3" id="text-6-30">
</div>
<div id="outline-container-org5855b10" class="outline-4">
<h4 id="org5855b10"><span class="section-number-4">6.30.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-30-1">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
  - { role: collect-facts }

</pre>
</div>
</div>
</div>
<div id="outline-container-orge4ac9d3" class="outline-4">
<h4 id="orge4ac9d3"><span class="section-number-4">6.30.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-30-2">
<div class="org-src-container">
<pre class="src src-yaml">---

# This role provides easyily downloadable firmware files

- name: Firmware dvb-demod-si2168-b40-01.fw for Hauppauge WinTV HD Solo/Duo, PCTV 292e
  get_url:
    url: https://github.com/OpenELEC/dvb-firmware/raw/master/firmware/dvb-demod-si2168-b40-01.fw
    checksum: sha256:8507536630d75a316d0719d6b95c04b90c36baa5b457ad457c9bacadafcef134
    dest: /lib/firmware/dvb-demod-si2168-b40-01.fw
  when: '"2040:0264" in usb or "2013:025f" in usb'

- name: Firmware dvb-fe-xc5000-1.6.114.fw for Hauppauge WinTV-HVR-930C
  get_url:
    url: https://github.com/OpenELEC/dvb-firmware/raw/master/firmware/dvb-fe-xc5000-1.6.114.fw
    checksum: sha256:7104bda8df301fe1bd4c09de1708aeb6d0d8e1f9d55505449fecfad82639235f
    dest: /lib/firmware/dvb-fe-xc5000-1.6.114.fw
  when: '"2040:1605" in usb'

- name: Firmware ngenge_18.fw for ngene cards
  get_url:
    url: http://l4m-daten.de/downloads/firmware/dvb-s2/linux/all/ngene_18.fw
    checksum: sha256:213d98ec2cd575eba15d82ee79fed7098e670de43792f8aa773a95cfb7c32060
    dest: /lib/firmware/ngene_18.fw
  when: '"ngene" in modules'
  notify: reboot required

- name: Firmware drxk_a3.mc for drxk
  get_url:
     url: https://github.com/OpenELEC/dvb-firmware/raw/master/firmware/drxk_a3.mc
     checksum: sha256:f8956ad6f92a4ce90a6ab94ed23e2f9a27e9317e936fd3e0119778dd28e7e294
     dest: /lib/firmware/drxk_a3.mc
  when: '"ngene" in modules or "drxk" in modules'
  notify: reboot required
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org2adaa40" class="outline-3">
<h3 id="org2adaa40"><span class="section-number-3">6.31</span> autoinstall-dvbsky-firmware</h3>
<div class="outline-text-3" id="text-6-31">
</div>
<div id="outline-container-org8d0a974" class="outline-4">
<h4 id="org8d0a974"><span class="section-number-4">6.31.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-31-1">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
  - { role: collect-facts }

</pre>
</div>
</div>
</div>
<div id="outline-container-org2d2bf4e" class="outline-4">
<h4 id="org2d2bf4e"><span class="section-number-4">6.31.2</span> defaults</h4>
<div class="outline-text-4" id="text-6-31-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-dvbsky-firmware
dvbsky_firmware_files: []
</pre>
</div>
</div>
</div>
<div id="outline-container-org2d9e54c" class="outline-4">
<h4 id="org2d9e54c"><span class="section-number-4">6.31.3</span> tasks</h4>
<div class="outline-text-4" id="text-6-31-3">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-dvbsky-firmware/tasks/main.yml

- name: determine needed firmware files by device ids
  block:
    - name: add firmware files for DVBSky if a card has been detected
      set_fact:
        dvbsky_firmware_files: ['dvb-demod-m88ds3103.fw', 'dvb-demod-m88rs6000.fw', 'dvb-tuner-si2158-a20-01.fw', 'dvb-demod-si2168-a20-01.fw', 'dvb-demod-si2168-a30-01.fw', 'dvb-demod-si2168-b40-01.fw', 'dvb-fe-ds300x.fw', 'dvb-fe-ds3103.fw', 'dvb-fe-rs6000.fw']
      when:
        - '"1ade:3038" in pci'
  when:
    - not dvbsky_firmware_files

- name: Download firmware for DVBSky cards and copy required files to /lib/firmware
  block:
    # download and extract firmware
    - unarchive:
        src: http://www.dvbsky.net/download/linux/dvbsky-firmware.tar.gz
        dest: /tmp/
        remote_src: yes

    # copy firmware file
    - copy:
        src: "/tmp/dvbsky-firmware/{{ item }}"
        dest: /lib/firmware/
        owner: root
        group: root
        mode: 0644
      with_items: '{{ dvbsky_firmware_files }}'
      notify: ['Trigger Udev']

    # Remove temporary files
    - file:
        path: /tmp/dvbsky-firmware
        state: absent
  when:
    - dvbsky_firmware_files is defined
    - dvbsky_firmware_files | bool
  tags:
    - install
    - autodetect
    - dvbsky
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org84a44c3" class="outline-3">
<h3 id="org84a44c3"><span class="section-number-3">6.32</span> autoinstall-dvbhddevice</h3>
<div class="outline-text-3" id="text-6-32">
<p>
How to get a driver for the TT-6400 FF card? Needed firmware files are in the <code>yavdr-firmware</code> package.
</p>
</div>
<div id="outline-container-org8b24cc4" class="outline-4">
<h4 id="org8b24cc4"><span class="section-number-4">6.32.1</span> defaults</h4>
<div class="outline-text-4" id="text-6-32-1">
<div class="org-src-container">
<pre class="src src-yaml">dvbhddevice_firmware:
  - { src: 'http://www.aregel.de/file_download/26/dvb-ttpremium-fpga-01_v1_10.zip', 'checksum': 'sha256:d5f0ecd1c687549d71a21269c25791554895d8c03ff580a9694ef24041952f69', 'name': 'dvb-ttpremium-fpga-01_v1_10.zip' }
  - { src: 'http://www.aregel.de/file_download/7/dvb-ttpremium-loader-01_v1_03.zip', 'checksum': 'sha256:99969d4740ca26332439590e6b6e86711c89be69cf94c3732267b8278c0da763', 'name': 'dvb-ttpremium-loader-01_v1_03.zip' }
  - { src: 'http://aregel.de/file_download/28/dvb-ttpremium-st7109-01_v0_5_1.zip',  'checksum': 'sha256:cf336310fdd0c6998e6efa59d17b39d1fdb682daea51b60faee66444545986d4', 'name': 'dvb-ttpremium-st7109-01_v0_5_1.zip' }
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc409a71" class="outline-4">
<h4 id="orgc409a71"><span class="section-number-4">6.32.2</span> dependencies</h4>
<div class="outline-text-4" id="text-6-32-2">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
    - { role: collect-facts }

</pre>
</div>
</div>
</div>
<div id="outline-container-org594b4c0" class="outline-4">
<h4 id="org594b4c0"><span class="section-number-4">6.32.3</span> tasks</h4>
<div class="outline-text-4" id="text-6-32-3">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-dvbhddevice/tasks/main.yml

- name: Download Firmware for TT-6400 FF and install vdr-plugin-dvbhddevice
  block:
    - name: apt | install vdr-plugin-dvbhddevice and unzip
      apt:
        name: 
          - vdr-plugin-dvbhddevice
          - unzip
        state: present
      notify: [ 'Restart VDR' ]

    - name: ensure /var/cache/firmware exists
      file:
        state: directory
        path: '/var/cache/firmware'
    - name: download TT-6400 FF firmware files
      get_url:
        url: '{{ item.src }}'
        dest: '/var/cache/firmware/{{ item.name }}'
        checksum: '{{ item.checksum }}'
      loop: "{{ dvbhddevice_firmware }}"

    - name: extract firmware files
      unarchive:
        src: '/var/cache/firmware/{{ item.name }}'
        dest: '/lib/firmware/'
        remote_src: yes
      loop: "{{ dvbhddevice_firmware }}"
      notify: [ 'reboot required' ]
        
  when: '"13c2:300a" in pci or "13c2:300b" in pci or force_dvbhddevice|default(False)|bool' 
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9153631" class="outline-3">
<h3 id="org9153631"><span class="section-number-3">6.33</span> autoinstall-dvbsddevice</h3>
<div class="outline-text-3" id="text-6-33">
</div>
<div id="outline-container-org5b55a1f" class="outline-4">
<h4 id="org5b55a1f"><span class="section-number-4">6.33.1</span> defaults</h4>
<div class="outline-text-4" id="text-6-33-1">
<div class="org-src-container">
<pre class="src src-yaml">dvbsddevice_firmware:
  - { src: 'https://linuxtv.org/downloads/firmware/dvb-ttpci-01.fw-2622', 'checksum': 'sha256:482e49f8aac3fa5ea464230ea3f0cf27e298b62680c33636cb1bf442ad6fb067', 'name': 'dvb-ttpci-01.fw' }
</pre>
</div>
</div>
</div>
<div id="outline-container-orgab86ec7" class="outline-4">
<h4 id="orgab86ec7"><span class="section-number-4">6.33.2</span> dependencies</h4>
<div class="outline-text-4" id="text-6-33-2">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
  - { role: collect-facts }

</pre>
</div>
</div>
</div>
<div id="outline-container-org894e86d" class="outline-4">
<h4 id="org894e86d"><span class="section-number-4">6.33.3</span> tasks</h4>
<div class="outline-text-4" id="text-6-33-3">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-dvbsddevice/tasks/main.yml

# TODO: install firmware

- name: Install firmware and output plugin for FF sd cards
  block:
    - name:
      get_url:
        url: '{{ item.src }}'
        dest: '/lib/firmware/{{ item.name }}'
        checksum: '{{ item.checksum }}'
      loop: "{{ dvbsddevice_firmware }}"
      notify: ['reboot required']

    - name: apt | install vdr-plugin-dvbsddevice if module is loaded
      apt:
        name: vdr-plugin-dvbsddevice
      notify: [ 'Restart VDR' ]
  when: '"dvb_ttpci" in modules or force_dvbsddevice|default(False)|bool'
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org763a6a8" class="outline-3">
<h3 id="org763a6a8"><span class="section-number-3">6.34</span> autoinstall-hardware-irmp</h3>
<div class="outline-text-3" id="text-6-34">
</div>
<div id="outline-container-orga9c40ae" class="outline-4">
<h4 id="orga9c40ae"><span class="section-number-4">6.34.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-34-1">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
  - { role: collect-facts }

</pre>
</div>
</div>
</div>
<div id="outline-container-org865b8ed" class="outline-4">
<h4 id="org865b8ed"><span class="section-number-4">6.34.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-34-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/autoinstall-hardware-irmp/tasks/main.yml

- name: apt | install yavdr-hardware-irmp if connected
  apt:
    name: yavdr-hardware-irmp
    state: present
  when: '"1209:4444" in usb or "16c0:27d9" in usb'
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge08aa71" class="outline-3">
<h3 id="orge08aa71"><span class="section-number-3">6.35</span> Serial IR Receivers</h3>
<div class="outline-text-3" id="text-6-35">
<p>
This role preconfigures the system for serial &ldquo;homebrew&rdquo; receivers. Newer kernel versions provide <code>serial_ir</code> which acts as a rc-core driver, so we don&rsquo;t need lircd - eventlircd can use the device directly.
</p>

<p>
As configured in the role yavdr-remote (<a href="#org9957496">/etc/rc_maps.cfg</a>) a keytable for a RC-6 MCE remote is loaded by default. You can choose a different keymap which may also use another ir-protocol.
</p>
</div>
<div id="outline-container-org0cde7e7" class="outline-4">
<h4 id="org0cde7e7"><span class="section-number-4">6.35.1</span> defaults</h4>
<div class="outline-text-4" id="text-6-35-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/serial-ir/defaults/main.yml

serial_ir_device: ttyS0
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf83611a" class="outline-4">
<h4 id="orgf83611a"><span class="section-number-4">6.35.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-35-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/serial-ir/tasks/main.yml

- name: apt | install setserial
  apt:
    name: setserial

- name: load serial_ir on startup
  template:
    src: roles/serial-ir/templates/modules-load.d/serial_ir.conf.j2
    dest: /etc/modules-load.d/serial_ir.conf

- name: serial_ir module options
  template:
    src: roles/serial-ir/templates/modprobe.d/serial_ir.conf.j2
    dest: /etc/modprobe.d/serial_ir.conf

- name: setserial options
  template:
    src: roles/serial-ir/templates/serial.conf.j2
    dest: /etc/serial.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-org9154af0" class="outline-4">
<h4 id="org9154af0"><span class="section-number-4">6.35.3</span> templates</h4>
<div class="outline-text-4" id="text-6-35-3">
</div>
<ol class="org-ol">
<li><a id="org6476bad"></a>load serial_ir on startup<br />
<div class="outline-text-5" id="text-6-35-3-1">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

serial_ir
</pre>
</div>
</div>
</li>
<li><a id="orge4eb2af"></a>serial_ir module options<br />
<div class="outline-text-5" id="text-6-35-3-2">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

{% if serial_ir_device == "ttyS0" %}
#COM1 equivalent, /dev/ttyS0
options serial_ir irq=4 io=0x3f8
{% elif serial_ir_device == "ttyS1" %}
#COM2 equivalent, /dev/ttyS1
options serial_ir irq=3 io=0x2f8
{% endif %}
{% if serial_ir_device in ("ttyS0", "ttyS1") %}
install serial_ir setserial /dev/{{serial_ir_device}} uart none; /sbin/modprobe --ignore-install serial_ir
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="orgab3ca4c"></a>setserial options<br />
<div class="outline-text-5" id="text-6-35-3-3">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

{% if serial_ir_device == "ttyS0" %}
#COM1 equivalent, /dev/ttyS0
/dev/ttyS0 uart none
{% elif serial_ir_device == "ttyS1" %}
#COM2 equivalent, /dev/ttyS1
/dev/ttyS1 uart none
{% endif %}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgb615010" class="outline-3">
<h3 id="orgb615010"><span class="section-number-3">6.36</span> kodi</h3>
<div class="outline-text-3" id="text-6-36">
</div>
<div id="outline-container-org029e010" class="outline-4">
<h4 id="org029e010"><span class="section-number-4">6.36.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-36-1">
</div>
<ol class="org-ol">
<li><a id="org963ed96"></a>Install KODI<br />
<ul class="org-ul">
<li><a id="org6582ece"></a>main.yml<br />
<div class="outline-text-6" id="text-org6582ece">
<div class="org-src-container">
<pre class="src src-yaml">- import_tasks: install-kodi.yml
  tags:
    - install
    - update
    - kodi:install
- import_tasks: configure-kodi.yml
  tags:
    - install
    - update
    - kodi:configure
</pre>
</div>
</div>
</li>
<li><a id="org7925a65"></a>install-kodi.yml<br />
<div class="outline-text-6" id="text-6-36-1-1-1">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: apt | install kodi packages
  apt:
    name:
      - kodi
      - kodi-pvr-vdr-vnsi
      - python3-lxml
    state: present
    install_recommends: no

- name: apt | install kodi-send (team-xbmc PPA)
  apt:
    name: "kodi-eventclients-xbmc-send" # team-xbmc uses "kodi-eventclients-xbmc-send for some reason
    state: present
    install_recommends: no
  register: team_xbmc_ppa
  ignore_errors: True

- name: apt | install kodi-send (Ubuntu package)
  apt:
    name: "kodi-eventclients-kodi-send" # fallback to ubuntu package
    state: present
    install_recommends: no
  when: team_xbmc_ppa.failed
</pre>
</div>
</div>
</li>
<li><a id="orgda90c70"></a>configure-kodi.yml<br />
<div class="outline-text-6" id="text-6-36-1-1-2">
<div class="org-src-container">
<pre class="src src-yaml">- name: create kodi.service for the user session
  template:
      src: 'templates/kodi.service.j2'
      dest: '{{ vdr.home }}/.config/systemd/user/kodi.service'
      mode: 0644
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'

- name: create kodi user directory
  file:
      dest: '{{ vdr.home }}/{{ item }}'
      state: directory
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'
      mode: "0775"
  with_items:
      - .kodi
      - .kodi/userdata
      - .kodi/userdata/keymaps

- name: copy Lircmap.xml if it does not exist yet
  copy:
      dest: '{{ vdr.home }}/.kodi/userdata/Lircmap.xml'
      src: 'files/userdata/Lircmap.xml'
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'    
      mode: "0664"
      force: no

- name: copy remote.xml if it does not exist yet
  copy:
      dest: '{{ vdr.home }}/.kodi/userdata/keymaps/remote.xml'
      src: 'files/userdata/keymaps/remote.xml'
      owner: '{{ vdr.user }}'
      group: '{{ vdr.group }}'    
      mode: "0664"
      force: no

- name: expand template for set-kodi-display
  template:
    src: 'templates/set-kodi-display.j2'
    dest: '/usr/bin/set-kodi-display'
    mode: "0755"
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org55a59ea" class="outline-4">
<h4 id="org55a59ea"><span class="section-number-4">6.36.2</span> templates</h4>
<div class="outline-text-4" id="text-6-36-2">
</div>
<ol class="org-ol">
<li><a id="org5141f1a"></a>kodi.service<br />
<div class="outline-text-5" id="text-6-36-2-1">
<p>
This systemd unit for the user session starts (and stops) kodi.
</p>
<div class="org-src-container">
<pre class="src src-conf">[Unit]
Description=Start kodi in user session

[Service]
Type=simple
PassEnvironment=DISPLAY XDG_RUNTIME_DIR DBUS_SESSION_BUS_ADDRESS
Environment=LIRC_SOCKET_PATH=/run/lirc/lircd
ExecStartPre=-/usr/bin/set-kodi-display
ExecStart=/usr/bin/kodi
ExecStop=/bin/bash -c "[ -n \"$MAINPID\"  ] || exit 0; /usr/bin/kodi-send --action=QUIT; while ps -p $MAINPID -o comm=; do sleep .25; done"
TimeoutStopSec=10
SuccessExitStatus=0 127 SIGKILL
Restart=on-failure
</pre>
</div>
</div>
</li>
<li><a id="org54add4d"></a>set-kodi-diplay<br />
<div class="outline-text-5" id="text-6-36-2-2">
<p>
This is a version-dependent script to force KODI to use the display set by the environment variable <code>DISPLAY</code>. The following Version is intended for KODI 18.
</p>
<div class="org-src-container">
<pre class="src src-python">#!/usr/bin/env python3
"""
{{ ansible_managed }}

This Script changes the monitor in KODI's guisettings.xml to the wanted output
according to the DISPLAY environment variable. It works with KODI 18 (not KODI 17!).

In order to change the display we need to modify the settings/videoscreen nodes.

Basic algorithm:
    - get the current videoscreen.monitor
    - check if it needs to be changed
    - create a backup of the videoscreen nodes in /var/lib/vdr/.kodi/.display_cache/{CONNETOR}-videoscreen.xml
    - check if there is an existing backup for the new CONNECTOR
    - parse the backup of the videoscreen nodes
    - replace the videoscreen nodes with the backup data
"""

import copy
import logging
import os
import sys
import subprocess
from lxml import etree as ET

logging.basicConfig(format='%(levelname)s: %(message)s', level=logging.DEBUG)
GUISETTINGS = '/var/lib/vdr/.kodi/userdata/guisettings.xml'
CACHE_DIR = '/var/lib/vdr/.kodi/.display_cache'
VIDEOSCREEN_TEMPLATE = """&lt;settings version="2"&gt;
    &lt;setting id="videoscreen.monitor"&gt;{}&lt;/setting&gt;
&lt;/settings&gt;"""


def create_cache_dir():
    try:
        os.makedirs(CACHE_DIR, exist_ok=True)
    except PermissionError:
        sys.exit(f"Error: insufficient permissions to create cachedir {CACHE_DIR}")
    except Exception:
        logging.exception(f"Unexpected Error when trying to create {CACHE_DIR}:")
        sys.exit(1)



def get_output_name():
    """
    get display name from xrandr output for given DISPLAY environment variable
    """
    try:
        xrandr_output = [
            l for l in subprocess.check_output(
                ["xrandr"],
                env={"DISPLAY": os.environ["DISPLAY"]}
            ).decode("utf-8").splitlines()
        ]
        return next(l.split()[0] for l in xrandr_output if " connected " in l)
    except Exception:
        logging.exception("could not determine output name")
        sys.exit("output name unknown, exiting early")


def parse_template(template_path, template, output=""):
    """read videoscreen settings from backup or create a stub file"""
    def xml_tree_from_template(template, output):
        xml_template = ET.fromstring(template.format(output))
        xml_tree = ET.ElementTree(xml_template)
        return xml_tree

    try:
        xml_tree = ET.parse(template_path)
    except OSError:
        logging.debug(f"{template_path} not found, creating stub file")
        xml_tree = xml_tree_from_template(template, output)
    except ET.XMLSyntaxError as e:
        if e.msg.startswith('Document is empty'):
            logging.info(f"{template_path} is empty, creating stub file")
            xml_tree = xml_tree_from_template(template, output)
        else:
            sys.exit(f"Could not parse {template_path}, please fix file or remove it")
    finally:
        xml_tree.write(template_path)
    return xml_tree


def main(output):
    guisettings = parse_template(GUISETTINGS, VIDEOSCREEN_TEMPLATE, "Default")

    # parse guisettings Etree for display name an backup videoscreen data
    root = guisettings.getroot()
    old_output = root.find("./setting[@id='videoscreen.monitor']").text
    if old_output == output:
        logging.debug("no changes necessary, exiting")
        sys.exit()

    # create a minimal guisettings etree
    xml_path = os.path.join(CACHE_DIR, f'{old_output}-videoscreen.xml')
    base_tree = ET.fromstring('&lt;settings version="2"&gt;&lt;/settings&gt;')
    xml_tree = ET.ElementTree(base_tree)
    backup_root = xml_tree.getroot()

    # copy videoscreen elements to backup etree
    videoscreen_elements = root.xpath(
            "./setting[starts-with(@id, 'videoscreen.')]")
    for element in videoscreen_elements:
        backup_root.append(copy.deepcopy(element))
        element.getparent().remove(element)
    xml_tree.write(xml_path)
    logging.debug(f"written backup for {old_output} to {xml_path}")

    # change videoscreen node to content of backup file
    xml_path = os.path.join(CACHE_DIR, f'{output}-videoscreen.xml')
    videodir_xml = parse_template(xml_path, VIDEOSCREEN_TEMPLATE, output)
    videodir_root = videodir_xml.getroot()
    videoscreen = videodir_root.find("./setting[@id='videoscreen.monitor']")
    # copy videoscreen.* elements from Backup
    videoscreen_elements = videodir_root.xpath(
            "./setting[starts-with(@id, 'videoscreen.')]")
    for element in videoscreen_elements:
        new_element = copy.deepcopy(element)
        root.append(new_element)
    guisettings.write(GUISETTINGS)


if __name__ == '__main__':
    create_cache_dir()
    output = get_output_name()
    try:
        main(output)
    except Exception:
        logging.exception("Could not change videoscreen.* settings")
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4928a32" class="outline-4">
<h4 id="org4928a32"><span class="section-number-4">6.36.3</span> files</h4>
<div class="outline-text-4" id="text-6-36-3">
<p>
Those configuration files provide a preconfiguration for kodi which overrides the system wide configuration
</p>
</div>
<ol class="org-ol">
<li><a id="org153f6c1"></a>Lircmap.xml<br />
<div class="outline-text-5" id="text-6-36-3-1">
<p>
This file allows to map keys sent by remotes via eventlircd (which uses the name <code>devinput</code>) to kodi key names.
</p>
<div class="org-src-container">
<pre class="src src-nxml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;lircmap&gt;
	&lt;remote device="linux-input-layer"&gt;
	&lt;altname&gt;cx23885_remote&lt;/altname&gt;
	&lt;altname&gt;devinput&lt;/altname&gt;
		&lt;up&gt;KEY_UP&lt;/up&gt;
		&lt;down&gt;KEY_DOWN&lt;/down&gt;
        &lt;menu&gt;KEY_MENU&lt;/menu&gt;
		&lt;select&gt;KEY_OK&lt;/select&gt;
		&lt;back&gt;KEY_ESC&lt;/back&gt;
		&lt;left&gt;KEY_LEFT&lt;/left&gt;
		&lt;right&gt;KEY_RIGHT&lt;/right&gt;
		&lt;red&gt;KEY_RED&lt;/red&gt;
		&lt;green&gt;KEY_GREEN&lt;/green&gt;
		&lt;yellow&gt;KEY_YELLOW&lt;/yellow&gt;
		&lt;blue&gt;KEY_BLUE&lt;/blue&gt;
		&lt;zero&gt;KEY_0&lt;/zero&gt;
		&lt;one&gt;KEY_1&lt;/one&gt;
		&lt;two&gt;KEY_2&lt;/two&gt;
		&lt;three&gt;KEY_3&lt;/three&gt;
		&lt;four&gt;KEY_4&lt;/four&gt;
		&lt;five&gt;KEY_5&lt;/five&gt;
		&lt;six&gt;KEY_6&lt;/six&gt;
		&lt;seven&gt;KEY_7&lt;/seven&gt;
		&lt;eight&gt;KEY_8&lt;/eight&gt;
		&lt;nine&gt;KEY_9&lt;/nine&gt;
		&lt;info&gt;KEY_INFO&lt;/info&gt;
		&lt;play&gt;KEY_PLAY&lt;/play&gt;
		&lt;play&gt;KEY_PLAYPAUSE&lt;/play&gt;
		&lt;pause&gt;KEY_PAUSE&lt;/pause&gt;
		&lt;stop&gt;KEY_STOP&lt;/stop&gt;
		&lt;record&gt;KEY_RECORD&lt;/record&gt;
		&lt;forward&gt;KEY_FASTFORWARD&lt;/forward&gt;
		&lt;reverse&gt;KEY_REWIND&lt;/reverse&gt;
		&lt;skipplus&gt;KEY_NEXT&lt;/skipplus&gt;
		&lt;skipminus&gt;KEY_BACK&lt;/skipminus&gt;
		&lt;power&gt;KEY_POWER2&lt;/power&gt;
		&lt;channelplus&gt;KEY_CHANNELUP&lt;/channelplus&gt;
		&lt;channelminus&gt;KEY_CHANNELDOWN&lt;/channelminus&gt;
		&lt;title&gt;KEY_PROG3&lt;/title&gt;
		&lt;volumeplus&gt;KEY_VOLUMEUP&lt;/volumeplus&gt;
		&lt;volumeminus&gt;KEY_VOLUMEDOWN&lt;/volumeminus&gt;
        &lt;teletext&gt;KEY_TEXT&lt;/teletext&gt;
		&lt;mute&gt;KEY_MUTE&lt;/mute&gt;
		&lt;start&gt;KEY_SELECT&lt;/start&gt;
		&lt;subtitle&gt;KEY_SUBTITLE&lt;/subtitle&gt;
        &lt;audio&gt;KEY_MODE&lt;/audio&gt;
		&lt;mute&gt;KEY_MUTE&lt;/mute&gt;
		&lt;myvideo&gt;KEY_VIDEO&lt;/myvideo&gt;
		&lt;mymusic&gt;KEY_AUDIO&lt;/mymusic&gt;
		&lt;mypictures&gt;KEY_IMAGES&lt;/mypictures&gt;
		&lt;recordedtv&gt;KEY_PVR&lt;/recordedtv&gt;
        &lt;guide&gt;KEY_EPG&lt;/guide&gt;
		&lt;display&gt;KEY_SCREEN&lt;/display&gt;
		&lt;enter&gt;KEY_PROG4&lt;/enter&gt;
		&lt;playlist&gt;KEY_ZOOM&lt;/playlist&gt;
		&lt;livetv&gt;KEY_CHANNEL&lt;/livetv&gt;
		&lt;mytv&gt;KEY_TV&lt;/mytv&gt;
		&lt;liveradio&gt;KEY_FN&lt;/liveradio&gt;
	&lt;/remote&gt;
&lt;/lircmap&gt;
</pre>
</div>
</div>
</li>
<li><a id="org2c47942"></a>remote.xml<br />
<div class="outline-text-5" id="text-6-36-3-2">
<p>
This file maps the keys defined in Lircmap.xml to actions within kodi.
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- This file contains the mapping of remote keys to actions within Kodi.             

The format is:
 &lt;window&gt;
   &lt;device&gt;
     &lt;button&gt;action&lt;/button&gt;
   &lt;/device&gt;
 &lt;/window&gt;

The &lt;global&gt; section is a fall through - they will only be used if the button is
not used in the current window's section.

Actions can be built-in functions.
 eg &lt;B&gt;ActivateWindow(Music)&lt;/B&gt;
would automatically go to Music on the press of the B button.

An empty action removes the corresponding mapping from default and parent keymaps.
This is different from a "noop" action, which disables a button.

More documentation on keymaps can be found on http://kodi.wiki/view/keymaps --&gt;
&lt;keymap&gt;
  &lt;global&gt;
    &lt;universalremote&gt;
       &lt;obc150&gt;XBMC.ejecttray()&lt;/obc150&gt;
       &lt;obc151&gt;Playlist&lt;/obc151&gt;
    &lt;/universalremote&gt;
    &lt;remote&gt;
      &lt;play&gt;PlayPause&lt;/play&gt;
      &lt;pause&gt;Pause&lt;/pause&gt;
      &lt;stop&gt;Stop&lt;/stop&gt;
      &lt;forward&gt;FastForward&lt;/forward&gt;
      &lt;reverse&gt;Rewind&lt;/reverse&gt;
      &lt;left&gt;Left&lt;/left&gt;
      &lt;right&gt;Right&lt;/right&gt;
      &lt;up&gt;Up&lt;/up&gt;
      &lt;down&gt;Down&lt;/down&gt;
      &lt;select&gt;Select&lt;/select&gt;
      &lt;pageplus&gt;PageUp&lt;/pageplus&gt;
      &lt;pageminus&gt;PageDown&lt;/pageminus&gt;
      &lt;back&gt;ParentDir&lt;/back&gt;
      &lt;menu&gt;PreviousMenu&lt;/menu&gt;
      &lt;title&gt;ContextMenu&lt;/title&gt;
      &lt;info&gt;Info&lt;/info&gt;
      &lt;skipplus&gt;SkipNext&lt;/skipplus&gt;
      &lt;skipminus&gt;SkipPrevious&lt;/skipminus&gt;
      &lt;display&gt;FullScreen&lt;/display&gt;
      &lt;start&gt;PreviousMenu&lt;/start&gt;
      &lt;record&gt;Screenshot&lt;/record&gt;
      &lt;volumeplus&gt;VolumeUp&lt;/volumeplus&gt;
      &lt;volumeminus&gt;VolumeDown&lt;/volumeminus&gt;
      &lt;mute&gt;Mute&lt;/mute&gt;
      &lt;power&gt;XBMC.Quit()&lt;/power&gt;
      &lt;myvideo&gt;XBMC.ActivateWindow(MyVideos)&lt;/myvideo&gt;
      &lt;mymusic&gt;XBMC.ActivateWindow(MyMusic)&lt;/mymusic&gt;
      &lt;mypictures&gt;XBMC.ActivateWindow(MyPictures)&lt;/mypictures&gt;
      &lt;!--- &lt;mytv&gt;XBMC.ActivateWindow(Home)&lt;/mytv&gt; --&gt;
      &lt;recordedtv&gt;XBMC.ActivateWindowAndFocus(MyPVR, 34,0, 13,0)&lt;/recordedtv&gt;
      &lt;!-- PVR: EPG --&gt;
      &lt;guide&gt;XBMC.ActivateWindowAndFocus(MyPVR, 31,0, 10,0)&lt;/guide&gt;
      &lt;!-- PVR: Channellist --&gt;
      &lt;livetv&gt;XBMC.ActivateWindowAndFocus(MyPVR, 32,0, 11,0)&lt;/livetv&gt;
      &lt;!-- PVR: Radio --&gt;
      &lt;liveradio&gt;XBMC.ActivateWindowAndFocus(MyPVR, 33,0, 12,0)&lt;/liveradio&gt;
      &lt;red&gt;XBMC.ActivateWindow(Home)&lt;/red&gt;
      &lt;yellow&gt;XBMC.ActivateWindow(MyVideos)&lt;/yellow&gt;
      &lt;green&gt;XBMC.ActivateWindow(MyMusic)&lt;/green&gt;
      &lt;!-- &lt;blue&gt;XBMC.ActivateWindow(MyPictures)&lt;/blue&gt; --&gt;
      &lt;zero&gt;Number0&lt;/zero&gt;
      &lt;one&gt;Number1&lt;/one&gt;
      &lt;two&gt;JumpSMS2&lt;/two&gt;
      &lt;three&gt;JumpSMS3&lt;/three&gt;
      &lt;four&gt;JumpSMS4&lt;/four&gt;
      &lt;five&gt;JumpSMS5&lt;/five&gt;
      &lt;six&gt;JumpSMS6&lt;/six&gt;
      &lt;seven&gt;JumpSMS7&lt;/seven&gt;
      &lt;eight&gt;JumpSMS8&lt;/eight&gt;
      &lt;nine&gt;JumpSMS9&lt;/nine&gt;
      &lt;audio&gt;AudioNextLanguage&lt;/audio&gt;
      &lt;subtitle&gt;ShowSubtitles&lt;/subtitle&gt;
      &lt;enter&gt;FullScreen&lt;/enter&gt;
      &lt;blue&gt;ContextMenu&lt;/blue&gt;
      &lt;playlist&gt;XBMC.ActivateWindow(MyMusicPlaylist)&lt;/playlist&gt;
    &lt;/remote&gt;
  &lt;/global&gt;
  &lt;Home&gt;
    &lt;remote&gt;
      &lt;menu&gt;XBMC.Skin.ToggleSetting(HomeViewToggle)&lt;/menu&gt;
      &lt;info&gt;XBMC.ActivateWindow(SystemInfo)&lt;/info&gt;
      &lt;clear&gt;XBMC.ActivateWindow(Weather)&lt;/clear&gt;
      &lt;blue&gt;XBMC.ActivateWindow(Settings)&lt;/blue&gt;
      &lt;red&gt;FullScreen&lt;/red&gt;
      &lt;back&gt;FullScreen&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/Home&gt;
  &lt;MyFiles&gt;
    &lt;remote&gt;
      &lt;clear&gt;Delete&lt;/clear&gt;
    &lt;/remote&gt;
  &lt;/MyFiles&gt;
  &lt;MyMusicPlaylist&gt;
    &lt;remote&gt;
      &lt;back&gt;Playlist&lt;/back&gt;      &lt;!-- Close playlist --&gt;
      &lt;clear&gt;Delete&lt;/clear&gt;
    &lt;/remote&gt;
  &lt;/MyMusicPlaylist&gt;
  &lt;MyMusicPlaylistEditor&gt;
    &lt;remote&gt;
      &lt;zero&gt;Queue&lt;/zero&gt;
    &lt;/remote&gt;
  &lt;/MyMusicPlaylistEditor&gt;
  &lt;MyMusicFiles&gt;
    &lt;remote&gt;
      &lt;zero&gt;Queue&lt;/zero&gt;
      &lt;star&gt;Queue&lt;/star&gt;
      &lt;start&gt;ContextMenu&lt;/start&gt;
    &lt;/remote&gt;
  &lt;/MyMusicFiles&gt;
  &lt;MyMusicLibrary&gt;
    &lt;remote&gt;
      &lt;zero&gt;Queue&lt;/zero&gt;
      &lt;star&gt;Queue&lt;/star&gt;
    &lt;/remote&gt;
  &lt;/MyMusicLibrary&gt;
  &lt;FullscreenVideo&gt;
    &lt;remote&gt;
      &lt;back&gt;FullScreen&lt;/back&gt;
      &lt;zero&gt;Number0&lt;/zero&gt;
      &lt;one&gt;Number1&lt;/one&gt;
      &lt;two&gt;Number2&lt;/two&gt;
      &lt;three&gt;Number3&lt;/three&gt;
      &lt;four&gt;Number4&lt;/four&gt;
      &lt;five&gt;Number5&lt;/five&gt;
      &lt;six&gt;Number6&lt;/six&gt;
      &lt;seven&gt;Number7&lt;/seven&gt;
      &lt;eight&gt;Number8&lt;/eight&gt;
      &lt;nine&gt;Number9&lt;/nine&gt;
      &lt;left&gt;Rewind&lt;/left&gt;
      &lt;right&gt;FastForward&lt;/right&gt;
      &lt;up&gt;Play&lt;/up&gt;
      &lt;down&gt;Pause&lt;/down&gt;
      &lt;yellow&gt;StepForward&lt;/yellow&gt;
      &lt;green&gt;StepBack&lt;/green&gt;
      &lt;blue&gt;CodecInfo&lt;/blue&gt;
      &lt;menu&gt;OSD&lt;/menu&gt;
      &lt;start&gt;OSD&lt;/start&gt;
      &lt;info&gt;XBMC.ActivateWindow(PVROSDChannels)&lt;/info&gt;
      &lt;title&gt;XBMC.ActivateWindow(PVROSDChannels)&lt;/title&gt;
      &lt;display&gt;AspectRatio&lt;/display&gt;
      &lt;select&gt;Info&lt;/select&gt;
      &lt;teletext&gt;XBMC.ActivateWindow(Teletext)&lt;/teletext&gt;
      &lt;channelplus&gt;SkipNext&lt;/channelplus&gt;
      &lt;channelminus&gt;SkipPrevious&lt;/channelminus&gt;
      &lt;record&gt;XBMC.PlayerControl(Record)&lt;/record&gt;
    &lt;/remote&gt;
  &lt;/FullscreenVideo&gt;
  &lt;FullscreenInfo&gt;
    &lt;remote&gt;
      &lt;back&gt;FullScreen&lt;/back&gt;
      &lt;left&gt;Rewind&lt;/left&gt;
      &lt;right&gt;FastForward&lt;/right&gt;
      &lt;up&gt;Play&lt;/up&gt;
      &lt;down&gt;Pause&lt;/down&gt;
      &lt;yellow&gt;StepForward&lt;/yellow&gt;
      &lt;green&gt;StepBack&lt;/green&gt;
      &lt;display&gt;AspectRatio&lt;/display&gt;
      &lt;info&gt;CodecInfo&lt;/info&gt;
      &lt;select&gt;Close&lt;/select&gt;
      &lt;menu&gt;OSD&lt;/menu&gt;
    &lt;/remote&gt;
  &lt;/FullscreenInfo&gt;
  &lt;PlayerControls&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
    &lt;/remote&gt;
  &lt;/PlayerControls&gt;
  &lt;Visualisation&gt;
    &lt;universalremote&gt;
       &lt;obc151&gt;XBMC.ActivateWindow(MyMusicPlaylist)&lt;/obc151&gt;
    &lt;/universalremote&gt;
    &lt;remote&gt;
      &lt;red&gt;FullScreen&lt;/red&gt;
      &lt;yellow&gt;AnalogSeekForward&lt;/yellow&gt;
      &lt;green&gt;AnalogSeekBack&lt;/green&gt;
      &lt;blue&gt;CodecInfo&lt;/blue&gt;
      &lt;left&gt;Rewind&lt;/left&gt;
      &lt;right&gt;FastForward&lt;/right&gt;
      &lt;pageplus&gt;SkipNext&lt;/pageplus&gt;
      &lt;pageminus&gt;SkipPrevious&lt;/pageminus&gt;
      &lt;up&gt;Play&lt;/up&gt;
      &lt;down&gt;Pause&lt;/down&gt;
      &lt;info&gt;XBMC.ActivateWindow(PVROSDChannels)&lt;/info&gt;
      &lt;back&gt;XBMC.ActivateWindow(MyMusicPlaylist)&lt;/back&gt;
      &lt;select&gt;Info&lt;/select&gt;
      &lt;menu&gt;XBMC.ActivateWindow(MusicOSD)&lt;/menu&gt;
      &lt;start&gt;XBMC.ActivateWindow(MusicOSD)&lt;/start&gt;
    &lt;/remote&gt;
  &lt;/Visualisation&gt;
  &lt;MusicOSD&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;start&gt;Close&lt;/start&gt;
      &lt;info&gt;CodecInfo&lt;/info&gt;
    &lt;/remote&gt;
  &lt;/MusicOSD&gt;
  &lt;VisualisationSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
    &lt;/remote&gt;
  &lt;/VisualisationSettings&gt;
  &lt;VisualisationPresetList&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
    &lt;/remote&gt;
  &lt;/VisualisationPresetList&gt;
  &lt;SlideShow&gt;
    &lt;remote&gt;
      &lt;zero&gt;ZoomNormal&lt;/zero&gt;
      &lt;one&gt;ZoomLevel1&lt;/one&gt;
      &lt;two&gt;ZoomLevel2&lt;/two&gt;
      &lt;three&gt;ZoomLevel3&lt;/three&gt;
      &lt;four&gt;ZoomLevel4&lt;/four&gt;
      &lt;five&gt;ZoomLevel5&lt;/five&gt;
      &lt;six&gt;ZoomLevel6&lt;/six&gt;
      &lt;seven&gt;ZoomLevel7&lt;/seven&gt;
      &lt;eight&gt;ZoomLevel8&lt;/eight&gt;
      &lt;nine&gt;ZoomLevel9&lt;/nine&gt;
      &lt;info&gt;CodecInfo&lt;/info&gt;
      &lt;pageplus&gt;ZoomIn&lt;/pageplus&gt;
      &lt;pageminus&gt;ZoomOut&lt;/pageminus&gt;
      &lt;select&gt;Rotate&lt;/select&gt;
      &lt;up&gt;Pause&lt;/up&gt;
      &lt;down&gt;Play&lt;/down&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/SlideShow&gt;
  &lt;ScreenCalibration&gt;
    &lt;remote&gt;
      &lt;select&gt;NextCalibration&lt;/select&gt;
      &lt;enter&gt;NextCalibration&lt;/enter&gt;
      &lt;zero&gt;ResetCalibration&lt;/zero&gt;
      &lt;display&gt;NextResolution&lt;/display&gt;
      &lt;xbox&gt;NextResolution&lt;/xbox&gt;
    &lt;/remote&gt;
  &lt;/ScreenCalibration&gt;
  &lt;GUICalibration&gt;
    &lt;remote&gt;
      &lt;select&gt;NextCalibration&lt;/select&gt;
      &lt;enter&gt;NextCalibration&lt;/enter&gt;
      &lt;zero&gt;ResetCalibration&lt;/zero&gt;
    &lt;/remote&gt;
  &lt;/GUICalibration&gt;
  &lt;SelectDialog&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/SelectDialog&gt;
  &lt;VideoOSD&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;start&gt;Close&lt;/start&gt;
    &lt;/remote&gt;
  &lt;/VideoOSD&gt;
  &lt;VideoMenu&gt;
    &lt;remote&gt;
      &lt;menu&gt;OSD&lt;/menu&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
      &lt;info&gt;Info&lt;/info&gt;
      &lt;title&gt;CodecInfo&lt;/title&gt;
      &lt;zero&gt;Number0&lt;/zero&gt;
      &lt;one&gt;Number1&lt;/one&gt;
      &lt;two&gt;Number2&lt;/two&gt;
      &lt;three&gt;Number3&lt;/three&gt;
      &lt;four&gt;Number4&lt;/four&gt;
      &lt;five&gt;Number5&lt;/five&gt;
      &lt;six&gt;Number6&lt;/six&gt;
      &lt;seven&gt;Number7&lt;/seven&gt;
      &lt;eight&gt;Number8&lt;/eight&gt;
      &lt;nine&gt;Number9&lt;/nine&gt;
    &lt;/remote&gt;
  &lt;/VideoMenu&gt;
  &lt;OSDVideoSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;start&gt;Close&lt;/start&gt;
    &lt;/remote&gt;
  &lt;/OSDVideoSettings&gt;
  &lt;OSDAudioSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;start&gt;Close&lt;/start&gt;
    &lt;/remote&gt;
  &lt;/OSDAudioSettings&gt;
  &lt;VideoBookmarks&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;start&gt;Close&lt;/start&gt;
      &lt;zero&gt;Delete&lt;/zero&gt;
    &lt;/remote&gt;
  &lt;/VideoBookmarks&gt;
  &lt;MyVideoLibrary&gt;
    &lt;remote&gt;
      &lt;zero&gt;Queue&lt;/zero&gt;
      &lt;clear&gt;Delete&lt;/clear&gt;
      &lt;green&gt;ToggleWatched&lt;/green&gt;
      &lt;yellow&gt;Queue&lt;/yellow&gt;
    &lt;/remote&gt;
  &lt;/MyVideoLibrary&gt;
  &lt;MyVideoFiles&gt;
    &lt;remote&gt;
      &lt;zero&gt;Queue&lt;/zero&gt;
      &lt;star&gt;Queue&lt;/star&gt;
      &lt;blue&gt;ContextMenu&lt;/blue&gt;
      &lt;green&gt;ToggleWatched&lt;/green&gt;
      &lt;yellow&gt;Queue&lt;/yellow&gt;
    &lt;/remote&gt;
  &lt;/MyVideoFiles&gt;
  &lt;MyPictures&gt;
    &lt;remote&gt;
      &lt;zero&gt;Queue&lt;/zero&gt;
      &lt;star&gt;Queue&lt;/star&gt;
      &lt;start&gt;ContextMenu&lt;/start&gt;
    &lt;/remote&gt;
  &lt;/MyPictures&gt;
  &lt;MyVideoPlaylist&gt;
    &lt;remote&gt;
      &lt;back&gt;Playlist&lt;/back&gt;      &lt;!-- Close playlist --&gt;
      &lt;clear&gt;Delete&lt;/clear&gt;
      &lt;zero&gt;Delete&lt;/zero&gt;
    &lt;/remote&gt;
  &lt;/MyVideoPlaylist&gt;
  &lt;VirtualKeyboard&gt;
    &lt;remote&gt;
      &lt;back&gt;BackSpace&lt;/back&gt;
      &lt;star&gt;Shift&lt;/star&gt;
      &lt;hash&gt;Symbols&lt;/hash&gt;
      &lt;zero&gt;Number0&lt;/zero&gt;
      &lt;one&gt;Number1&lt;/one&gt;
      &lt;two&gt;Number2&lt;/two&gt;
      &lt;three&gt;Number3&lt;/three&gt;
      &lt;four&gt;Number4&lt;/four&gt;
      &lt;five&gt;Number5&lt;/five&gt;
      &lt;six&gt;Number6&lt;/six&gt;
      &lt;seven&gt;Number7&lt;/seven&gt;
      &lt;eight&gt;Number8&lt;/eight&gt;
      &lt;nine&gt;Number9&lt;/nine&gt;
      &lt;pageminus&gt;CursorLeft&lt;/pageminus&gt;
      &lt;pageplus&gt;CursorRight&lt;/pageplus&gt;
    &lt;/remote&gt;
  &lt;/VirtualKeyboard&gt;
  &lt;ContextMenu&gt;
    &lt;remote&gt;
      &lt;blue&gt;Close&lt;/blue&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/ContextMenu&gt;
  &lt;FileStackingDialog&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/FileStackingDialog&gt;
  &lt;Scripts&gt;
    &lt;remote&gt;
      &lt;info&gt;XBMC.ActivateWindow(ScriptsDebugInfo)&lt;/info&gt;
    &lt;/remote&gt;
  &lt;/Scripts&gt;
  &lt;ScriptsDebugInfo&gt;
    &lt;remote&gt;
      &lt;info&gt;Info&lt;/info&gt;      &lt;!-- clears debug python info --&gt;
    &lt;/remote&gt;
  &lt;/ScriptsDebugInfo&gt;
  &lt;NumericInput&gt;
    &lt;remote&gt;
      &lt;zero&gt;Number0&lt;/zero&gt;
      &lt;one&gt;Number1&lt;/one&gt;
      &lt;two&gt;Number2&lt;/two&gt;
      &lt;three&gt;Number3&lt;/three&gt;
      &lt;four&gt;Number4&lt;/four&gt;
      &lt;five&gt;Number5&lt;/five&gt;
      &lt;six&gt;Number6&lt;/six&gt;
      &lt;seven&gt;Number7&lt;/seven&gt;
      &lt;eight&gt;Number8&lt;/eight&gt;
      &lt;nine&gt;Number9&lt;/nine&gt;
      &lt;back&gt;BackSpace&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/NumericInput&gt;
  &lt;Weather&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/Weather&gt;
  &lt;Settings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/Settings&gt;
  &lt;MyPicturesSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MyPicturesSettings&gt;
  &lt;MyProgramsSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MyProgramsSettings&gt;
  &lt;MyWeatherSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MyWeatherSettings&gt;
  &lt;MyMusicSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MyMusicSettings&gt;
  &lt;SystemSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/SystemSettings&gt;
  &lt;MyVideosSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MyVideosSettings&gt;
  &lt;NetworkSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/NetworkSettings&gt;
  &lt;AppearanceSettings&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/AppearanceSettings&gt;
  &lt;Profiles&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/Profiles&gt;
  &lt;systeminfo&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/systeminfo&gt;
  &lt;shutdownmenu&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/shutdownmenu&gt;
  &lt;submenu&gt;
    &lt;remote&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/submenu&gt;
  &lt;MusicInformation&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MusicInformation&gt;
  &lt;MovieInformation&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/MovieInformation&gt;
  &lt;LockSettings&gt;
    &lt;remote&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/LockSettings&gt;
  &lt;ProfileSettings&gt;
    &lt;remote&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;back&gt;PreviousMenu&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/ProfileSettings&gt;
  &lt;PictureInfo&gt;
    &lt;remote&gt;
      &lt;skipplus&gt;NextPicture&lt;/skipplus&gt;
      &lt;skipminus&gt;PreviousPicture&lt;/skipminus&gt;
      &lt;info&gt;Close&lt;/info&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/PictureInfo&gt;
  &lt;Teletext&gt;
    &lt;remote&gt;
      &lt;zero&gt;number0&lt;/zero&gt;
      &lt;one&gt;number1&lt;/one&gt;
      &lt;two&gt;number2&lt;/two&gt;
      &lt;three&gt;number3&lt;/three&gt;
      &lt;four&gt;number4&lt;/four&gt;
      &lt;five&gt;number5&lt;/five&gt;
      &lt;six&gt;number6&lt;/six&gt;
      &lt;seven&gt;number7&lt;/seven&gt;
      &lt;eight&gt;number8&lt;/eight&gt;
      &lt;nine&gt;number9&lt;/nine&gt;
      &lt;red&gt;Red&lt;/red&gt;
      &lt;green&gt;Green&lt;/green&gt;
      &lt;yellow&gt;Yellow&lt;/yellow&gt;
      &lt;blue&gt;Blue&lt;/blue&gt;
      &lt;info&gt;Info&lt;/info&gt;
      &lt;back&gt;Close&lt;/back&gt;
      &lt;menu&gt;Close&lt;/menu&gt;
      &lt;start&gt;Close&lt;/start&gt;
      &lt;teletext&gt;Close&lt;/teletext&gt;
    &lt;/remote&gt;
  &lt;/Teletext&gt;
  &lt;Favourites&gt;
    &lt;remote&gt;
      &lt;back&gt;Close&lt;/back&gt;
    &lt;/remote&gt;
  &lt;/Favourites&gt;
&lt;/keymap&gt;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org805cbf9" class="outline-3">
<h3 id="org805cbf9"><span class="section-number-3">6.37</span> dvd</h3>
<div class="outline-text-3" id="text-6-37">
</div>
<div id="outline-container-org9ad69d2" class="outline-4">
<h4 id="org9ad69d2"><span class="section-number-4">6.37.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-37-1">
</div>
<ul class="org-ul">
<li><a id="org8f305d4"></a>install libdvd-pkg, allow programs to eject optical media<br />
<div class="outline-text-5" id="text-org8f305d4">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/dvd/tasks/main.yml

#- name: preconfigure libdvd-pkg
#  shell: |
#    echo 'libdvd-pkg libdvd-pkg/post-invoke_hook-install boolean true' | debconf-set-selections
#    echo 'libdvd-pkg libdvd-pkg/build boolean true' | debconf-set-selections

- name: apt | install libdvd-pkg
  apt:
    name: libdvd-pkg
    state: present
    install_recommends: no

- name: reconfigure libdvd-pkg
  dpkg_reconfigure:
    pkg: libdvd-pkg
    answers: |
     libdvd-pkg/post-invoke_hook-install: boolean true
     libdvd-pkg/build: boolean true

- name: change udev rule to allow KODI to eject optical disks
  shell: sed 's/--lock-media //' /lib/udev/rules.d/60-cdrom_id.rules &gt; /etc/udev/rules.d/60-cdrom_id.rules
  args:
    creates: /etc/udev/rules.d/60-cdrom_id.rules
    warn: false
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgca5094e" class="outline-3">
<h3 id="orgca5094e"><span class="section-number-3">6.38</span> vdr-epg-daemon</h3>
<div class="outline-text-3" id="text-6-38">
<p>
This role installs the vdr-epg-daemon
</p>
</div>
<div id="outline-container-org56466b3" class="outline-4">
<h4 id="org56466b3"><span class="section-number-4">6.38.1</span> defaults</h4>
<div class="outline-text-4" id="text-6-38-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/epgd/defaults/main.yml

epgd_dbhost: localhost
epgd_dbport: 3306
epgd_dbname: epg2vdr
epgd_dbuser: epg2vdr
epgd_dbpass: epg
epgd_epgview: eventsview.sql
epgd_epgviewweb: eventsviewplain.sql
epgd_thetvdbview: thetvdbview.sql
epgd_checkinitial: 1
epgd_daysinadvance: 8
epgd_daystoupdate: 4
epgd_updatetime: 12
epgd_updatethreshold: 500
epgd_xmlstoretofs: 0
epgd_getepgimages: 1
# EpgImageSize
# 0 = 174x130
# 1 = 329x245
# 2 = 525x400
epgd_epgimagesize: 2
epgd_maximagesperevent: 1
epgd_seriesenabled: 1
epgd_seriesport: 2006
epgd_seriesstoretofs: 0
epgd_seriesurl: www.eplists.de
epgd_scrapepg: 1
epgd_scrapRecordings: 1
#epgd_scrapmoviedbapikey: ""
epgd_cachepath: /var/cache/epgd/
epgd_epghttpd_port: 9999
#epgd_httpproxy: 127.0.0.1:8000
epgd_httpproxy_username: ""
epgd_httpproxy_password: ""
epgd_LogLevel: 1
epgd_epgdata_url: http://www.epgdata.com
epgd_epgdata_pin: insert-your-pin-here
epgd_epgdata_timeout: 180
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd42374" class="outline-4">
<h4 id="orgcd42374"><span class="section-number-4">6.38.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-38-2">
<div class="org-src-container">
<pre class="src src-yml">---
# file: roles/epgd/tasks/main.yml

#Installing mariadb, epg-daemon and epg2vdr.
#bind-address is set to 0.0.0.0 --&gt; 99-epgd.cnf.
#The root SQL password is only stored (NONE), because the epgd-tool
#is expecting it. But it is not really used,
#because the connection is established via a socket without a password.
#Normal users must use sudo if they want to access mysql as root.
#TODO:
    # - Create channelmap if channels.conf is present.
    #   (the script already exists at mld.)
    # - because skindesigner-logos delivers only svg-logos, logoSuffix svg should be the preset --&gt; vdr-epg-daemon / lib / parameters.c
    # - customize epgd-tool for mariadb


- name: MariaDB and Plugin | install
  apt:
    name: ['mariadb-server', 'mariadb-plugin-epglv', 'python3-pymysql']
    state: present
    
- name: copy file | epgd mariadb config
  template:
    src: templates/etc_mysql_mariadb.conf.d_99-epgd.cnf.j2
    dest: /etc/mysql/mariadb.conf.d/99-epgd.cnf
    owner: root
    group: root

- name: create /root/.ssh if it doesn't exist yes
  file:
    path: /root/.ssh
    state: directory
    owner: root
    group: root
    mode: 0700
    
- name: copy file | mysqlpasswd
  template:
    src: templates/root_.ssh_mysqlpasswd.j2
    dest: /root/.ssh/mysqlpasswd
    owner: root
    group: root
    mode: 0600
    backup: yes

- name: Restart mariadb
  systemd:
    name: mariadb.service
    state: restarted
    enabled: yes
    masked: no
    
- name: Create a new database for epgd
  mysql_db:
    name: "{{ epgd_dbname }}"
    encoding: utf8
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock
    
- name: Create User for epgd database  
  mysql_user:
    name: "{{ epgd_dbuser }}"
    password: "{{ epgd_dbpass }}"
    host: '%'
    priv: '{{ epgd_dbname }}.*:ALL'
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

- name: Create User for epgd database  
  mysql_user:
    name: "{{ epgd_dbuser }}"
    password: "{{ epgd_dbpass }}"
    host: 'localhost'
    priv: '{{ epgd_dbname }}.*:ALL'
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

- name: create epgd config folder
  file:
   path: /etc/epgd
   state: directory

- name: epgd config
  template:
    src: templates/etc_epgd_epgd.conf.j2
    dest: /etc/epgd/epgd.conf

- name: epgd | install
  apt:
    name: ['vdr-epg-daemon', 'vdr-plugin-epg2vdr', 'skindesigner-logos']
    state: present

#- name: epgd | start
#  systemd:
#    name: epgd_service
#    state: started
#    enabled: yes
#    masked: no
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaddf32f" class="outline-4">
<h4 id="orgaddf32f"><span class="section-number-4">6.38.3</span> templates</h4>
<div class="outline-text-4" id="text-6-38-3">
</div>
<ol class="org-ol">
<li><a id="org2be4fc1"></a>Template for /etc/mysql/mariadb.conf.d/99-epgd.cnf<br />
<div class="outline-text-5" id="text-6-38-3-1">
<p>
to allow Database access from all hosts on network
<code>file: roles/epgd/templates/etc_mysql_mariadb.conf.d_99-epgd.cnf.j2</code>
</p>
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
[mysqld]
bind-address            = 0.0.0.0
</pre>
</div>
</div>
</li>
<li><a id="orga081f7f"></a>template for <code>/root/.ssh/mysqlpasswd</code> so epgd-tool is happy<br />
<div class="outline-text-5" id="text-6-38-3-2">
<p>
<code>file: roles/epgd/templates/root_.ssh_mysqlpasswd.j2</code>
</p>
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
PASSWORD=NONE 
</pre>
</div>
</div>
</li>
<li><a id="org20a5218"></a>template for /etc/epgd/epgd.conf<br />
<div class="outline-text-5" id="text-6-38-3-3">
<p>
<code>file: roles/epgd/templates/etc_epgd_epgd.conf.j2</code>
</p>
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
# ------------------------------------
# Configuration of EPG Daemon
# ------------------------------------

DbHost = {{ epgd_dbhost }}
DbPort = {{ epgd_dbport }}
DbName = {{ epgd_dbname }}
DbUser = {{ epgd_dbuser }}
DbPass = {{ epgd_dbpass }}

EpgView = {{ epgd_epgview }}
EpgViewWeb = {{ epgd_epgviewweb }}
TheTvDBView = {{ epgd_thetvdbview }}

CheckInitial = {{ epgd_checkinitial }}
DaysInAdvance = {{ epgd_daysinadvance }}
DaysToUpdate = {{ epgd_daystoupdate }}
UpdateTime = {{ epgd_updatetime }}
UpdateThreshold = {{ epgd_updatethreshold }}

XmlStoreToFs = {{ epgd_xmlstoretofs }}

GetEPGImages = {{ epgd_getepgimages }}
# EpgImageSize
# 0 = 174x130
# 1 = 329x245
# 2 = 525x400
EpgImageSize = {{ epgd_epgimagesize }}
MaxImagesPerEvent = {{ epgd_maximagesperevent }}

SeriesEnabled = {{ epgd_seriesenabled }}
SeriesPort = {{ epgd_seriesport }}
SeriesStoreToFs = {{ epgd_seriesstoretofs }}
SeriesUrl = {{ epgd_seriesurl }}

ScrapEpg = {{ epgd_scrapepg }}
ScrapRecordings = {{ epgd_scrapRecordings }}
{% if epgd_scrapmoviedbapikey is defined %}
ScapMovieDbApiKey = {{ epgd_scrapmoviedbapikey }}
{% else %}
#ScrapMovieDbApiKey =
{% endif %}

{% if epgd_netdevice is defined %}
NetDevice = {{ epgd_netdevice }}
{% else %}
# NetDevice = eth0
{% endif %}

CachePath = {{ epgd_cachepath }}
HttpPort = {{ epgd_epghttpd_port }}

{% if epgd_httpproxy is defined %}
HttpProxy = {{ epgd_httpproxy }}
UserName = {{ epgd_httpproxy_username }}
Password = {{ epgd_httpproxy_password }}
{% else %}
# HttpProxy = 127.0.0.1:8000
# UserName =
# Password =
{% endif %}

LogLevel = {{ epgd_LogLevel }}

# ---------------
# epgdata plugin
# ---------------

epgdata.url = {{ epgd_epgdata_url }}
epgdata.pin = {{ epgd_epgdata_pin }} 

# Download timeout in seconds (default 180)
epgdata.timeout = {{ epgd_epgdata_timeout }}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org83f5a84" class="outline-3">
<h3 id="org83f5a84"><span class="section-number-3">6.39</span> install-sundtek</h3>
<div class="outline-text-3" id="text-6-39">
<p>
This role checks for USB IDs <code>2659:*</code> and <code>ab1a:5*</code>. If you want to force installation of sundtek packages (e.g. for accessing network tuners), set <code>sundtek.force_install</code> to <code>True</code>.
</p>

<p>
There are two ways to configure the VDR to use sundtek devices:
</p>
<ul class="org-ul">
<li>delay starting the VDR until the sundtek <code>mediasrv</code> has initialized all local devices -&gt; set <code>sundtek.wait_for_devices</code> to <code>True</code> (default)</li>
<li>use the vdr plugins <code>vdr-plugin-dynamite</code> and <code>vdr-plugin-sundtek</code> to allow the VDR to add (and remove) those tuners at runtime -&gt; set <code>sundtek.wait_for_devices</code> to <code>False</code></li>
</ul>

<p>
If you need to statically mount network tuners via <code>/etc/sundtek.conf</code>, set <code>sundtek.wait_for_network</code> to <code>True</code>. Please note that in this case the server has to be always avaible while the client is running.
</p>

<p>
Each program accessing sundtek tuners over device nodes in <code>/dev/dvb</code> needs to be started with the environment variable <code>LD_PRELOAD=/opt/lib/libmediaclient.so</code>. E.g. when using <code>w_scan</code>:
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo LD_PRELOAD=/opt/lib/libmediaclient.so w_scan -f c -c de &gt; new_channels.conf
</pre>
</div>
</div>

<div id="outline-container-orgccd5890" class="outline-4">
<h4 id="orgccd5890"><span class="section-number-4">6.39.1</span> dependencies</h4>
<div class="outline-text-4" id="text-6-39-1">
<div class="org-src-container">
<pre class="src src-yaml">---
dependencies:
  - { role: collect-facts }

</pre>
</div>
</div>
</div>
<div id="outline-container-org79c6233" class="outline-4">
<h4 id="org79c6233"><span class="section-number-4">6.39.2</span> defaults</h4>
<div class="outline-text-4" id="text-6-39-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file: roles/install-sundtek/defaults/main.yml

sundtek:
  force_install: false
  wait_for_devices: true
  wait_for_network: false
</pre>
</div>
</div>
</div>

<div id="outline-container-org20cfd69" class="outline-4">
<h4 id="org20cfd69"><span class="section-number-4">6.39.3</span> tasks</h4>
<div class="outline-text-4" id="text-6-39-3">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/install-sundtek/tasks/main.yml

- name: check for connected sundtek devices
  set_fact:
    install_sundtek: "{{ (usb | select('match', '2659:') | list | length | bool) or (usb | select('match', 'eb1a:5') | list | length | bool) or (sundtek.force_install | bool) }}"

- name: Preconfigure sundtek drivers
  block:
    - name: override udev rule installed by dvb-driver-sundtek
      template:
        src: templates/udev/80-mediasrv-sundtek.rules.j2
        dest: /etc/udev/rules.d/80-mediasrv-sundtek.rules

    - name: expand template for custom sundtek.service
      template:
        src: templates/systemd/sundtek.service.j2
        dest: /etc/systemd/system/sundtek.service

    - name: set LD_PRELOAD for sundtek driver to VDR's environment
      template:
        src: templates/systemd/vdr.service.d/sundtek.conf.j2
        dest: /etc/systemd/system/vdr.service.d/sundtek_LD_PRELOAD.conf
      notify: ['Restart VDR']

  when: install_sundtek | bool

- name: apt | install sundtek dvb driver
  apt:
    name: dvb-driver-sundtek
    state: '{{ "present" if install_sundtek | bool else "absent" }}'

- name: apt | install vdr-plugins for dynamic sundtek configuration else uninstall
  apt:
    name:
    - vdr-plugin-dynamite
    - vdr-plugin-sundtek
    state: '{{ "absent" if sundtek.wait_for_devices or not install_sundtek else "present" }}'

- name: install and run sundtek.service
  block:
    - name: check if sundtek.service is running
      systemd:
        name: sundtek.service
        state: started
      check_mode: yes
      register: sundtek_service_state

    - name: get mediasrv pids
      command: pgrep mediasrv
      register: mediasrv_pids

    - name: systemd | start sundtek.service
      systemd:
        name: sundtek.service
        state: '{{ "started" if (mediasrv_pids.stdout_lines and not sundtek_service_state.changed) or not mediasrv_pids.stdout_lines else "stopped" }}'
        enabled: yes
        masked: no
        daemon-reload: yes
  when: install_sundtek | bool

# TODO: Scan for local and remote sundtek sticks and create
#       /etc/sundtek.conf - needs yavdr-hardware-sundtek
#- name: detect local and remote sundtek devices
#  command: scansundtek
#  register: sundtek_scan
#
# - name: set variable sundtek_scan
#   set_fact:
#     sundtek_devices: "{{ sundtek_scan.stdout | from_json }}"
#
#- name: create /etc/sundtek.conf
#  template:
#    src: templates/sundtek.conf.j2
#    dest: /etc/sundtek.conf
#  notify: Restart sundtek.service

# TODO: install yavdr-hardware-sundtek
#- name: apt | install yavdr-hardware-sundtek
#  apt:
#    name: yavdr-hardware-sundtek

# TODO: enable sundtek-avahi-mounter (needs to be ported to python3 and
#       work indenpendently of yavdrhw.db files)
#- name: systemd | start sundtek-avahi-mounter.service
#  systemd:
#    name: sundtek-avahi-mounter.service
#    state: started
#    masked: no
#    enabled: yes
#    daemon-reload: yes
</pre>
</div>
</div>
</div>
<div id="outline-container-orge2a68e0" class="outline-4">
<h4 id="orge2a68e0"><span class="section-number-4">6.39.4</span> templates</h4>
<div class="outline-text-4" id="text-6-39-4">
</div>
<ol class="org-ol">
<li><a id="org2dcc37c"></a>udev rule to force sundtek mediaclient to start the mediasrv using systemd<br />
<div class="outline-text-5" id="text-6-39-4-1">
<div class="org-src-container">
<pre class="src src-systemd">{{ ansible_managed | comment }}

{% if install_sundtek %}
#SUBSYSTEM=="usb", ACTION=="add", RUN+="/opt/bin/mediaclient --start=5 --systemdcheck"
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="org3cdfb18"></a>LD_PRELOAD for vdr.service<br />
<div class="outline-text-5" id="text-6-39-4-2">
<div class="org-src-container">
<pre class="src src-systemd">{{ ansible_managed | comment }}

{% if install_sundtek %}
[Service]
Environment=LD_PRELOAD=/opt/lib/libmediaclient.so
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="org11d1399"></a>/etc/systemd/system/sundtek.service<br />
<div class="outline-text-5" id="text-6-39-4-3">
<div class="org-src-container">
<pre class="src src-systemd">{{ ansible_managed | comment }}

[Unit]
Description=Sundtek mediasrv
{% if sundtek.wait_for_network %}
After=network-online.target
{% endif %}

Before=vdr.service
[Service]
Type=forking
ExecStart=/opt/bin/mediasrv -d --pluginpath=/opt/bin {% if sundtek.wait_for_devices %}--wait-for-devices{% endif%}

ExecStop=/opt/bin/mediaclient --shutdown
Restart=on-failure
[Install]
WantedBy=multi-user.target
</pre>
</div>
</div>
</li>
<li><a id="org3276790"></a>/etc/sundtek.conf<br />
<div class="outline-text-5" id="text-6-39-4-4">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}
# ----- GLOBAL SECTION -----
#Set loglevel for logging to /var/log/mediasrv.log
#autoupdate=[on|off]                    #enable automatic driver update, default off
autoupdate=off
#loglevel=[off|min|full]            #default: off
                    #max .. little bit more
loglevel=off
#pluginpath=/path/to/drivers            #set path to drivers
#dvb_api_version=x.y                    #default API version will be parsed from
                                        #/usr/include/linux/dvb/version.h, if no such file is
                                        #available the latest internally supported API ::version will be
                                        #used (which will be quite new)
#audio_skip_bytes=N                     #when changing analogTV channels,
                                        #skip N bytes to suppress audio noise
#bulk_notification[on|off]              #default off, bulk_notification will only trigger device_attach once
                                        #after the the first device scan when the driver is started up
                                        #after this first scan, the notification will be triggered
                                        #normally again for each device.
                                        #
                                        #for example when 2 devices are attached to the system only one
                                        #notification will be triggered initially, any at a later time
                                        #attached device will generate another device_attach notification
                                        #by default each device will call the script which is set up with
                                        #device_attach
#use_tvvideo=[on|off]                   #use /dev/tvvideoN instead of /dev/video
                                        #this works around a new Adobe Flash bug in 2012, where flash crashes
                                        #if files (/dev/videoN) other than /dev/video0 are available

#use_hwpidfilter=[on|off]               #For DVB-C, DVB-T, DVB-S/S2
                                        #enable PID filter, please be careful with that, there are only 15 HW Pid filters available
                                        #when more than 15 pids are set up the pid filter will be disabled automatically

#dmhwpidfilter=[on|off]                 #default on, in some cases off might be useful to disable hw pid filter for settopboxes
                                        #if you get a black image when capturing a TV channel and watching another channel on the
                                        #same transponder - try this option and reboot

#usb_transaction_delay=[0-20]           #throttle the USB setup transactions, this can solve problems with weak USB stacks for
                                        #example for embedded boards, unit is milliseconds

#usb_timeout=[0 - N]                    #USB timeout for each transaction in milliseconds, 0 default infinite
#voltage_tone_off=[1 or 0]              #0 .. default, normal behaviour
                                        #1 .. force DVB-S/S2 to not use any Voltage or Tone (ignore any user parameters)

#ir_disabled=[1 or 0]                   #0 .. enable remote control polling, the driver will permanently check for remote control keys
                                        #1 .. disable remote control polling, might fix bugs with weak USB stacks on embedded boards

#
#Enable listening on network
#enablenetwork=[on|off]			#default: off

#Lowest adapter number to start with, e.g. /dev/dvb/adapter5/frontend0
#first_adapter=5

#Call attach script when new device appears
#device_attach=[PATH_TO_SCRIPT] [PARAMETER|DEVID]	#"DEVID" will automatically be replaced with the device ID
device_attach=/usr/bin/sundtek_attach

#Call detach script when device disappears
#device_detach=[PATH_TO_SCRIPT] [PARAMETER|DEVID]	#"DEVID" will automatically be replaced with the device ID
device_detach=/usr/bin/sundtek_detach


{% if sundtek_devices is definded %}
{% for device in sundtek_devices.local %}
{% if device.serial is defined %}
[{{ device.serial }}]

#Infrared protocol to use
#ir_protocol=[RC5|NEC|RC6]			#default: NEC
{% if device.ir_protocol|default("") %}
ir_protocol={{ device.ir_protocol }}
{% endif %}

#Keymap to use, e.g. "/lib/udev/rc_keymaps/vp702x"
#rcmap=[PATH_TO_KEYMAP]			#default: keymap which comes with the device
{% if device.rcmap|default("") %}
rcmap={{ device.rcmap }}
{% endif %}

#Choose initial DVB mode for hybrid DVB-T/DVB-C devices only
#initial_dvb_mode=[DVBC|DVBT]
{% if device.initial_dvb_mode|default("") %}
initial_dvb_mode={{ device.dvb_mode }}
{% endif %}

#Call attach script when new device appears
#device_attach=[PATH_TO_SCRIPT] [PARAMETER|DEVID]	#"DEVID" will automatically be replaced with the device ID
device_attach=/usr/bin/sundtek_attach

#Call detach script when device disappears
#device_detach=[PATH_TO_SCRIPT] [PARAMETER|DEVID]	#"DEVID" will automatically be replaced with the device ID
device_detach=/usr/bin/sundtek_detach

{% if device.capabilites.analog_tv %}
disable_analogtv=1                                      #disable initialization of analogTV Frontend
{% endif %}

{% endif %}
{% endfor %}
{% endif %}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org4b5eb4a" class="outline-3">
<h3 id="org4b5eb4a"><span class="section-number-3">6.40</span> channelpedia upload</h3>
<div class="outline-text-3" id="text-6-40">
<p>
This role requires three variables to be set (otherwise it won&rsquo;t do anything):
</p>
<dl class="org-dl">
<dt>channelpedia_url</dt><dd>the url the data will be uploaded to</dd>
<dt>channelpedia_username</dt><dd>the username required for authentication</dd>
<dt>channelpedia_password</dt><dd>the password required for authentication</dd>
</dl>

<p>
If you are a channelpedia contributor, you should already know the required url (as of 07/2019 https is supported) and authentication data.
</p>
</div>

<div id="outline-container-org7147f15" class="outline-4">
<h4 id="org7147f15"><span class="section-number-4">6.40.1</span> tasks</h4>
<div class="outline-text-4" id="text-6-40-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/channelpedia/tasks/main.yml

- name: upload channels.conf to channelpedia once a day
  block:
    - name: ensure curl is installed
      apt:
        name: curl
        state: present

    - name: expand template for channelpedia.service
      template:
        src: templates/channelpedia.service.j2
        dest: /etc/systemd/system/channelpedia.service

    - name: expand template for channelpedia.timer
      template:
        src: templates/channelpedia.timer.j2
        dest: /etc/systemd/system/channelpedia.timer

    - name: create credentials file
      template:
        src: templates/channelpedia_credentials.j2
        dest: /root/.channelpedia_credentials
        mode: 0700

    - name: start channelpedia timer and service
      systemd:
        name: '{{ item }}'
        state: started
        enabled: yes
        masked: no
      loop:
        - channelpedia.service
        - channelpedia.timer

  when:
    - channelpedia_url is defined
    - channelpedia_username is defined
    - channelpedia_password is defined
</pre>
</div>
</div>
</div>
<div id="outline-container-org33bfbae" class="outline-4">
<h4 id="org33bfbae"><span class="section-number-4">6.40.2</span> templates</h4>
<div class="outline-text-4" id="text-6-40-2">
</div>
<ol class="org-ol">
<li><a id="org1f0a521"></a>channelpedia.service<br />
<div class="outline-text-5" id="text-6-40-2-1">
<div class="org-src-container">
<pre class="src src-jinja2">[Unit]
Description=Upload channels.conf to channelpedia.yavdr.com
After=network-online.target
Requires=network-online.target

[Service]
EnvironmentFile=/root/.channelpedia_credentials
Type=oneshot
DynamicUser=true
ExecStart=/usr/bin/curl  -F "channels=@/var/lib/vdr/channels.conf;type=text/plain" -F "user=${user}" -F "password=${password}" "${url}"
</pre>
</div>
</div>
</li>
<li><a id="orgb5c0695"></a>channelpedia.timer<br />
<div class="outline-text-5" id="text-6-40-2-2">
<div class="org-src-container">
<pre class="src src-jinja2">[Unit]
Description=Upload channels.conf to channelpedia.yavdr.com

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
</pre>
</div>
</div>
</li>
<li><a id="orgdcfe206"></a>.channelpedia_credentials<br />
<div class="outline-text-5" id="text-6-40-2-3">
<div class="org-src-container">
<pre class="src src-jinja2">url={{ channelpedia_url }}
user={{ channelpedia_username }}
password={{ channelpedia_password }}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgd3e259c" class="outline-3">
<h3 id="orgd3e259c"><span class="section-number-3">6.41</span> template-test</h3>
<div class="outline-text-3" id="text-6-41">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: show vars
  debug:
    var: '{{ system }}'

- name: test templates
  template:
    src: templates/test.j2
    dest: /tmp/test.txt
</pre>
</div>
<div class="org-src-container">
<pre class="src src-shell">{{ ansible_managed | comment }}

Section "ServerLayout"
    Identifier     "Layout0"
    Screen      0  "Screen0"
    {% if system.x11.dualhead.enabled %}
    Screen      1  "Screen1" RightOf "Screen0"
    {% endif %}
    InputDevice    "Keyboard0" "CoreKeyboard"
    InputDevice    "Mouse0" "CorePointer"
EndSection

Section "InputDevice"
    # generated from default
    Identifier     "Mouse0"
    Driver         "mouse"
    Option         "Protocol" "auto"
    Option         "Device" "/dev/psaux"
    Option         "Emulate3Buttons" "no"
    Option         "ZAxisMapping" "4 5"
EndSection

# ignore devices with eventlircd tag
# ENV{ID_INPUT.tags}+="eventlircd"
# must be set by an udev rule
Section "InputClass"
    Identifier "ignore eventlircd devices"
    MatchTag "eventlircd"
    Option "Ignore" "True"
EndSection



Section "InputDevice"
    # generated from default
    Identifier     "Keyboard0"
    Driver         "kbd"
EndSection


Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "Unknown"
{% if system.x11.display.0.default == "VGA2Scart_4_3" or system.x11.display.0.default == "VGA2Scart_16_9" %}
    HorizSync       14-17
    VertRefresh     49-61
    {% if system.x11.display.0.default == "VGA2Scart_4_3" %}
    Modeline "VGA2Scart_4_3" 13.875 720 744 808 888 576 580 585 625 -HSync -Vsync interlace
    {% elif system.x11.display.0.default == "VGA2Scart_16_9" %}
    Modeline "VGA2Scart_16_9" 19 1024 1032 1120 1216 576 581 586 625 -Hsync -Vsync interlace
    {% endif %}
{% endif %}
    Option         "DPMS"
    Option         "ExactModeTimingsDVI" "True"
EndSection


{% if system.x11.dualhead.enabled == "1" %}
Section "Monitor"
    Identifier     "Monitor1"
    VendorName     "Unknown"
    ModelName      "Unknown"
{% if system.x11.display.1.default in ("VGA2Scart_4_3",  "VGA2Scart_16_9") %}
    HorizSync       14-17
    VertRefresh     49-61
    {% if system.x11.display.1.default == "VGA2Scart_4_3" %}
    Modeline "VGA2Scart_4_3" 13.875 720 744 808 888 576 580 585 625 -HSync -Vsync interlace
    {% elif system.x11.display.1.default == "VGA2Scart_16_9" %}
    Modeline "VGA2Scart_16_9" 19 1024 1032 1120 1216 576 581 586 625 -Hsync -Vsync interlace
    {% endif %}
    Option         "DPMS"
    Option         "ExactModeTimingsDVI" "True"
{% endif %}
EndSection
{% endif %}

Section "Device"
    Identifier     "Device0"
{% if system.hardware.nvidia.detected %}
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
{% endif %}
    Screen          0
    Option         "DPI" "100x100"
{% if system.hardware.nvidia.busid %}
    BusID          "PCI: {{ system.hardware.nvidia.busid }}"
{% endif %}
    Option         "NoLogo" "True"
    Option         "UseEvents" "True"
    Option         "TripleBuffer" "False"
    Option         "AddARGBGLXVisuals" "True"
    Option         "TwinView" "0"
    Option         "DynamicTwinView" "0"
    Option         "OnDemandVBlankinterrupts" "on"
    Option         "FlatPanelProperties" "Scaling = Native"
EndSection

{% if system.x11.dualhead.enabled == "1" %}
Section "Device"
    Identifier     "Device1"
    {% if system.hardware.nvidia.detected %}
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    {% endif %}
    Screen          1
    {% if system.hardware.nvidia.busid %}
    BusID          "PCI: {{ system.hardware.nvidia.busid }}"
    {% endif %}
    Option         "NoLogo" "True"
    Option         "UseEvents" "True"
    Option         "TripleBuffer" "False"
    Option         "AddARGBGLXVisuals" "True"
    Option         "TwinView" "0"
    Option         "DynamicTwinView" "0"
EndSection
{% endif %}


Section "Screen"
    Identifier     "Screen0"
    Device         "Device0"
    Monitor        "Monitor0"
    DefaultDepth    24
    SubSection     "Display"
        Depth       24
{% if system.x11.display.0.default is defined and system.x11.display.0.default %}
        Modes      "{{ system.x11.display.0.default }}"{% for mode in system.x11.display.0.mode %}{% if mode != system.x11.display.0.default %} "{{ mode }}"{% endif %}{% endfor %}

{% elif system.hardware.nvidia.detected == 1 %}
        Modes      "nvidia-auto-select"
{% endif %}
    EndSubSection
{% if system.x11.display.0.default or system.x11.default %}
    {% if system.x11.display.0.device is defined and system.x11.display.0.device %}
    Option         "ConnectedMonitor" {{ system.x11.display.0.device }}
    {% else %}
    Option         "ConnectedMonitor" {{ system.x11.default }}
    {% endif %}
    #     Option         "ConnectedMonitor" "&lt;?cs if:(?system.x11.display.0.device) ?&gt;&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;&lt;?cs else ?&gt;&lt;?cs var:system.x11.default ?&gt;&lt;?cs /if ?&gt;&lt;?cs if:(?system.x11.dualhead.enabled &amp;&amp; system.x11.dualhead.enabled == 1) ?&gt;, &lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;&lt;?cs /if ?&gt;"
    #Option         "ConnectedMonitor"
    "&lt;?cs if:(?system.x11.display.0.device) ?&gt;
          &lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;
     &lt;?cs else ?&gt;
          &lt;?cs var:system.x11.default ?&gt;
     &lt;?cs /if ?&gt;
     &lt;?cs if:(?system.x11.dualhead.enabled &amp;&amp; system.x11.dualhead.enabled == 1) ?&gt;, &lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;&lt;?cs /if ?&gt;"
#     Option         "UseDisplayDevice" "&lt;?cs if:(?system.x11.display.0.device) ?&gt;&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;&lt;?cs else ?&gt;&lt;?cs var:system.x11.default ?&gt;&lt;?cs /if ?&gt;"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(?system.hardware.nvidia.0.edid &amp;&amp; system.hardware.nvidia.0.edid == "1") ?&gt;
#     Option         "CustomEDID" "&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;:/etc/X11/edid.0.yavdr"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(system.hardware.nvidia.detected == 1 &amp;&amp; ?system.x11.display.0.device) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;: &lt;?cs var:system.x11.display.0.default ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.0.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.0.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusy ?&gt; }"
# &lt;?cs each:mode = system.x11.display.0.mode ?&gt;&lt;?cs if:(mode != system.x11.display.0.default) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.0.device) ?&gt;: &lt;?cs var:mode ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.0.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.0.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.0.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.0.viewport.out.plusy ?&gt; }"&lt;?cs /if ?&gt;&lt;?cs /each ?&gt;
{% endif %}
EndSection

{% if system.x11.dualhead.enabled == "1" %}
Section "Screen"

     Identifier     "Screen1"
     Device         "Device1"
     Monitor        "Monitor1"
     DefaultDepth    24
     SubSection     "Display"
         Depth       24
{% if system.x11.display.0.default is defined and system.x11.display.0.default %}
         Modes      "{{ system.x11.display.1.default }}"{% for mode in system.x11.display.1.mode %}{% if mode != system.x11.display.1.default %} "{{ mode }}"{% endif %}{% endfor %}

{% elif system.hardware.nvidia.detected == "1" %}
         Modes      "nvidia-auto-select"
{% endif %}
      EndSubSection

# &lt;?cs if:(?system.x11.display.1.default &amp;&amp; system.x11.display.1.default != "" &amp;&amp; system.x11.display.1.default != "disabled") ?&gt;
#     Option         "UseDisplayDevice" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(?system.hardware.nvidia.1.edid &amp;&amp; system.hardware.nvidia.1.edid == "1") ?&gt;
#     Option         "CustomEDID" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;:/etc/X11/edid.1.yavdr"
# &lt;?cs /if ?&gt;
# &lt;?cs if:(system.hardware.nvidia.detected == 1 &amp;&amp; ?system.x11.display.1.device) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;: &lt;?cs var:system.x11.display.1.default ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.1.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.1.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusy ?&gt; }"
# &lt;?cs each:mode = system.x11.display.1.mode ?&gt;&lt;?cs if:(mode != system.x11.display.1.default) ?&gt;
#     Option          "MetaModes" "&lt;?cs call:fix_display_name(system.x11.display.1.device) ?&gt;: &lt;?cs var:mode ?&gt; { ViewPortIn=&lt;?cs var:system.x11.display.1.viewport.in.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.in.y ?&gt;, ViewPortOut=&lt;?cs var:system.x11.display.1.viewport.out.x ?&gt;x&lt;?cs var:system.x11.display.1.viewport.out.y ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusx ?&gt;+&lt;?cs var:system.x11.display.1.viewport.out.plusy ?&gt; }"&lt;?cs /if ?&gt;&lt;?cs /each ?&gt;
# &lt;?cs /if ?&gt;
EndSection
{% endif %}

{% if not system.x11.use_compositing %}
Section "Extensions"
# if not open-gl OSD is needed (e.g. for vdr-sxfe):
    Option         "Composite" "Disable"
EndSection
{% endif %}
</pre>
</div>
<div class="org-src-container">
<pre class="src src-yaml">foo:
  - bar
  - baz
  - spam

system:
  hardware:
    nvidia:
      detected: "1"
      busid: "000:2304:234"
  x11:
    dualhead:
      enabled: "0"
    display:
      0:
        mode:
          - "1920x1080_50"
        default: "nvidia-auto"

      1:
        mode:
          - "1280x720_60"
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaf375e2" class="outline-3">
<h3 id="orgaf375e2"><span class="section-number-3">6.42</span> wakeup</h3>
<div class="outline-text-3" id="text-6-42">
</div>
<div id="outline-container-orgb130259" class="outline-4">
<h4 id="orgb130259"><span class="section-number-4">6.42.1</span> defaults</h4>
<div class="outline-text-4" id="text-6-42-1">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/wakeup/defaults/main.yml
wakeup_method: "acpiwakeup"
wakeup_start_ahead: 5
wakeup_days: ""
wakeup_time: ""
</pre>
</div>
</div>
</div>
<div id="outline-container-org3f8ba6b" class="outline-4">
<h4 id="org3f8ba6b"><span class="section-number-4">6.42.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-42-2">
<div class="org-src-container">
<pre class="src src-yaml">---
# file roles/wakeup/tasks/main.yml

- name: install and configure vdr-addon-acpiwakeup
  apt:
    name: vdr-addon-acpiwakeup
    state: present
  when: wakeup_method == "acpiwakeup"

- name: install and configure vdr-addon-stm32wakeup
  apt:
    name: vdr-addon-stmp32-wakeup
    state: present
  when: wakeup_method == "stm32wakeup"

- name: expand template for /etc/vdr/vdr-addon-acpiwakeup.conf
  template:
    src: templates/vdr-addon-acpiwakeup.conf.j2
    dest: /etc/vdr/vdr-addon-acpiwakeup.conf

- name: expand template for /etc/vdr/vdr-addon-stm32imrp-wakeup.conf
  template:
    src: templates/vdr-addon-stm32irmp-wakeup.conf.j2
    dest: /etc/vdr/vdr-addon-stm32irmp-wakeup.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-org9a7ec72" class="outline-4">
<h4 id="org9a7ec72"><span class="section-number-4">6.42.3</span> templates</h4>
<div class="outline-text-4" id="text-6-42-3">
</div>
<ol class="org-ol">
<li><a id="org01b18a7"></a>acpiwakeup<br />
<div class="outline-text-5" id="text-6-42-3-1">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

# Activate/deactivate ACPIWakeup with yes/no:
ACPI_ENABLED="{% if wakeup_method == 'acpiwakeup' %}yes{% else %}no{% endif %}"

# How many minutes should the machine wake up before the timer starts:
ACPI_START_AHEAD={{ wakeup_start_ahead }}

# If you want your VDR machine to wakeup in regular intervals (i.e. for
# updating EPG data), specify the days of the week and the wakeup time.
#
# Days of the week for regular wakeup (not set=Disabled, 1=Monday...7=Sunday)
{% if wakeup_days %}
ACPI_REGULAR_DAYS="{{ wakeup_days }}"
{% else %}
# ACPI_REGULAR_DAYS="1 2 3 4 5 6 7"
{% endif %}

# Wakeup time
{% if wakeup_time %}
ACPI_REGULAR_TIME="{{ wakeup_time }}"
{% else %}
# ACPI_REGULAR_TIME=01:00  # HH:MM
{% endif %}
</pre>
</div>
</div>
</li>
<li><a id="org19b12bb"></a>st32wakeup<br />
<div class="outline-text-5" id="text-6-42-3-2">
<div class="org-src-container">
<pre class="src src-jinja2">{{ ansible_managed | comment }}

# Activate/deactivate STM32Wakeup with yes/no:
WAKEUP_ENABLED="{% if wakeup_method == 'stm32wakeup' %}yes{% else %}no{% endif %}"

# How many minutes should the machine wake up before the timer starts:
WAKEUP_START_AHEAD={{ wakeup_start_ahead }}

# If you want your VDR machine to wakeup in regular intervals (i.e. for
# updating EPG data), specify the days of the week and the wakeup time.
#
# Days of the week for regular wakeup (not set=Disabled, 1=Monday...7=Sunday)
# WAKEUP_REGULAR_DAYS="1 2 3 4 5 6 7"
{% if wakeup_days %}
WAKEUP_REGULAR_DAYS="{{ wakeup_days }}"
{% endif %}

# Wakeup time
{% if wakeup_time %}
WAKEUP_REGULAR_TIME="{{ wakeup_time }}"
{% else %}
#ACPI_REGULAR_TIME=01:00  # HH:MM
{% endif %}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org8638539" class="outline-3">
<h3 id="org8638539"><span class="section-number-3">6.43</span> grub-config</h3>
<div class="outline-text-3" id="text-6-43">
</div>
<div id="outline-container-orga0c0935" class="outline-4">
<h4 id="orga0c0935"><span class="section-number-4">6.43.1</span> default variables</h4>
<div class="outline-text-4" id="text-6-43-1">
<div class="org-src-container">
<pre class="src src-yaml">system:
  shutdown: poweroff
grub:
  timeout: 0
  boot_options: quiet nosplash
intel_boot_options: ""
</pre>
</div>
</div>
</div>
<div id="outline-container-orgca2d354" class="outline-4">
<h4 id="orgca2d354"><span class="section-number-4">6.43.2</span> tasks</h4>
<div class="outline-text-4" id="text-6-43-2">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: custom grub configuration for timeout and reboot halt
  template:
    src: templates/50_custom.j2
    dest: /etc/grub.d/50_custom
    mode: '0775'
  notify: [ 'Update GRUB' ]

# TODO: add special case if plymouth is used
- name: let the system boot quietly
  lineinfile:
      dest: /etc/default/grub
      state: present
      regexp: '^(GRUB_CMDLINE_LINUX_DEFAULT=")'
      line: '\1{{ grub.boot_options }}{{ intel_boot_options }}"'
      backrefs: yes
  notify: [ 'Update GRUB' ]

- name: set GRUB_TIMEOUT
  lineinfile:
      dest: /etc/default/grub
      state: present
      regexp: '^(GRUB_TIMEOUT=)'
      line: 'GRUB_TIMEOUT={{grub.timeout}}'
      backrefs: yes
  notify: [ 'Update GRUB' ]

- name: set GRUB_TIMEOUT_STYLE
  lineinfile:
      dest: /etc/default/grub
      state: present
      regexp: '^(GRUB_TIMEOUT_STYLE=)'
      line: '\1{{"hidden" if grub.timeout == 0 else "menu"}}'
      backrefs: yes
  notify: [ 'Update GRUB' ]
</pre>
</div>
</div>
</div>
<div id="outline-container-org6ea2291" class="outline-4">
<h4 id="org6ea2291"><span class="section-number-4">6.43.3</span> templates</h4>
<div class="outline-text-4" id="text-6-43-3">
<div class="org-src-container">
<pre class="src src-jinja2">#!/bin/sh
{{ ansible_managed | comment }}

exec tail -n +3 $0

{% if system.shutdown is defined and system.shutdown == 'reboot' %}
menuentry "PowerOff" {
    halt
}
{% endif %}

if [ "${recordfail}" = 1 ]; then
    set timeout={{ 3 if grub.timeout &lt; 3 else grub.timeout }}
else
    set timeout={{ grub.timeout if grub.timeout is defined else 0 }}
fi
</pre>
</div>
</div>
</div>
<div id="outline-container-orga664789" class="outline-4">
<h4 id="orga664789"><span class="section-number-4">6.43.4</span> handlers</h4>
<div class="outline-text-4" id="text-6-43-4">
<div class="org-src-container">
<pre class="src src-yaml">---

- name: Update Initramfs
  command: "update-initramfs -u"
  failed_when: ('error' in initramfs_register_update.stderr)
  register: initramfs_register_update

- name: Update GRUB
  command: update-grub
  failed_when: ('error' in grub_register_update.stderr)
  register: grub_register_update

  # TODO: Do we need to use grub-set-default?
  # https://github.com/yavdr/yavdr-utils/blob/master/events/actions/update-grub
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org899b826" class="outline-2">
<h2 id="org899b826"><span class="section-number-2">7</span> Modules</h2>
<div class="outline-text-2" id="text-7">
<p>
This section contains custom modules for the yaVDR Playbooks. They are used to collect facts about the system and configure applications and daemons.
</p>
</div>
<div id="outline-container-org1e80b98" class="outline-3">
<h3 id="org1e80b98"><span class="section-number-3">7.1</span> hardware_facts.py</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-python"># This Module collects the vendor- and device ids for USB- and PCI(e)-devices and currently loaded kernel modules.
DOCUMENTATION = '''
  ---
  module: hardware_facts
  short_description: collects facts for kernel modules, usb and pci devices
  description:
       - This Module collects the vendor- and device ids for USB- and PCI(e)-devices and
         currently loaded kernel modules.
  options:
      usb:
          required: False
          default: True
          description:
            - return a list of vendor- and device ids for usb devices in '04x:04x' notation

    pci:
        required: False
        default: True
        description:
          - return a list of vendor- and device ids for pci devices in '04x:04x' notation

    modules:
        required: False
        default: True
        description:
          - return a list of currently loaded kernel modules

    gpus:
        required: False
        default: True
        description:
          - return a list of devices of the pci gpu class (0x030000)

    serial:
        required: False
        default: True
        description:
          - return a list of serial connections which provide an address and an interrupt

    acpi_power_modes:
        required: False
        default: True
        description:
          - return a list of supported acpi power saving modes
notes:
   - requires python3-pyusb and python3-kmodpy
requirements: [ ]
author: "Alexander Grothe &lt;seahawk1986@gmx.de&gt;"
'''

EXAMPLES = '''
- name: get information about usb and pci hardware and loaded kernel modules
  hardware_facts:
    usb: True
    pci: True
    serial: True
    modules: True
    acpi_power_modes: True
- debug:
    var: usb
- debug:
    var: pci
- debug:
    var: modules
- debug:
    var: serial
- debug:
    var: gpus
- debug:
    var: acpi_power_modes
'''

import glob
import json
import os
import sys
import usb.core
from collections import namedtuple
from itertools import chain

import kmodpy
from ansible.module_utils.basic import *


PCIDevice = namedtuple("PCIDevice", 'idVendor idProduct idClass pciPath')

vendor_dict = {
    0x10de: 'nvidia',
    0x8086: 'intel',
    0x1002: 'amd',
    0x80ee: 'virtualbox',
    }

def get_pci_devices():
    for device in chain(glob.glob('/sys/devices/pci*/*:*:*/'), glob.glob('/sys/devices/pci*/*:*:*/*:*:*/')):
        try:
            with open(os.path.join(device, 'device')) as d:
                product_id = int(d.read().strip(), 16)
            with open(os.path.join(device, 'vendor')) as d:
                vendor_id = int(d.read().strip(), 16)
            with open(os.path.join(device, 'class')) as d:
                class_id = int(d.read().strip(), 16)
            yield PCIDevice(idVendor=vendor_id, idProduct=product_id, idClass=class_id, pciPath=device)
        except IOError:
            pass

def format_device_list(iterator):
    return ["{:04x}:{:04x}".format(d.idVendor, d.idProduct) for d in iterator]

def format_gpu_device_list(iterator):
    def get_entries(iterator):
        for d in iterator:
            if d.idClass == 0x030000:
                yield {"VendorName": vendor_dict.get(d.idVendor, "unknown"),
                       "VendorID": d.idVendor, "ProductID": d.idProduct}
    return [entry for entry in get_entries(iterator)]


def get_serial_data(name):
    """
    get the I/O and IRQ numbers for the serial port
    using the /sys/class/tty/ttyS&lt;X&gt;/ device nodes
    """
    with open(os.path.join(name, 'irq')) as f:
        irq = int(f.read().rstrip())
    with open(os.path.join(name, 'port')) as f:
        port = int(f.read().rstrip(), base=16)
    return port, irq

def get_serial_devices():
    devices = {}
    p = '/sys/class/tty/'
    for d in sorted(glob.glob(os.path.join(p, 'ttyS[0-9]*'))):
        port, irq = get_serial_data(d)
        if port and irq:
            # TODO: check if a serial receiver is attached
            devices[os.path.basename(d)] = {'port': '0x{:x}'.format(port), 'irq': irq}
    return devices


def list_acpi_power_modes():
    acpi_power_modes = []
    try:
        with open('/sys/power/state') as f:
            acpi_power_modes = [l for l in f.readline().split()]
    except IOError:
        pass
    return acpi_power_modes

arg_specs = {
    'usb': dict(default=True, type='bool', required=False),
    'pci': dict(default=True, type='bool', required=False),
    'modules': dict(default=True, type='bool', required=False),
    'gpus': dict(default=True, type='bool', required=False),
    'serial': dict(default=True, type='bool', required=False),
    'acpi_power_modes': dict(default=True, type='bool', required=False),
    }


def main():
    module = AnsibleModule(argument_spec=arg_specs, supports_check_mode=True,)
    collect_usb = module.params['usb']
    collect_pci = module.params['pci']
    collect_modules = module.params['modules']
    collect_gpus = module.params['gpus']
    collect_serial = module.params['serial']
    collect_acpi_power_modes = module.params['acpi_power_modes']

    usb_devices = []
    pci_devices = []
    modules = []
    gpus = []
    nvidia_detected = False
    intel_detected = False
    amd_detected = False
    virtualbox_detected = False
    serial_devices = []
    acpi_power_modes = []

    if collect_usb:
        usb_devices = format_device_list(usb.core.find(find_all=True))

    if collect_pci:
        pci_devices = format_device_list(get_pci_devices())

    if collect_modules:
        k = kmodpy.Kmod()
        modules = [m[0] for m in k.loaded()]

    if collect_gpus:
        gpus = format_gpu_device_list(get_pci_devices())
        nvidia_detected = any((True for gpu in gpus if gpu['VendorName'] == 'nvidia'))
        intel_detected = any((True for gpu in gpus if gpu['VendorName'] == 'intel'))
        amd_detected = any((True for gpu in gpus if gpu['VendorName'] == 'amd'))
        virtualbox_detected = any((True for gpu in gpus if gpu['VendorName'] == 'virtualbox'))

    if collect_serial:
        serial_devices = get_serial_devices()

    if collect_acpi_power_modes:
        acpi_power_modes = list_acpi_power_modes()

    data = {'usb': usb_devices,
            'pci': pci_devices,
            'modules': modules,
            'gpus': gpus,
            'serial': serial_devices,
            'acpi_power_modes': acpi_power_modes,
            'nvidia_detected': nvidia_detected,
            'intel_detected': intel_detected,
            'amd_detected': amd_detected,
            'virtualbox_detected': virtualbox_detected,
    }
    module.exit_json(changed=False, ansible_facts=data, msg=data)


if __name__ == '__main__':
    main()
</pre>
</div>
</div>
</div>
<div id="outline-container-org9227471" class="outline-3">
<h3 id="org9227471"><span class="section-number-3">7.2</span> pci_facts.py</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">
<pre class="src src-python">
# This module parses the output of lspci for detailed information about available (sub) devices.
DOCUMENTATION = '''
  ---
  module: pci_facts
  short_description: parses lspci output for detailed (sub) devices data
  description:
      - This module parses the output of lspci for detailed information about available (sub) devices.
      - returns a list with a dict for each device

notes:
    - requires lspci (package pciutils)

'''

EXAMPLES = '''
- name: get detailled pci device infos
  pci_facts:

- debug:
    var: pci_devices
'''


import argparse
import shlex
import subprocess
from collections import namedtuple

from ansible.module_utils.basic import *

def convert2hex(arg):
    arg = arg.strip('"')
    if arg:
        return int(arg, 16)
    else:
        return None

def parse_lspci_data():
    parser = argparse.ArgumentParser()
    parser.add_argument('-r', '--revision', help='revision', type=convert2hex)
    parser.add_argument('-p', '--progif', help='proginf', type=convert2hex)
    parser.add_argument('slot')
    parser.add_argument('device_class', type=convert2hex)
    parser.add_argument('vendor_id', type=convert2hex)
    parser.add_argument('device_id', type=convert2hex)
    parser.add_argument('sub_vendor_id', type=convert2hex)
    parser.add_argument('sub_device_id', type=convert2hex)
    parser.add_argument('other', nargs='*', default=[])

    devices = []
    for line in subprocess.check_output(['lspci', '-nm'], universal_newlines=True).splitlines():
        args = parser.parse_args(args=shlex.split(line))
        devices.append(vars(args))
    return devices


def main():
    arg_specs = {}
    module = AnsibleModule(argument_spec=arg_specs, supports_check_mode=True,)
    try:
        pci_devices = parse_lspci_data()
    except:
        module.fail_json(msg="Something fatal happened")
    data = {'pci_devices': pci_devices}
    module.exit_json(changed=False, ansible_facts=data, msg=data)

if __name__ == '__main__':
    main()
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcb34123" class="outline-3">
<h3 id="orgcb34123"><span class="section-number-3">7.3</span> satip_facts.py</h3>
<div class="outline-text-3" id="text-7-3">
<div class="org-src-container">
<pre class="src src-python">DOCUMENTATION = '''
---
module: hardware_facts
short_description: "check if at least one SAT&gt;IP server responds on the network"
description:
     - This script sends a multicast message and awaits responses by Sat&gt;IP servers.
       Returns a list of detected SAT&gt;IP servers with their name and capabilites.
'''
EXAMPLES = '''
- name: "detect SAT&gt;IP Server on the network"
  action: satip_facts

- debug:
    var: satip_devices
'''

import json
import socket
import sys
import time
import xml.etree.ElementTree as ET
import requests
from contextlib import contextmanager
from ansible.module_utils.basic import *

SSDP_BIND = "0.0.0.0"
SSDP_ADDR = "239.255.255.250"
SSDP_PORT = 1900
# SSDP_MX = max delay for server response
# a value of 2s is recommended by the SAT&gt;IP specification 1.2.2
SSDP_MX = 2
SSDP_ST = "urn:ses-com:device:SatIPServer:1"

ssdpRequest = "\r\n".join((
    "M-SEARCH * HTTP/1.1",
    "HOST: %s:%d" % (SSDP_ADDR, SSDP_PORT),
    "MAN: \"ssdp:discover\"",
    "MX: %d" % (SSDP_MX),
    "ST: %s" % (SSDP_ST),
    "\r\n")).encode('utf-8')

@contextmanager
def socket_manager(*args, **kwargs):
    """provide a context manager for socket"""
    sock = socket.socket(*args, **kwargs)
    sock.setblocking(False)
    sock.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, 2)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    try:
        sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEPORT, 1)
    except socket.error:
        pass
    sock.settimeout(SSDP_MX + 0.5)
    sock.bind((SSDP_BIND, SSDP_PORT))
    try:
        yield sock
    finally:
        sock.close()


def parse_satip_xml(data):
    """ Parse SAT&gt;IP XML data.
    Args:
        data (str): XML input data..
    Returns:
        dict: Parsed SAT&gt;IP device name and frontend information.
    """
    result = {'name': '', 'frontends': {}}
    if data:
        root = ET.fromstring(data)
        name = root.find('.//*/{urn:schemas-upnp-org:device-1-0}friendlyName')
        result['name'] = name.text
        satipcap = root.find('.//*/{urn:ses-com:satip}X_SATIPCAP')
        if satipcap is None:
            raise ValueError("Invalid SAT&gt;IP device description")
        caps = {}
        for system in satipcap.text.split(","):
            cap = system.split("-")
            if cap:
                count = int(cap[1])
                if cap[0] in caps:
                    count = count + caps[cap[0]]
                caps[cap[0]] = count
        result['frontends'] = caps
    return result


def main():
    description_urls = []
    device_list = []
    module = AnsibleModule(argument_spec={}, supports_check_mode=True,)
    with socket_manager(socket.AF_INET, socket.SOCK_DGRAM) as sock:
        # according to Sat&gt;IP Specification 1.2.2, p. 20
        # a client should send three requests within 100 ms with a ttl of 2

        for _ in range(3):
            sock.sendto(ssdpRequest, (SSDP_ADDR, SSDP_PORT))
            time.sleep(0.03)
        try:
            response = sock.recv(1024).decode()
            if response and "SERVER:" in response:
                for line in response.splitlines():
                    if "LOCATION" in line:
                        url = line.split()[-1].strip()
                        if url not in description_urls:
                            description_urls.append(url)
                            info = requests.get(url, timeout=2)
                            device_list.append(parse_satip_xml(info.text))
            else:
                raise ValueError('No satip server detected')
        except (socket.timeout, ValueError, ET.ParseError):
            pass

    module.exit_json(changed=False, ansible_facts={'satip_devices': device_list})

if __name__ == '__main__':
    main()
</pre>
</div>
</div>
</div>
<div id="outline-container-org44b8867" class="outline-3">
<h3 id="org44b8867"><span class="section-number-3">7.4</span> xrandr_facts.py</h3>
<div class="outline-text-3" id="text-7-4">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> support multiple screens (-d :0.0 .. :0.n)</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">#!/usr/bin/env python2
from __future__ import print_function
import ast
import binascii
import csv
import os
import re
import subprocess
from collections import namedtuple
from glob import glob

from ansible.module_utils.basic import AnsibleModule

DOCUMENTATION = '''
---
module: xrandr_facts
short_description: "gather facts about connected monitors and available modelines"
description:
     - This module needs a running x-server on a given display in
       order to successfully call xrandr. Returns the dictionary
       "xrandr", wich contains all screens with output states,
       connected displays, EDID info and their modes and a
       recommendation for the best fitting tv mode, the dictionary
       "xorg" with a recommendation for the primary and secondary
       output and a "drm" dictionary whose "primary" key associates
       the primary device name of the drm subsystem with the one from
       the xrandr output by comparing the edid data and a list of
       "ignored_devices". Note that the proprietary nvidia driver
       doesn't support KMS/drm, so in this case the dictionary is
       always empty.
options:
    display:
        required: False
        default: ":0"
        description:
          - the DISPLAY variable to use when calling xrandr
    preferred_outputs:
        required: False
        default: ["HDMI", "DP", "eDP", "DVI", "VGA", "TV", "Virtual"]
        description:
          - ranking of the preferred display connectors
    preferred_refreshrates:
        required: False
        default: ["50", "60", "75", "30", "25"]
        description:
          - ranking of the preferred display refreshrate
    preferred_resolutions:
        required: False
        default: ["7680x4320", "3840x2160", "1920x1080", "1280x720", "720x576"]
        description:
           - ranking of the preferred display resolutions
    write_edids:
        required: False
        default: True
        description:
           - write edid data to /etc/X11/edid.{connector}.bin
           - the dictionary "drm" can only be filled with data if write_edids is enabled
'''
EXAMPLES = '''
- name: "collect facts for connected displays"
  action: xserver_facts
    display: ":0"

- debug:
    var: xrandr

- debug:
    var: xorg

- debug:
    var: drm
'''

ARG_SPECS = {
    'display': dict(default=":0", type='str', required=False),
    'preferred_outputs': dict(
        default=["HDMI", "DP", "eDP", "DVI", "VGA", "TV", "Virtual"], type='list', required=False),
    'preferred_refreshrates': dict(
        default=[50, 60, 75, 30, 25], type='list', required=False),
    'preferred_resolutions': dict(
        default=[
            "7680x4320", "3840x2160", "1920x1080", "1280x720", "720x576"],
        type='list', required=False),
    'write_edids': dict(default=True, type='bool', required=False),
}

SCREEN_REGEX = re.compile(r"^(?P&lt;screen&gt;Screen\s\d+:)(?:.*)")
CONNECTOR_REGEX = re.compile(
    r"^(?P&lt;connector&gt;.*-?\d+)\s(?P&lt;connection_state&gt;connected|disconnected)\s(?P&lt;primary&gt;primary)?")
MODE_REGEX = re.compile(r"^\s+(?P&lt;resolution&gt;\d{3,}x\d{3,}).*")

Mode = namedtuple('Mode', ['connection', 'resolution', 'refreshrate'])


def check_for_screen(line):
    """check line for screen information"""
    match = re.match(SCREEN_REGEX, line)
    if match:
        return match.groupdict()['screen']


def check_for_connection(line):
    """check line for connection name and state"""
    match = re.match(CONNECTOR_REGEX, line)
    connector = None
    is_connected = False
    if match:
        match = match.groupdict()
        connector = match['connector']
        is_connected = True if match['connection_state'] == 'connected' else False
    return connector, is_connected


def get_indentation(line):
    """return the number of leading whitespace characters"""
    return len(line) - len(line.lstrip())


def sort_mode(mode):
    """rate modes by several criteria"""
    connection_score = 0
    rrate_score = 0
    resolution_score = 0
    preferred_rrates = module.params['preferred_refreshrates']
    # [50, 60]
    preferred_resolutions = module.params['preferred_resolutions']
    # ["7680x4320", "3840x2160", "1920x1080", "1280x720", "720x576"]
    preferred_outputs = module.params['preferred_outputs']
    # ["HDMI", "DP", "DVI", "VGA"]
    if mode.refreshrate in preferred_rrates:
        rrate_score = len(preferred_rrates) - preferred_rrates.index(mode.refreshrate)
    if mode.resolution in preferred_resolutions:
        resolution_score = len(preferred_resolutions) - preferred_resolutions.index(mode.resolution)
    x_resolution, y_resolution = (int(n) for n in mode.resolution.split('x'))
    connection = mode.connection.split('-')[0]
    if connection in preferred_outputs:
        connection_score = len(preferred_outputs) - preferred_outputs.index(connection)
    return (rrate_score, resolution_score, x_resolution, y_resolution, connection_score)


def parse_xrandr_verbose(iterator):
    """parse the output of xrandr --verbose using an iterator delivering single lines"""
    xorg = {}
    is_connected = False
    for line in iterator:
        if line.startswith("Screen"):
            screen = check_for_screen(line)
            xorg[screen] = {}
        elif "connected" in line:
            connector, is_connected = check_for_connection(line)
            xorg[screen][connector] = {
                "is_connected": is_connected,
                "EDID": "",
                "modes": {},
                "modelines": {},
                "preferred": "",
                "current": "",
                "auto": "",
            }
        elif is_connected and "EDID:" in line:
            edid_str = ""
            outer_indentation = get_indentation(line)
            while True:
                line = next(iterator)
                if get_indentation(line) &gt; outer_indentation:
                    edid_str += line.strip()
                else:
                    break
            xorg[screen][connector]["EDID"] = edid_str
        elif is_connected and "MHz" in line and "Interlace" not in line:
            match = re.match(MODE_REGEX, line)
            if match:
                match = match.groupdict()
                preferred = bool("+preferred" in line)
                current = bool("*current" in line)
                resolution, mode_num, pixel_clk, *flags = line.split()
                flags = [flag for flag in flags if flag not in ("*current", "+preferred")]
                pixel_clk = pixel_clk[:-3]

                while True:
                    line = next(iterator).strip()
                    if line.startswith("h:"):
                        _, _, h_width, _, h_start, _, h_end, _, h_total, _, h_skew, _, h_clock = (
                            line.split()
                        )
                        h_clock = h_clock[:-3]

                    if line.startswith("v:"):
                        _, _, v_height, _, v_start, _, v_end, _, v_total, _, v_clock = (
                            line.split()
                        )
                        refresh_rate = ast.literal_eval(v_clock[:-2])
                        rrate = int(round(refresh_rate))
                        if (
                            xorg[screen][connector]["modes"].get(match["resolution"])
                            is None
                        ):
                            xorg[screen][connector]["modes"][match["resolution"]] = []
                        if (
                            rrate
                            not in xorg[screen][connector]["modes"][match["resolution"]]
                        ):
                            xorg[screen][connector]["modes"][
                                match["resolution"]
                            ].append(rrate)
                        mode_name = f'{match["resolution"]}_{rrate}'
                        if preferred:
                            xorg[screen][connector]["preferred"] = mode_name
                        if current:
                            xorg[screen][connector]["current"] = mode_name
                        modeline = (
                            f'Modeline "{mode_name}"  {pixel_clk} {h_width} {h_start} {h_end} {h_total} {v_height} {v_start} {v_end} {v_total} {" ".join(flags)}'
                        )
                        xorg[screen][connector]["modelines"][mode_name] = modeline
                        break
    return xorg


Modeline_Data = namedtuple("Modeline", [
    "pixelclock",
    "hdisp", "hsyncstart", "hsyncend", "htotal",
    "vdisp", "vsyncstart", "vsyncend", "vtotal",
    "flags"])


def parse_edid_data(edid):
    vendor = "Unknown"
    model = "Unknown"
    modelines = []
    try:
        data = subprocess.check_output("parse-edid &lt; {}".format(edid),
                                       shell=True, errors='replace', universal_newlines=True)
    except subprocess.CalledProcessError:
        pass
    else:
        for line in data.splitlines():
            line = line.strip()
            if "VendorName" in line:
                vendor = line.split('"')[1]
            elif "ModelName" in line:
                model = line.split('"')[1]
            elif "Modeline" in line:
                # For the fields of a modeline see
                # https://en.wikipedia.org/wiki/XFree86_Modeline
                print(line)
                # ignore 'Modeline "Mode N"' part of Modeline
                _, _, line = line.split('"', 2)
                if not line:
                    print("no timing information")
                    continue
                try:
                    mode = Modeline_Data(*line.split(None, 9))
                except (ValueError, TypeError):
                    print("invalid timing information")
                    continue
                refresh = round(float(mode.pixelclock) * 1E6 /
                                (float(mode.htotal) * float(mode.vtotal)))
                interlaced = "interlaced" in mode.flags
                if interlaced:
                    refresh /= 2
                refresh = int(refresh)
                modeline_name = '"{}x{}_{}{}"'.format(mode.hdisp, mode.vdisp,
                                                      refresh, "i" if interlaced else '')
                modelines.append(" ".join(("Modeline", modeline_name,
                                           line)))
    return vendor, model, modelines


def collect_nvidia_data():
    BusID_RE = re.compile((
        r'(?P&lt;domain&gt;[0-9a-fA-F]+)'
        r':'
        r'(?P&lt;bus&gt;[0-9a-fA-F]+)'
        r':'
        r'(?P&lt;device&gt;[0-9a-fA-F]+)'
        r'\.'
        r'(?P&lt;function&gt;[0-9a-fA-F]+)'
    ))
    try:
        data = subprocess.check_output(["nvidia-smi", "--query-gpu=name,pci.bus_id",
                                        "--format=csv", "-i0"], universal_newlines=True)
    except subprocess.CalledProcessError:
        pass
    except OSError:
        # nvidia-smi is not installed
        pass
    else:
        for row in csv.DictReader(data.splitlines(), delimiter=',', skipinitialspace=True):
            name = row['name']
            bus_id = row['pci.bus_id']
            # pci.bus_id structure as reported by nvidia-smi: "domain:bus:device.function", in hex.
            match = BusID_RE.search(bus_id)
            if match:
                domain, bus, device, function = (int(n, 16) for n in match.groups())
                bus_id = "PCI:{:d}@{:d}:{:d}:{:d}".format(bus, domain, device, function)
                return name, bus_id
    raise ValueError


def find_drm_connectors(connections):
    """
    returns a dict with the following schema (secondary may be empty):
    {
        'primary': {
            'edid': 'edid.HDMI-1.bin',
            'drm_connector': 'HDMI-A-1',
            'xrandr_connector': 'HDMI-1',
        },
        'secondary': {
            'edid': 'edid.eDP-1.bin',
            'drm_connector': 'eDP-1',
            'xrandr_connector': 'eDP-1',
        }
        'ignored_outputs': ['HDMI-A-2', 'DP-1']
    }
    """
    STATUS_GLOB = '/sys/class/drm/card0*/status'
    CONNECTOR_RE = re.compile('card0-(?P&lt;connector&gt;[^/]+)/status')

    def read_edid_bytes(edid_file):
        edid_bytes = b''
        try:
            with open(edid_file, 'rb') as f:
                edid_bytes = f.read()
        except IOError:
            pass
        return edid_bytes

    xrandr_edid_bytes = read_edid_bytes(connections.get('primary', {}).get('edid', ""))
    secondary_xrandr_edid_bytes = read_edid_bytes(connections.get('secondary', {}).get('edid', ''))

    drm = {'primary': {}, 'secondary': {}, 'ignored_outputs': []}
    for status_p in glob(STATUS_GLOB):
        match = re.search(CONNECTOR_RE, status_p)
        if match:
            drm_connector = match.group('connector')
        else:
            continue

        try:
            with open(status_p) as f:
                connected = f.read().strip() == 'connected'
        except IOError:
            continue

        if connected:
            edid = read_edid_bytes(os.path.join(
                os.path.dirname(status_p), 'edid'))
            if edid:
                if edid == xrandr_edid_bytes:
                    drm['primary'] = {
                        'edid': os.path.basename(connections['primary'].get('edid', "")),
                        'drm_connector': drm_connector,
                        'xrandr_connector': connections['primary'].get('connector',''),
                    }
                    continue
                if secondary_xrandr_edid_bytes:
                    drm['secondary'] = {
                        'edid': os.path.basename(connections.get('secondary').get('edid', '')),
                        'drm_connector': drm_connector,
                        'xrandr_connector': connections['secondary'].get('connector',''),
                    }
                    continue
        drm['ignored_outputs'].append(drm_connector)
    return drm


def output_data(data, write_edids=True):
    result = {}
    drm = {}
    if data:
        modes = []
        for _, screen_data in data.items():
            for connector, connection_data in screen_data.items():
                if connection_data.get('EDID') and write_edids:
                    with open('/etc/X11/edid.{}.bin'.format(connector), 'wb') as edid:
                        edid.write(binascii.a2b_hex(connection_data['EDID']))
                for resolution, refreshrates in connection_data['modes'].items():
                    for refreshrate in refreshrates:
                        modes.append(Mode(connector, resolution, refreshrate))
        if modes:
            try:
                gpu_name, bus_id = collect_nvidia_data()
            except ValueError:
                gpu_name = None
                bus_id = None

            def create_entry(my_dict, name, connector, resolution, refreshrate, vendor, model, modelines):
                my_dict[name] = {
                    'connector': connector,
                    'resolution': resolution,
                    'refreshrate': refreshrate,
                    'edid': '/etc/X11/edid.{}.bin'.format(connector),
                    'mode': "{}_{}".format(resolution, refreshrate),
                    'vendor': vendor,
                    'model': model,
                    'modelines': modelines,
                }
                if gpu_name and bus_id:
                    result[name]['gpu_name'] = gpu_name
                    result[name]['bus_id'] = bus_id

            connector_0, resolution_0, refreshrate_0 = max(modes, key=sort_mode)[:3]
            connector_0_edid = '/etc/X11/edid.{}.bin'.format(connector_0)
            vendor_0, model_0, modelines_0 = parse_edid_data(connector_0_edid)
            create_entry(result, 'primary', connector_0, resolution_0,
                         refreshrate_0, vendor_0, model_0, modelines_0)

            # check if additional monitors exist
            other_modes = [mode for mode in modes if mode[0] != connector_0]
            if other_modes:
                connector_1, resolution_1, refreshrate_1 = max(other_modes, key=sort_mode)[:3]
                connector_1_edid = '/etc/X11/edid.{}.bin'.format(connector_1)
                vendor_1, model_1, modelines_1 = parse_edid_data(connector_1_edid)
                create_entry(result, 'secondary', connector_1, resolution_1,
                             refreshrate_1, vendor_1, model_1, modelines_1)

            if write_edids:
                drm = find_drm_connectors(result)


    module.exit_json(changed=True if write_edids else False,
                     ansible_facts={'xrandr': data, 'xorg': result, 'drm': drm})


if __name__ == '__main__':
    module = AnsibleModule(argument_spec=ARG_SPECS, supports_check_mode=False,)
    try:
        d = subprocess.check_output(['xrandr', '-d', module.params['display'], '--verbose'],
                                    errors='replace', universal_newlines=True).splitlines()
    except subprocess.CalledProcessError:
        xorg_data = {}
    else:
        xorg_data = parse_xrandr_verbose(iter(d))
    output_data(xorg_data, module.params['write_edids'])
</pre>
</div>
</div>
</div>
<div id="outline-container-org0d652fb" class="outline-3">
<h3 id="org0d652fb"><span class="section-number-3">7.5</span> rmmod.py</h3>
<div class="outline-text-3" id="text-7-5">
<div class="org-src-container">
<pre class="src src-python">#!/usr/bin/python
# -*- coding: utf-8 -*-

# Copyright: (c) 2019, Alexander Grothe &lt;seahawk1986@gmx.de&gt;
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

from __future__ import absolute_import, division, print_function
__metaclass__ = type
import traceback

from ansible.module_utils.basic import AnsibleModule
from ansible.module_utils._text import to_native


ANSIBLE_METADATA = {'metadata_version': '1.1',
                    'status': ['preview'],
                    'supported_by': 'community'}

DOCUMENTATION = '''
---
module: rmmod
short_description: unload kernel modules with rmmod
version_added: 2.7
author:
    - Alexander Grothe
description:
    - Unload kernel modules with rmmod.
    - Builtin kernel modules can't be removed (will do nothing in this case).
options:
    name:
        required: true
        description:
            - Name of kernel module to remove.
'''

EXAMPLES = '''
- name: Unload nouveau module
  rmmod:
    name: nouveau
'''


def main():
    module = AnsibleModule(
        argument_spec=dict(
            name=dict(type='str', required=True),
        ),
        supports_check_mode=True,
    )

    name = module.params['name']

    # FIXME: Adding all parameters as result values is useless
    result = dict(
        changed=False,
        name=name,
    )

    # Check if module is loaded
    try:
        is_loaded = False
        with open('/proc/modules') as modules:
            module_name = name.replace('-', '_') + ' '
            for line in modules:
                if line.startswith(module_name):
                    is_loaded = True
                    break
    except IOError as e:
        module.fail_json(msg=to_native(e), exception=traceback.format_exc(), **result)

    # remove module if it is loaded
    if is_loaded:
        if not module.check_mode:
            rc, out, err = module.run_command([module.get_bin_path('rmmod', True), name])
            if rc != 0:
                module.fail_json(msg=err, rc=rc, stdout=out, stderr=err, **result)
        result['changed'] = True

    module.exit_json(**result)


if __name__ == '__main__':
    main()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org046ac32" class="outline-2">
<h2 id="org046ac32"><span class="section-number-2">8</span> Handlers</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-yaml">- name: Reconfigure unattended upgrades with dpkg
  command: '/usr/sbin/dpkg-reconfigure --frontend noninteractive unattended-upgrades'

- name: Trigger Udev
  command: 'udevadm trigger '

- name: Restart Samba
  systemd:
    name: smbd.service
    state: restarted
    enabled: yes
    #masked: no
  register: samba_reload

- name: Restart vdr-addon-lifeguard-ng
  systemd:
    name: vdr-addon-lifeguard-ng.service
    state: restarted
    enabled: yes
  register: lifeguard_reload

- name: Restart NFS Kernel Server
  systemd:
    name: nfs-server.service
    state: restarted
    enabled: yes
    #masked: no
  register: nfs_reload

- name: Restart sundtek.service
  systemd:
    name: sundtek.service
    state: restarted
    enabled: yes
    masked: no

- name: Restart VDR
  systemd:
    name: vdr.service
    state: restarted
    enabled: yes
  register: vdr_restart

- name: Stop VDR
  systemd:
    name: vdr.service
    state: stopped
    enabled: yes
  register: vdr_stop

- name: Start VDR
  systemd:
    name: vdr.service
    state: started
    enabled: yes
  register: vdr_start

- name: Start yavdr-xorg
  systemd:
    daemon_reload: yes
    name: 'yavdr-xorg'
    enabled: yes
    state: started
  register: yavdr_xorg_start


- name: Stop xlogin
  systemd:
    name: xlogin@vdr.service
    state: stopped
    enabled: yes
  register: xlogin_stop

- name: Start xlogin
  systemd:
    daemon_reload: yes
    name: 'xlogin@{{ vdr.user }}'
    enabled: yes
    state: started
  register: xlogin_start

- name: Stop x
  systemd:
    name: x@vt7.service
    state: stopped
  register: x_stop

- name: reboot required
  debug:
    msg: PLEASE REBOOT YOUR SYSTEM.

- name: rerun required
  debug:
    msg: PLEASE REBOOT YOUR SYSTEM AND RUN THIS PLAYBOOK AGAIN.
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alexander Grothe &lt;seahawk1986@gmx.de&gt;</p>
<p class="date">Created: 2020-04-09 Do 14:56</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
